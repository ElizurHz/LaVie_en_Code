<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Variation Palladion - æ’•è£‚æ—¶é—´çš„å¸•æ‹‰è¿ªæ˜‚ on Variation Palladion - æ’•è£‚æ—¶é—´çš„å¸•æ‹‰è¿ªæ˜‚</title>
    <link>https://elizurhz.cn/</link>
    <description>Recent content in Variation Palladion - æ’•è£‚æ—¶é—´çš„å¸•æ‹‰è¿ªæ˜‚ on Variation Palladion - æ’•è£‚æ—¶é—´çš„å¸•æ‹‰è¿ªæ˜‚</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Thu, 10 Dec 2020 00:00:00 +0000</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Apple M1 å¯¹å‰ç«¯å¼€å‘è€…æœ‰ä»€ä¹ˆå½±å“</title>
      <link>https://elizurhz.cn/tips/apple-m1-for-fe/</link>
      <pubDate>Thu, 10 Dec 2020 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/tips/apple-m1-for-fe/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯ä»æˆ‘æœ€è¿‘å¾®åšåŠ¨æ€ç­‰æå–çš„è§‚ç‚¹æ•´åˆæˆçš„ä¸€ä»½æ€»ç»“ï¼Œå°±ä¸è¯¦ç»†é™„å›¾äº†ï¼Œæœ‰å…´è¶£å¯ä»¥å…³æ³¨ä¸‹æˆ‘çš„å¾®åšï¼Œåœ¨é¡¶éƒ¨å¯¼èˆªæ çš„â€œAboutâ€ä¸­æœ‰ï¼Œå¯èƒ½å†™å¾—æ›´è¯¦ç»†ï¼Œä¸è¿‡ä¸ªäººæƒ…ç»ªä¹Ÿæ¯”è¾ƒå¤šï¼Œå¯èƒ½æ²¡æœ‰è¿™ç¯‡æ–‡ç« æ¥å¾—å®¢è§‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æœ€è¿‘å…¥æ‰‹äº† M1 Mac miniï¼Œä½é…åŠ åˆ° 16G å†…å­˜ï¼Œå°±è¿«ä¸åŠå¾…æ‹¿æ¥å°è¯•ã€‚ç›®å‰ä»å‰ç«¯çš„è§’åº¦æ¥è¯´ï¼ŒåŸºæœ¬æ˜¯æ­£é¢çš„ã€‚&lt;/p&gt;

&lt;p&gt;ç¡¬ä»¶ä¸Šå°±ä¸å¤šè¯´äº†ï¼ŒM1 æœ‰è®¡ç®—èƒ½åŠ›ã€å†…å­˜å¸¦å®½ã€SSD é€Ÿåº¦ã€åŠŸè€—ã€å‘çƒ­ç­‰æ–¹é¢çš„ä¼˜åŠ¿ï¼Œæ€»ä½“ä½“éªŒæ˜¯å¥½äº Intel ä¸å°‘çš„ã€‚&lt;/p&gt;

&lt;p&gt;è½¯ä»¶ä¸Šå¯èƒ½æœ‰å¾ˆå¤šäººæ‹…å¿ƒå…¼å®¹æ€§é—®é¢˜ã€‚å°±å‰ç«¯æ¥è¯´ï¼Œå…¶å®å®Œå…¨æ˜¯å¯è§£å†³çš„é—®é¢˜ã€‚é¦–å…ˆå‰ç«¯ä¾èµ–çš„å·¥å…·ä¸»è¦æ˜¯ Node.jsã€æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆé IDEï¼Œå¦‚ VSCodeï¼‰ä»¥åŠ npm ç”Ÿæ€ã€‚Node.js æ˜¯å¯ä»¥é€šè¿‡ Rosetta 2 å®‰è£…åŠè¿è¡Œçš„ï¼ŒARM ç‰ˆæ­£åœ¨ç ”å‘ä¸­ã€‚VSCode åŒæ ·ï¼Œä¸è¿‡ Insider ç‰ˆæœ¬å·²ç»æœ‰ ARM çš„æ”¯æŒäº†ã€‚è‡³äº npm è¿™ä¸ªå°±å¾ˆä¸å¥½è¯´äº†ï¼Œå¤§éƒ¨åˆ†åŒ…å…¶å®éƒ½æ˜¯å¯ä»¥ç›´æ¥ import/require çš„ js æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰ç¯å¢ƒä¾èµ–ï¼Œç„¶è€Œè¿˜æ˜¯æœ‰å°‘éƒ¨åˆ†æ€ªå¼‚çš„åŒ…ï¼Œæ¯”å¦‚æˆ‘ä»¬éå¸¸å¸¸ç”¨çš„ node-sassï¼Œå®ƒåœ¨å®‰è£…çš„æ—¶å€™éœ€è¦æ ¹æ®ä½ æœ¬æœºç¯å¢ƒæ¥ç¼–è¯‘ï¼Œå› ä¸ºå¼€å‘è€…å°šæœªé€‚é…ï¼Œæ‰€ä»¥æ— æ³•è¯†åˆ«å½“å‰ environmentï¼Œè¿™æ—¶ä½ åªèƒ½æ‰‹åŠ¨ç¼–è¯‘ï¼Œéœ€è¦åˆ©ç”¨ unix çš„ arch æŒ‡ä»¤ï¼ŒåŠ ä¸Šå‰ç¼€ arch -x86_64 è¿è¡Œ npm rebuild node-sassã€‚&lt;/p&gt;

&lt;p&gt;è¯´åˆ° arch -x86_64ï¼Œå®ƒåœ¨ ARM çš„ macOS ä¸Šå…¶å®å¯ä»¥èµ·åˆ°ä¸€ç§â€œæ¬ºéª—â€çš„ä½œç”¨ï¼Œè®©ä½ çš„å‘½ä»¤å®Œå…¨é€šè¿‡ Rosetta 2 ä»¥ Intel çš„å…¼å®¹æ¨¡å¼è¿è¡Œã€‚homebrew å°±æ˜¯å¾ˆå¥½çš„ä¾‹å­ï¼Œå¼€å‘è€…å°šæœªå…¼å®¹æ—¶å¯ä»¥ä½¿ç”¨å®ƒæ¥å®‰è£…ã€‚ä¸è¿‡å…¶å®æ²¡å¿…è¦æ»¥ç”¨ï¼Œåªéœ€è¦åœ¨é‡åˆ°ä¸é€‚é…çš„æ—¶å€™ä½¿ç”¨å³å¯ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆ M1 åœ¨å®é™…å¼€å‘ä¸­æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ã€‚å‰ç«¯åœ¨å¼€å‘ä¸­éœ€è¦é«˜æ€§èƒ½è®¡ç®—çš„åœºæ™¯å…¶å®ä¸å¤šï¼Œé™¤éæ˜¯æœ‰ç‰¹æ®ŠåŠŸèƒ½éœ€æ±‚ã€‚æ¯”è¾ƒå¸¸è§çš„æƒ…å†µæ˜¯è·‘å•å…ƒæµ‹è¯•ï¼Œç”±äº Jest æ˜¯ä¼šå æ»¡æ‰€æœ‰ CPU ç‰©ç†æ ¸å¿ƒçš„ï¼Œæ‰€ä»¥è¿™è¿˜æ˜¯å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šä»å‰ç«¯è§’åº¦æ¥è¯„ä»·çš„ã€‚å®é™…ç»“æœå¤§æ¦‚æ˜¯ï¼Œæ¥è¿‘ 800 ä¸ª caseï¼ŒM1 æ¯”è¿‘ä¸¤å¹´å†…çš„ Intel çš„ Mac è¦å¿«ä¸Š 10 ç§’å·¦å³ï¼Œè€Œä¸”è¿˜èƒ½åŒæ—¶åšåˆ«çš„äº‹ï¼ˆIntel æœºå‹ä¼šå˜å¡ç”šè‡³å¯èƒ½å°±å¡å¾—åšä¸äº†åˆ«çš„äº‹äº†ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆç¼ºç‚¹è¿˜æ˜¯æœ‰çš„ï¼Œä¸€æ˜¯é›·ç”µå£éƒ½åªæœ‰ä¸¤ä¸ªï¼ŒäºŒæ˜¯ GPU æ€§èƒ½ã€‚GPU è¦æ‰“ç›®å‰çš„ä¸­é«˜ç«¯ç‹¬æ˜¾æ˜¯ä¸å¯èƒ½çš„ï¼Œä½†æ˜¯å…¶å®å‰ç«¯å¼€å‘ä¸­ç”¨ä¸åˆ°è¿™äº›ã€‚æ¯”è¾ƒå¤§çš„å½±å“å°±æ˜¯è§†é¢‘è¾“å‡ºèƒ½åŠ›ï¼ŒIntel çš„æœºå‹ç‰¹åˆ«æ˜¯å¸¦ç‹¬æ˜¾çš„ï¼Œè¾“å‡ºä¸‰å››ä¸ªé 4K åˆ†è¾¨ç‡æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ M1 æœ€å¤šåªèƒ½æ”¯æŒ 2 ä¸ªå±å¹•ï¼ˆåŒ…æ‹¬å†…å»ºçš„ï¼‰ï¼Œä¹Ÿå°±æ˜¯ MacBook åªèƒ½å¤–æ¥ä¸€ä¸ªï¼ŒMac mini å¯ä»¥ä¸¤ä¸ªä½†æ˜¯å¿…é¡» HDMI + USB-Cï¼ˆåŒ C è¿˜çœŸçš„ä¸è¡Œ[æµæ±— 2]ï¼‰ã€‚ä¼—æ‰€å‘¨çŸ¥æ˜¾ç¤ºå™¨æ•°é‡å’Œç”Ÿäº§åŠ›æˆæ­£æ¯”å…³ç³»ï¼Œæ‰€ä»¥è¿™å¯èƒ½æ˜¯ä¸ªé—®é¢˜ã€‚ä¸è¿‡å¦‚æœæœ‰ iPad Pro æˆ–è€… iPad Air 4 çš„è¯è¿˜å¯ä»¥ç”¨éšèˆªæ¥ä¸€ä¸ªã€‚&lt;/p&gt;

&lt;p&gt;å°½ç®¡æœ‰å½±å“ç”Ÿäº§åŠ›çš„å°é—®é¢˜ï¼Œæ€»ä½“æ¥è¯´æˆ‘å¯¹å®ƒçš„è¯„ä»·è¿˜æ˜¯æ­£é¢çš„ï¼Œå¯ä»¥ç«‹å³å…¥æ‰‹ä½œä¸ºç”Ÿäº§åŠ›ï¼Œå¤–æ¥æ˜¾ç¤ºå™¨çš„é—®é¢˜ç”šè‡³ä½ æƒ³ä¸ºå®ƒæ”¹å˜ä½ çš„å·¥ä½œæµæˆ‘è§‰å¾—ä¹Ÿæ˜¯å€¼çš„ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥æˆ‘å·²ç»ä¸‹å•å‡†å¤‡æŠŠæˆ‘ä»¥å‰çš„ä¸»åŠ›å·¥ä½œæœº 18 æ¬¾ 15 å¯¸ä½é… MacBook Pro æ‹¿å»å›æ”¶æŠ˜æŠµæ¢ä¸€å°æ–°çš„ä½é…ç‰ˆ M1 MacBook Air äº†ï¼Œå½“ç„¶è¿˜æ˜¯åŠ åˆ° 16G å†…å­˜ã€‚8G æˆ‘è§‰å¾—æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œå› ä¸ºæˆ‘åœ¨ä½¿ç”¨ 16G çš„ Mac mini è¿›è¡Œå¼€å‘çš„æ—¶å€™ç»å¸¸ä¼šé‡åˆ°å‰©ä½™ 5G å·¦å³çš„æƒ…å†µï¼ŒChrome å’Œ Node éƒ½éå¸¸åƒå†…å­˜ï¼Œæ‰€ä»¥ 8G å†…å­˜åº”è¯¥ä¼šéå¸¸å¡ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Apollo GraphQL åœ¨ React ä¸­çš„åº”ç”¨</title>
      <link>https://elizurhz.cn/frontend/apollo-react/</link>
      <pubDate>Fri, 22 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/frontend/apollo-react/</guid>
      <description>

&lt;p&gt;è¿™ç¯‡æ–‡ç« å¤§æ¦‚ä»‹ç»ä¸‹ GraphQL çš„ä½¿ç”¨ï¼ŒApollo çš„ä½¿ç”¨ï¼Œä»¥åŠæˆ‘åœ¨é¡¹ç›®ä¸­é‡åˆ°çš„ä¸€äº›åœºæ™¯å’Œæƒ…å†µã€‚&lt;/p&gt;

&lt;p&gt;Apollo æ˜¯ç”Ÿäº§çº§çš„ GraphQL æ¡†æ¶ï¼ˆå®˜æ–¹ç®€ä»‹ï¼‰ã€‚é‚£ä¹ˆæˆ‘ä½¿ç”¨ Apollo çš„å¥‘æœºæ˜¯ï¼Œæˆ‘ä»¬é¡¹ç›®çš„åç«¯ï¼ˆç¾å›½å›¢é˜Ÿï¼‰å·²ç»é•¿æœŸåœ¨ä½¿ç”¨ GraphQLã€‚åœ¨è¿™ä¸ªé¡¹ç›®åˆæœŸï¼Œåç«¯æ˜¯æœ‰æä¾› SDK ç»™éƒ¨åˆ†æ¥å£çš„ï¼Œä½†æ˜¯åæ¥ç”±äºä¸šåŠ¡çš„å‘å±•ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…¨éƒ¨æ¥å…¥ GraphQLï¼Œå› ä¸ºä»–ä»¬çš„å¾ˆå¤šæœåŠ¡éƒ½æ˜¯æä¾› GraphQL çš„ endpoint çš„ï¼Œå°è£…æˆ SDK ç›¸å¯¹å›°éš¾ã€‚&lt;/p&gt;

&lt;h2 id=&#34;graphql&#34;&gt;GraphQL&lt;/h2&gt;

&lt;p&gt;æ³¨ï¼šæœ¬èŠ‚ç¤ºä¾‹ä»£ç å¤§å¤šæ¥è‡ªäº &lt;a href=&#34;https://graphql.org/&#34;&gt;GraphQL å®˜ç½‘&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æåˆ° GraphQLï¼Œä¸æ˜ç™½çš„äººå¯èƒ½ä¼šè”æƒ³åˆ° SQLã€‚è¿™ç¡®å®æ²¡é”™ï¼ŒGraphQL æœ¬èº«å°±æ˜¯ä¸€ç§ query languageã€‚åœ¨ Apollo ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© &lt;code&gt;gql&lt;/code&gt; è¿™ä¸ªåŒ…æ¥å†™ queries å’Œ mutationsã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;import gql from &#39;graphql-tag&#39;

const SAMPLE_QUERY = gql`
  {
    hero {
      name
      height
    }
  }
`
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢çš„æ˜¯ä¸éœ€è¦ä¼ å…¥ä»»ä½•å‚æ•°çš„ queryã€‚è€Œæˆ‘ä»¬çŸ¥é“ï¼Œå¤§éƒ¨åˆ†æ¥å£éƒ½éœ€è¦å‚æ•°ï¼Œæ‰€ä»¥ä½¿ç”¨ &lt;code&gt;gql&lt;/code&gt; åŒ…æˆ‘ä»¬éœ€è¦è¿™ä¹ˆå†™ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;const SAMPLE_QUERY_WITH_VARIABLES = gql`
  query HeroNameAndFriends($episode: Episode) {
    hero(episode: $episode) {
      name
      friends {
        name
      }
    }
  }
`
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;HeroNameAndFriends&lt;/code&gt; åœ¨ GraphQL é‡Œå«åš &lt;code&gt;operation name&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è€Œåœ¨ GraphQL ä¸­æˆ‘ä»¬è¿˜ä¼šæœ‰ä¸€ç§å¸¸ç”¨çš„æ¨¡å¼å°±æ˜¯ Fragmentsã€‚ä»¥å®˜ç½‘çš„ä»£ç ä¸ºä¾‹ï¼Œä½¿ç”¨ &lt;code&gt;gql&lt;/code&gt; åŒ…æˆ‘ä»¬éœ€è¦è¿™ä¹ˆå†™ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;const sampleFragments = {
  fragments: {
    entry: gql`
      fragment comparisonFields on Character {
        name
        appearsIn
        friends {
          name
        }
      }
    `
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Fragments å¯ä»¥ç”¨æ¥å®šä¹‰é‡å¤ä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ä¸éœ€è¦é‡å¤å®šä¹‰è¿™äº› schemaã€‚å‡è®¾æœ‰ä¸ªé€‚ç”¨åœºæ™¯æ˜¯ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œç”¨æˆ·æœ‰ä¸€ç³»åˆ—å…±æœ‰çš„å±æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶å®šä¹‰ä¸º Fragmentsã€‚åœ¨è¿›è¡Œå„ç§ queries å’Œ mutations çš„æ—¶å€™ï¼Œä¾‹å¦‚è¯·æ±‚ç”¨æˆ·åˆ—è¡¨ã€ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ç­‰ç­‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å¼•ç”¨è¿™ä¸ª Fragmentsï¼Œè€Œä¸ç”¨é‡å¤å†™è¿™æ®µ schemaï¼Œä¾‹å¦‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;const SAMPLE_QUERY_WITH_FRAGMENTS = gql`
  query findHero($episode: Episode) {
    leftComparison: hero(episode: $episode) {
      ...comparisonFields
    }
    rightComparison: hero(episode: $episode) {
      ...comparisonFields
    }
  }
  ${sampleFragments.fragments.entry}
`
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;mutations çš„å†™æ³•å’Œ query éå¸¸ç›¸ä¼¼ï¼Œåªéœ€è¦æŠŠ &lt;code&gt;query&lt;/code&gt; å…³é”®å­—æ¢æˆ &lt;code&gt;mutation&lt;/code&gt; å³å¯ã€‚
è¿™é‡Œéå¸¸å®¹æ˜“é‡åˆ°å˜é‡åå­—å†™é”™ç­‰ç­‰é—®é¢˜ï¼Œå†™çš„æ—¶å€™è¿˜éœ€è¦ä»”ç»†å‚è€ƒæ¨¡æ¿ã€‚
å¦å¤–å…³äº GraphQL ä¸­çš„ç±»å‹ï¼Œä¾‹å¦‚ä¸Šé¢ç¤ºä¾‹ä»£ç ä¸­çš„ &lt;code&gt;Episode&lt;/code&gt; å’Œ &lt;code&gt;Character&lt;/code&gt;ï¼Œè¿™ä¸ªä¸€èˆ¬æ˜¯åœ¨åç«¯å®šä¹‰çš„ã€‚è‡³äºå¦‚ä½•è·å–ç±»å‹åï¼Œè¿™ä¸ªåç«¯æ˜¯ä¼šåœ¨ endpoint æä¾›ä¸€ä¸ª playground æ¥æ˜¾ç¤ºæœ‰å“ªäº› queries å“ªäº› mutations å¯ç”¨çš„ï¼ŒåŒ…æ‹¬éœ€è¦ä¼ çš„å‚æ•°éƒ½ä¼šå†™å‡ºæ¥ï¼Œä¹Ÿå°±ç›¸å½“äºä¸€ä¸ª API æ–‡æ¡£ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ playground ä¸Šæµ‹è¯•æˆ‘ä»¬çš„ queries å’Œ mutations æœ‰æ²¡æœ‰å†™å¯¹ã€‚å¦å¤–å…³äºå‚æ•°å’Œç±»å‹ï¼Œå¸¦æ„Ÿå¹å·çš„å°±æ˜¯å¿…ä¼ å‚æ•°ï¼Œå…¶ä»–å¹¶æ²¡æœ‰å¤ªå¤šéœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;apollo&#34;&gt;Apollo&lt;/h2&gt;

&lt;h3 id=&#34;ä½¿ç”¨&#34;&gt;ä½¿ç”¨&lt;/h3&gt;

&lt;p&gt;æ³¨ï¼šæœ¬èŠ‚ç¤ºä¾‹ä»£ç ä¸»è¦æ¥è‡ªäº &lt;a href=&#34;https://www.apollographql.com/&#34;&gt;Apollo å®˜ç½‘&lt;/a&gt;ï¼Œä»¥ 3.0beta ç‰ˆæœ¬çš„ API ä¸ºå‡†ã€‚&lt;/p&gt;

&lt;p&gt;ä¸Šé¢ç®€å•ä»‹ç»äº†ä¸‹æ€æ ·å†™ queries å’Œ mutationsï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·æ¥å‘èµ· GraphQL è¯·æ±‚ã€‚åœ¨ React ä¸­ï¼Œé™¤äº† Apolloï¼Œè¿˜æœ‰ Facebook åšçš„ Relayã€‚æˆ‘æ²¡ç”¨è¿‡ Relayï¼Œä½†æ˜¯çœ‹è¯„ä»·æ˜¯è¯´å®ƒæ¯”è¾ƒâ€œé‡â€ã€‚æœ¬æ–‡å°±ç€é‡ä»‹ç» Apolloã€‚&lt;/p&gt;

&lt;p&gt;Apollo æ˜¯ä¸ªå·¥å…·ï¼Œå®ƒæœ‰å„ç«¯çš„å®ç°ï¼Œè€Œåœ¨ React ç«¯å®ƒå¯ä»¥ä»¥ç»„ä»¶çš„å½¢å¼å­˜åœ¨äº App ä¸­ã€‚è¦ä½¿ç”¨ Apolloï¼Œæˆ‘ä»¬éœ€è¦å…ˆåšä¸¤ä»¶äº‹ï¼šå†™åˆ›å»º &lt;code&gt;ApolloClient&lt;/code&gt; çš„ä»£ç ï¼Œå’Œå°† &lt;code&gt;ApolloProvider&lt;/code&gt; åŠ å…¥åˆ°ç»„ä»¶æ ‘ä¸­ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;/** apolloClient.js */
import { ApolloClient } from &#39;apollo-client&#39;;
import { InMemoryCache } from &#39;apollo-cache-inmemory&#39;;
import { HttpLink } from &#39;apollo-link-http&#39;;

// Instantiate required constructor fields
const cache = new InMemoryCache();
const link = new HttpLink({
  uri: &#39;http://yourbackendendpoint.com/graphql&#39;,
});

const client = new ApolloClient({
  // Provide required constructor fields
  cache: cache,
  link: link,

  // Provide some optional constructor fields
  name: &#39;react-web-client&#39;,
  version: &#39;1.3&#39;,
  queryDeduplication: false,
  defaultOptions: {
    watchQuery: {
      fetchPolicy: &#39;cache-and-network&#39;,
    },
  },
});

export default client
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼åˆ›å»ºä¸€ä¸ª &lt;code&gt;ApolloClient&lt;/code&gt;ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä¸­å¼•ç”¨å®ƒï¼Œå› ä¸º &lt;code&gt;ApolloProvider&lt;/code&gt; éœ€è¦å®ƒä½œä¸º prop ä¼ å…¥ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JSX&#34;&gt;import React from &#39;react&#39;;
import { render } from &#39;react-dom&#39;;
import client from &#39;./client&#39; // sample

import { ApolloProvider } from &#39;@apollo/react-hooks&#39;;

const App = () =&amp;gt; (
  &amp;lt;ApolloProvider client={client}&amp;gt;
    &amp;lt;div&amp;gt;
      &amp;lt;h2&amp;gt;My first Apollo app ğŸš€&amp;lt;/h2&amp;gt;
    &amp;lt;/div&amp;gt;
  &amp;lt;/ApolloProvider&amp;gt;
);

render(&amp;lt;App /&amp;gt;, document.getElementById(&#39;root&#39;));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é¢˜å¤–è¯ï¼šéœ€è¦æ³¨æ„ä¸€ä¸‹ &lt;code&gt;ApolloProvider&lt;/code&gt; æ³¨å…¥çš„ä½ç½®ï¼ŒåŒæ—¶åˆ›å»º &lt;code&gt;ApolloClient&lt;/code&gt; çš„æ—¶å€™éœ€è¦å¯¼å‡ºä¸€ä¸ªåˆ›å»º client çš„å‡½æ•°ï¼ˆå¦‚æœä¸šåŠ¡å®šåˆ¶è¾ƒä¸ºå¤æ‚çš„è¯å¯èƒ½éœ€è¦è¿™ä¹ˆåšï¼Œä¾‹å¦‚ç»‘å®šé€šç”¨çš„é”™è¯¯å¤„ç†å’Œå›½é™…åŒ–ï¼‰æ—¶ï¼Œéœ€è¦é˜²æ­¢ &lt;code&gt;ApolloProvider&lt;/code&gt; re-render å¯¼è‡´çš„ &lt;code&gt;ApolloClient&lt;/code&gt; è¢«é‡å¤åˆ›å»ºï¼Œå› ä¸ºè¿™æ ·ç›¸å½“äºä¼šæ¸…ç©º Apollo çš„ç¼“å­˜ï¼Œå¯¼è‡´é¢å¤–ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚ã€‚ç¼“å­˜ç›¸å…³çš„å†…å®¹ä¼šåœ¨ä¸‹é¢æåˆ°ã€‚&lt;/p&gt;

&lt;p&gt;è€Œå¦‚æœæˆ‘ä»¬è¦å‘èµ·è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ Apollo æä¾›çš„ APIã€‚Apollo æä¾›äº† &lt;code&gt;&amp;lt;Query /&amp;gt;&lt;/code&gt; å’Œ &lt;code&gt;&amp;lt;Mutation /&amp;gt;&lt;/code&gt; çš„ç»„ä»¶ï¼Œå®ƒä»¬æ˜¯ä»¥ render callback çš„æ¨¡å¼æ¥åº”ç”¨çš„ã€‚è€Œæˆ‘åœ¨é¡¹ç›®ä¸­ä¸»è¦è¿ç”¨äº† hooksã€‚Apollo çš„ hooks ä¸»è¦å¸¸ç”¨çš„æœ‰ 3 ä¸ªï¼Œåˆ†åˆ«æ˜¯ &lt;code&gt;useQuery&lt;/code&gt;, &lt;code&gt;useLazyQuery&lt;/code&gt; å’Œ &lt;code&gt;useMutation&lt;/code&gt;ã€‚&lt;code&gt;useQuery&lt;/code&gt; å’Œ &lt;code&gt;useLazyQuery&lt;/code&gt; çš„åŒºåˆ«æ˜¯ï¼Œ&lt;code&gt;useQuery&lt;/code&gt; åœ¨ç»„ä»¶ render/re-render çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰§è¡Œï¼ˆå‘èµ·è¯·æ±‚ï¼‰ï¼Œè€Œ &lt;code&gt;useLazyQuery&lt;/code&gt; åˆ™å…è®¸ç”¨æˆ·åœ¨ç‰¹å®šçš„æ—¶å€™è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥å‘èµ·è¯·æ±‚ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JSX&#34;&gt;/** useQuery */
import { gql, useQuery } from &#39;@apollo/client&#39;; // æ³¨ï¼š 3.0beta å°† gql æ•´åˆè‡³ @apollo/client åŒ…ä¸­ï¼Œå’Œä¸Šæ–‡çš„ä» &#39;graphql-tag&#39; åŒ…ä¸­å¼•ç”¨çš„æ–¹å¼å¹¶ä¸å†²çª

const GET_GREETING = gql`
  query GetGreeting($language: String!) {
    greeting(language: $language) {
      message
    }
  }
`;

function Hello() {
  const { loading, error, data } = useQuery(GET_GREETING, {
    variables: { language: &#39;english&#39; },
  });
  if (loading) return &amp;lt;p&amp;gt;Loading ...&amp;lt;/p&amp;gt;;
  return &amp;lt;h1&amp;gt;Hello {data.greeting.message}!&amp;lt;/h1&amp;gt;;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-JSX&#34;&gt;/** useLazyQuery */
import { gql, useLazyQuery } from &amp;quot;@apollo/client&amp;quot;;

const GET_GREETING = gql`
  query GetGreeting($language: String!) {
    greeting(language: $language) {
      message
    }
  }
`;

function Hello() {
  const [loadGreeting, { called, loading, data }] = useLazyQuery(
    GET_GREETING,
    { variables: { language: &amp;quot;english&amp;quot; } }
  );
  if (called &amp;amp;&amp;amp; loading) return &amp;lt;p&amp;gt;Loading ...&amp;lt;/p&amp;gt;
  if (!called) {
    return &amp;lt;button onClick={() =&amp;gt; loadGreeting()}&amp;gt;Load greeting&amp;lt;/button&amp;gt;
  }
  return &amp;lt;h1&amp;gt;Hello {data.greeting.message}!&amp;lt;/h1&amp;gt;;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-JSX&#34;&gt;/** useMutation */
import { gql, useMutation } from &#39;@apollo/client&#39;;

const ADD_TODO = gql`
  mutation AddTodo($type: String!) {
    addTodo(type: $type) {
      id
      type
    }
  }
`;

function AddTodo() {
  let input;
  const [addTodo, { data }] = useMutation(ADD_TODO);

  return (
    &amp;lt;div&amp;gt;
      &amp;lt;form
        onSubmit={e =&amp;gt; {
          e.preventDefault();
          addTodo({ variables: { type: input.value } });
          input.value = &#39;&#39;;
        }}
      &amp;gt;
        &amp;lt;input
          ref={node =&amp;gt; {
            input = node;
          }}
        /&amp;gt;
        &amp;lt;button type=&amp;quot;submit&amp;quot;&amp;gt;Add Todo&amp;lt;/button&amp;gt;
      &amp;lt;/form&amp;gt;
    &amp;lt;/div&amp;gt;
  );
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢åˆ†åˆ«å±•ç¤ºäº† &lt;code&gt;useQuery&lt;/code&gt;, &lt;code&gt;useLazyQuery&lt;/code&gt; å’Œ &lt;code&gt;useMutation&lt;/code&gt; çš„ç”¨æ³•ã€‚å¦‚æœäº†è§£ hooks çš„è¯ï¼Œå‚è€ƒ Apollo çš„ API æ–‡æ¡£åº”è¯¥ä¸Šæ‰‹éš¾åº¦ä¸å¤§ã€‚é‚£ä¹ˆåœ¨ä¸Šä¸€èŠ‚æåˆ°çš„è¯·æ±‚å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™è¾¹ä»¥ &lt;code&gt;variables&lt;/code&gt; ä¼ å…¥ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;const [loadGreeting, { called, loading, data }] = useLazyQuery(
  GET_GREETING,
  { variables: { language: &amp;quot;english&amp;quot; } } // å‚æ•°
)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è€Œåœ¨ Apollo ä¸­ï¼Œ&lt;code&gt;options&lt;/code&gt; æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒå¯ä»¥å®šåˆ¶ queries å’Œ mutations çš„è¡Œä¸ºã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ&lt;code&gt;variables&lt;/code&gt; å…¶å®å°±æ˜¯ &lt;code&gt;options&lt;/code&gt; çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ queries ä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;notifyOnNetworkStatusChange: &lt;code&gt;networkStatus&lt;/code&gt; å˜åŒ–çš„æ—¶å€™æ˜¯å¦éœ€è¦ re-render ç»„ä»¶&lt;/li&gt;
&lt;li&gt;fetchPolicy: è¿™å…³ç³»åˆ° Apollo ä¼šä¸ä¼šç¼“å­˜æ•°æ®ã€‚è®¾ç½®ä¸º &lt;code&gt;cache-first&lt;/code&gt; çš„è¯ï¼Œé’ˆå¯¹åŒæ ·çš„è¯·æ±‚å‚æ•°ï¼ŒApollo ä¼šç›´æ¥è¯»å– client ä¸­çš„ç¼“å­˜è€Œä¸ä¼šé‡æ–°è¯·æ±‚ï¼›è®¾ç½®ä¸º &lt;code&gt;network-only&lt;/code&gt; çš„è¯ï¼Œåˆ™ä¼šæ¯æ¬¡éƒ½è¯·æ±‚æ–°çš„æ•°æ®&lt;/li&gt;
&lt;li&gt;pollInterval: è½®è¯¢é—´éš”æ—¶é—´ã€‚è™½ç„¶æˆ‘ä»¬å¸¸è§„çš„ä¸šåŠ¡ä¸éœ€è¦è½®è¯¢ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°å…¶å®æ˜¯å¯ä»¥ç”¨ä½œåˆ·æ–°ç­–ç•¥çš„&lt;/li&gt;
&lt;li&gt;onCompleted: è¯·æ±‚å®Œæˆåçš„å›è°ƒã€‚æˆ‘ä¸€èˆ¬æ¯”è¾ƒå°‘ç”¨è¿™ä¸ªï¼Œå› ä¸ºä¹‹å‰æœ‰å‘ç°å®ƒä¼šè¢«é‡å¤è°ƒç”¨çš„ bugã€‚ç›‘å¬æ•°æ®çŠ¶æ€å…¶å®å¯ä»¥ç®€å•åœ°ç”¨ &lt;code&gt;useEffect&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é‚£ä¹ˆè¿™äº›å‚æ•°å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬æœ‰ä¸ªåœºæ™¯ï¼Œåœ¨ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨æ‰“å¼€ä¸€ä¸ªå¼¹çª—ï¼Œä¿®æ”¹ç”¨æˆ·ä¿¡æ¯åéœ€è¦é‡æ–°è·å–ç”¨æˆ·åˆ—è¡¨ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JSX&#34;&gt;import React, { useState, useEffect } from &#39;react&#39;

const UserModule = () =&amp;gt; {
  const [pollInterval, setPollInterval] = useState(0)

  const [updateUserInfo, { data: mutationData }] = useMutation(UPDATE_USER_INFO); // updateUserInfo ä¼šåœ¨æŸå¤„è¢«è°ƒç”¨

  const [called, loading, data] = useQuery(
    GET_USERS,
    {
      variables: {}, // çœç•¥
      pollInterval
    }
  )

  useEffect(() =&amp;gt; {
    // mutation æˆåŠŸ
    if (mutationData.res === &#39;success&#39;) {
      setPollInterval(500)
    }
  }, [mutationData])

  useEffect(() =&amp;gt; {
    // é‡ç½® pollInterval é˜²æ­¢é‡å¤è¯·æ±‚
    if (data &amp;amp;&amp;amp; pollInterval !== 0) {
      setPollInterval(0)
    }
  }, [data])

  // æ•°æ®å¤„ç†å’Œæ¸²æŸ“å°±ä¸å®ç°äº†
  return &amp;lt;&amp;gt;&amp;lt;/&amp;gt;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢çš„ä»£ç é€»è¾‘æ˜¯ï¼šå‘èµ· &lt;code&gt;UPDATE_USER_INFO&lt;/code&gt; çš„ mutationï¼Œè¯·æ±‚æˆåŠŸåå°† &lt;code&gt;pollInterval&lt;/code&gt; è®¾ç½®æˆ 500msï¼Œè¿™æ · &lt;code&gt;GET_USERS&lt;/code&gt; çš„ query å°±ä¼šåœ¨ 500ms åé‡æ–°è¯·æ±‚ã€‚è¿™ä¸ªé‡æ–°è¯·æ±‚æ˜¯æ— è§†ç¼“å­˜çš„ï¼Œå°±ç®—ä½ è®¾ç½®ç¼“å­˜ä¸º &lt;code&gt;cache-first&lt;/code&gt; ä¹Ÿä¼šé‡æ–°è¯·æ±‚ã€‚è€Œ &lt;code&gt;fetchPolicy&lt;/code&gt; ä¸»è¦å½±å“çš„æ˜¯ &lt;code&gt;variables&lt;/code&gt; å˜åŒ–å¯¼è‡´çš„è¡Œä¸ºï¼Œä¾‹å¦‚è¯·æ±‚ä¸€ä¸ªç”¨æˆ·è¡¨æ ¼ä¼šæœ‰ä¸åŒé¡µç ã€æ¯é¡µæ•°é‡ã€æ’åºå­—æ®µã€è¿‡æ»¤å­—æ®µç­‰å‚æ•°ï¼Œä½¿ç”¨åŒæ ·çš„å‚æ•°æ˜¯è¯»å–ç¼“å­˜è¿˜æ˜¯é‡æ–°è·å–æ•°æ®ã€‚æ¥ç€æˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªæ—¶æœºå°† &lt;code&gt;pollInterval&lt;/code&gt; é‡æ–°è®¾ç½®æˆ 0ï¼Œé˜²æ­¢æ— é™å¾ªç¯çš„è¯·æ±‚ã€‚å¦å¤–å»ºè®®ä¸è¦åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨ &lt;code&gt;setTimeout&lt;/code&gt; å»è®¾ç½® &lt;code&gt;pollInterval&lt;/code&gt;ï¼Œå› ä¸ºæˆ‘ä»¬çœ‹ä¸Šé¢çš„ä»£ç æ¶‰åŠåˆ°äº†å¾ˆå¤š state å˜åŒ–å’Œ effectsï¼Œè¿™äº›åœ¨ React ä¸­æŸç§ç¨‹åº¦ä¸Šæ˜¯â€œå¼‚æ­¥â€çš„ï¼Œå¦‚æœåœ¨ä¸šåŠ¡å¾ˆå¤æ‚çš„åœºæ™¯ä¸‹ä½¿ç”¨ &lt;code&gt;setTimeout&lt;/code&gt;ï¼Œåè€Œä¼šå¯¼è‡´ç»„ä»¶çš„è¡Œä¸ºéš¾ä»¥æ§åˆ¶ï¼Œè€Œä¸”ä¹Ÿå¯èƒ½ä¼šå‡ºç°åœ¨å·²ç» unmounted çš„ç»„ä»¶ä¸Šæ›´æ–° state çš„ errorï¼Œå°½ç®¡å¯¹ç”¨æˆ·ä½¿ç”¨çš„å½±å“ä¸å¤§ï¼Œä½†æ˜¯å¯¹æ€§èƒ½æ˜¯ä¸åˆ©çš„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å•å…ƒæµ‹è¯•&#34;&gt;å•å…ƒæµ‹è¯•&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬çŸ¥é“ React ç»„ä»¶çš„å•å…ƒæµ‹è¯•å¯ä»¥ç”¨ jest + enzyme æ¥å®Œæˆã€‚å•å…ƒæµ‹è¯•çš„æ—¶å€™æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨ shallow renderã€‚è€Œåœ¨ä½¿ç”¨äº† Apollo ç›¸å…³çš„ API æ¯”å¦‚ hooks ä¹‹åï¼Œjest ä¼šæç¤ºæˆ‘ä»¬è¯¥ç»„ä»¶æ²¡æœ‰ &lt;code&gt;ApolloProvider&lt;/code&gt;ï¼Œè¿™äº› Apollo ç›¸å…³çš„ API åªèƒ½åœ¨ &lt;code&gt;ApolloProvider&lt;/code&gt; å†…ä½¿ç”¨ã€‚Apollo ä¹Ÿæä¾›äº†ç”¨äºæµ‹è¯•çš„ APIï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;import { MockedProvider } from &amp;quot;@apollo/client/testing&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å…·ä½“ä½¿ç”¨ä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;import { MockedProvider } from &amp;quot;@apollo/client/testing&amp;quot;;
import { mount } from &#39;enzyme&#39;

const mocks = [
  {
    request: {
      query: SOME_QUERY,
      variables: { first: 4 }
    },
    result: {
      data: {
        dog: {
          name: &amp;quot;Douglas&amp;quot;
        }
      }
    }
  },
  {
    request: {
      query: SOME_QUERY,
      variables: { first: 8}
    },
    error: new Error(&amp;quot;Something went wrong&amp;quot;)
  }
]

it(&amp;quot;runs the mocked query&amp;quot;, () =&amp;gt; {
  const wrapper = mount(
    &amp;lt;MockedProvider mocks={mocks}&amp;gt;
      &amp;lt;MyQueryComponent /&amp;gt;
    &amp;lt;/MockedProvider&amp;gt;
  )
  // Run assertions on &amp;lt;MyQueryComponent/&amp;gt;
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœä½ æ˜¯æŠŠç»„ä»¶å®é™…æ¸²æŸ“çš„éƒ¨åˆ†å’Œ &lt;code&gt;MockedProvider&lt;/code&gt; å†™åœ¨åŒä¸€ä¸ªç»„ä»¶å†…ï¼Œé‚£ä¹ˆæµ‹è¯•çš„æ—¶å€™éœ€è¦ç”¨ &lt;code&gt;mount&lt;/code&gt;ï¼Œå¦åˆ™æ— æ³•å°†ç»„ä»¶å†…éƒ¨çš„å†…å®¹æ¸²æŸ“å‡ºæ¥ã€‚å¯¹æµ‹è¯•æ¯”è¾ƒå‹å¥½çš„æ–¹å¼å¯èƒ½æ˜¯ï¼Œå°† queries/mutations çš„éƒ¨åˆ†ç‹¬ç«‹å‡ºæ¥åšä¸€ä¸ª container ç»„ä»¶ï¼Œæ¸²æŸ“éƒ¨åˆ†ä½œä¸º dumb ç»„ä»¶ã€‚ä½†æ˜¯è¿™å…·ä½“å¾—çœ‹è¿™æ–¹é¢çš„éœ€æ±‚å’Œä»£ç è§„èŒƒæ˜¯æ€ä¹ˆåˆ¶å®šçš„ã€‚&lt;/p&gt;

&lt;p&gt;ç›®å‰è¿™ä¸ªæµ‹è¯•å¯èƒ½è¿˜æ˜¯æœ‰ç‚¹ bug çš„çŠ¶æ€ï¼Œæˆ‘ç›®å‰é¡¹ç›®è¿˜æ²¡è¿ç§»åˆ° 3.0betaï¼Œæ‰€ä»¥ä¸å¤§æ¸…æ¥šä¼šä¸ä¼šåœ¨æ–°ç‰ˆä¿®å¤ã€‚æˆ‘åœ¨æ—§ç‰ˆä¸­é‡åˆ°è¿‡å‡ ç§æƒ…å†µï¼Œä¾‹å¦‚ mock çš„æ•°æ®éƒ½å†™å¯¹ï¼Œä½†å®é™…ä¸Šè¿”å›äº† network errorï¼Œæç¤ºå‚æ•°æœ‰é—®é¢˜ï¼›è¿˜æœ‰é‡åˆ°è¿‡ mocks é‡Œå†™ä¸¤ä¸ªå¯¹è±¡ä¼šå‡ºç°è¯»å–é”™è¯¯çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ä¸æ–¹ä¾¿åŒæ—¶ mock å¤šä¸ª queries/mutationsã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>é‡æ–°äº†è§£ React - React Fiber</title>
      <link>https://elizurhz.cn/frontend/react-fiber/</link>
      <pubDate>Sat, 12 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/frontend/react-fiber/</guid>
      <description>

&lt;h1 id=&#34;tl-dr&#34;&gt;TL;DR&lt;/h1&gt;

&lt;p&gt;æˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨ React å¤§æ¦‚æ˜¯åœ¨ 2017 å¹´å§ï¼Œé‚£ä¸ªæ—¶å€™å¤§æ¦‚æ˜¯ React v15 çš„æ—¶ä»£ã€‚æˆ‘å­¦ React çš„æ–¹æ³•ç¡®å®å¾ˆæ™®é€šï¼Œä»ä¾‹å­å…¥æ‰‹ï¼Œè®©ä»£ç èƒ½å¤Ÿè·‘èµ·æ¥è€Œå·²ã€‚æ¥ç€å°±æ˜¯çœ‹å„ç§å®æˆ˜å’Œå¼€æºçš„ sampleã€‚ç„¶åæˆ‘åœ¨ä»»èŒçš„ç¬¬ä¸€å®¶å…¬å¸ï¼Œä»ä¸çŸ¥é“æ€ä¹ˆå®šä½çš„å¤§å­¦åˆšæ¯•ä¸šçš„æ–°äººï¼Œæ­£å¼è½¬å²—åˆ°å‰ç«¯ã€‚é‚£ä¸ªæ—¶å€™åœ¨åš Vue çš„é¡¹ç›®ï¼ˆæˆ‘ç¡•å£«çš„æ—¶å€™åœ¨å­¦æ ¡å°±æœ‰åœ¨åš Vue çš„é¡¹ç›®äº†ï¼‰ï¼Œä¹Ÿæœ‰å¹¸ç¢°åˆ°äº†å‡ ä½æœ‰ç‚¹ç»éªŒçš„å‰ç«¯ï¼Œç¨å¾®å­¦äº†å­¦ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®æ˜¯æ€æ ·çš„æ„æ¶ã€‚æ¥ç€å°±æ˜¯è·³æ§½ï¼ŒèƒŒäº†ä¸€å¤§å †åº”ä»˜é¢è¯•çš„ä¸œè¥¿ï¼ŒåŒ…æ‹¬ React çš„ä¸€äº›ä¸œè¥¿ï¼Œç»“æœå‘ç°å®é™…é¢è¯•çš„æ•ˆæœå´ä¸ç†æƒ³ã€‚ç”±äºä¸€ç›´åœ¨å°å…¬å¸ï¼Œä¸€ç›´è¿½æ±‚åŠŸèƒ½çš„å‘å¸ƒä¸Šçº¿ï¼Œè€Œä¸æ˜¯åŸç†å’Œæ€§èƒ½ï¼Œå› æ­¤æˆ‘æ ¹æœ¬æ²¡æœ‰ä»€ä¹ˆæœºä¼šå»å­¦ä¹ ã€è¿ç”¨è¿™äº›çŸ¥è¯†ã€‚å°±è¿™æ ·ï¼Œæˆ‘åˆ°äº†ç½‘é¾™ï¼Œåœ¨ç½‘é¾™å‰å‰ååä¹Ÿåšäº†å‡ ä¸ªé¡¹ç›®ã€‚å¤§å…¬å¸é‡Œï¼ŒåŒäº‹çš„æ°´å¹³ç¡®å®ä¸å¤ªä¸€æ ·ï¼Œå¤§å®¶ä¹Ÿä¼šæ›´å¤šå…³æ³¨è¿™äº›æ–¹é¢çš„ä¸œè¥¿ã€‚ç‰¹åˆ«æ˜¯æœ€è¿‘åšäº†æ–°çš„é¡¹ç›®ï¼Œæˆ‘ç®—æ˜¯é¡¹ç›®ä» 0 å¼€å§‹æ­å»ºçš„ä¸»åŠ›äº†ã€‚æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ç”¨äº†æœ€æ–°çš„æŠ€æœ¯ï¼ŒåŒ…æ‹¬ Hooks è¿™ç§ç¤¾åŒºä¸­è¿˜æ²¡æœ‰å¤§è§„æ¨¡æŠ•å…¥ç”Ÿäº§çš„æŠ€æœ¯ï¼Œæˆ‘ä¹Ÿå‘ç°æˆ‘åœ¨æŠ€æœ¯ä¸Šå…¶å®å­˜åœ¨å¾ˆå¤šçš„ä¸è¶³ã€‚åœ¨å·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ¬¡æ¬¡åœ°çœ‹æ–‡æ¡£ã€ä¸€æ¬¡æ¬¡åœ°ä¸åŒäº‹äº¤æµï¼Œèƒ½ä¸€æ¬¡æ¬¡åœ°å­¦åˆ°æ–°ä¸œè¥¿ï¼Œä¹Ÿå‘ç°å…¶å®å¾ˆæœ‰å¿…è¦æŠŠè¿™äº›ä¸œè¥¿æ€»ç»“èµ·æ¥ã€‚&lt;/p&gt;

&lt;h1 id=&#34;è¿˜åœ¨è°ˆ-react-çš„-diff-ç®—æ³•å’Œè™šæ‹Ÿ-dom-ä½ å¯èƒ½å·²ç»-out-äº†&#34;&gt;è¿˜åœ¨è°ˆ React çš„ diff ç®—æ³•å’Œè™šæ‹Ÿ DOMï¼Ÿä½ å¯èƒ½å·²ç» Out äº†ï¼&lt;/h1&gt;

&lt;p&gt;2018 å¹´åˆå’Œå¹´ä¸­æˆ‘ç»å†è¿‡ä¸€äº›é¢è¯•ï¼ŒReact çš„ diff ç®—æ³•å’Œè™šæ‹Ÿ DOM å…¶å®æ˜¯é‡åˆ°å¾—æ¯”è¾ƒå¤šçš„ React çš„åŸç†çš„é¢è¯•é¢˜ï¼Œå½“ç„¶è¿™äº›çŸ¥è¯†ä»ä¸€äº›ä¸“é—¨è®²é¢è¯•çš„æ–‡ç« é‡Œå¯ä»¥çœ‹åˆ°ã€‚å…¶å®å¾ˆå¤šäººéƒ½ä¼šä¸ºäº†å‡†å¤‡é¢è¯•è€Œå»èƒŒè¿™äº›åŸç†ï¼ŒåŒ…æ‹¬æˆ‘ã€‚ä¸è¿‡è¯´å®è¯ï¼Œé‡Œé¢æœ‰äº›ä¸œè¥¿ç¡®å®å¼€å‘ä¸­æœ‰ç”¨ï¼Œä¾‹å¦‚åˆ—è¡¨æ¸²æŸ“æ—¶ key çš„ä½¿ç”¨ï¼Œä»¥åŠæ‰¾å‡ºä¸ºä»€ä¹ˆåˆ—è¡¨æ¸²æŸ“æ—¶æ•°æ®ä¸ä¼šå˜åŒ–çš„é—®é¢˜ã€‚ä½†æ˜¯çœŸçš„è¦è®¤çœŸè®¨è®ºèµ·æ¥ï¼Œå…¶å®æœ‰ä¸€äº›æ¦‚å¿µå¹¶ä¸å®Œå…¨æ­£ç¡®ï¼Œæ¯”å¦‚â€œè™šæ‹Ÿ DOMâ€ï¼š
React ä¸­æœ‰ reconcilerï¼Œå®ƒæ˜¯è´Ÿè´£è¿è¡Œ diff ç®—æ³•çš„ã€‚å®ƒä»…ä»…ç›¸å½“äºä¸€ä¸ªè¿ç®—å™¨ï¼Œæœ€ç»ˆçš„æ¸²æŸ“éœ€è¦é ä¸€ä¸ªæ¸²æŸ“ç¯å¢ƒæ¥å®Œæˆï¼Œä¾‹å¦‚æµè§ˆå™¨çš„ DOM ç¯å¢ƒã€‚æˆ‘ä»¬æŠŠå®ƒç§°ä½œâ€œè™šæ‹Ÿ DOMâ€ä¸è¿‡æ˜¯å› ä¸ºè¿™ä¸ªåè¯ä½¿ç”¨å¾ˆå¹¿æ³›è€Œå·²ï¼Œè€Œå®ƒå®é™…ä¸Šæ˜¯ä¸ª Tree è€Œå·²ã€‚React Native ä¹Ÿç”¨å®ƒï¼Œåœ¨ React Native ä¸­æˆ‘ä»¬å¯èƒ½ä¸åº”è¯¥æŠŠå®ƒç§°ä½œä¸ºâ€œè™šæ‹Ÿ DOMâ€ï¼Œå› ä¸º React Native ä¸­å¹¶æ²¡æœ‰ DOMï¼Œè€Œæ˜¯ä¼šæ¸²æŸ“æˆåŸç”Ÿæ§ä»¶ã€‚&lt;/p&gt;

&lt;h1 id=&#34;ä»-diff-ç®—æ³•-è¯´èµ·&#34;&gt;ä»â€œdiff ç®—æ³•â€è¯´èµ·&lt;/h1&gt;

&lt;p&gt;å…¶å® diff è¿™ä¸ªæ¦‚å¿µå¹¶ä¸æ˜¯å¾ˆä¸¥æ ¼åœ°èƒ½ä»£æŒ‡æˆ‘ä»¬ç°åœ¨çš„åœºæ™¯ã€‚&lt;a href=&#34;https://en.wikipedia.org/wiki/Diff&#34;&gt;Wikipedia&lt;/a&gt; ä¸Š diff çš„å®šä¹‰æ˜¯ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;In computing, the diff utility is a data comparison tool that calculates and displays the differences between two files.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è€Œ &lt;a href=&#34;https://reactjs.org/docs/reconciliation.html&#34;&gt;React å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ä¸­æåˆ°çš„ &lt;code&gt;â€œdiffingâ€ algorithm&lt;/code&gt; å…¶å®æ˜¯æ¥è‡ªäº&lt;a href=&#34;https://grfia.dlsi.ua.es/ml/algorithms/references/editsurvey_bille.pdf&#34;&gt;è¿™ç¯‡è®ºæ–‡&lt;/a&gt;ï¼Œæ˜¯è®¡ç®—&lt;strong&gt;ä»ä¸€æ£µæ ‘è½¬å˜æˆå¦ä¸€æ£µæ ‘éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°&lt;/strong&gt;çš„ state of the art çš„ç®—æ³•ï¼Œç®—æ³•å¤æ‚åº¦æ˜¯ O(nÂ³)ã€‚React å›¢é˜Ÿå¯¹å®ƒåšäº†æ”¹è¿›ï¼Œå®ç°äº†å¯å‘å¼çš„ O(n) çš„ç®—æ³•ï¼Œ&lt;strong&gt;è¿™ä¸ªç®—æ³•å«åš &lt;a href=&#34;https://reactjs.org/docs/reconciliation.html&#34;&gt;Reconciliation&lt;/a&gt;&lt;/strong&gt;ã€‚&lt;code&gt;Reconciliation&lt;/code&gt; è¿™ä¸ªåè¯å¾ˆå°‘åœ¨ä¸­æ–‡ç¤¾åŒºè¢«æåˆ°ï¼Œæˆ‘ä¹Ÿæ˜¯çœ‹äº† React Fiber çš„ç›¸å…³æ–‡ç« æ‰çŸ¥é“å®ƒçš„ï¼Œç„¶è€Œå®ƒå¯æ˜¯å¤©å¤©è¢«é¢è¯•å®˜é—®åˆ°çš„ä¸œè¥¿å•Šï¼ä¸çŸ¥é“æ˜¯å¤§å®¶è‹±æ–‡ä¸å¥½è¿˜æ˜¯æ€ä¹ˆçš„ï¼Œåœ¨äºŒæ¬¡ä¼ æ’­çš„è¿‡ç¨‹ä¸­ç«Ÿç„¶æŠŠè¿™ä¸œè¥¿ç»™å¿½ç•¥æ‰äº†ã€‚è¿™æ ·çš„äºŒæ¬¡ä¼ æ’­å…¶å®æ˜¯ä¸å‹å¥½çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆéƒ½æ¨èå»é˜…è¯»è‹±æ–‡æ–‡æ¡£ã€‚è€Œ Reconciliation å…·ä½“çš„ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Œæƒ³å¿…å¤§å®¶éƒ½åº”è¯¥äº†ç„¶äºèƒ¸äº†ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;åœ¨æ¯”è¾ƒä¸­é‡åˆ°ä¸åŒçš„çš„ DOM Element æˆ–è€… Component ä¼šç›´æ¥é‡å»ºè¯¥å­æ ‘&lt;/li&gt;
&lt;li&gt;ç›¸åŒ type çš„å…ƒç´ åˆ™ä¸ä¼šï¼Œä½†æ˜¯ä¼šåˆ¤æ–­æ˜¯å¦é‡æ¸²æŸ“ã€‚å®˜æ–¹æ–‡æ¡£è¯´çš„æ˜¯ &amp;ldquo;React updates the props of the underlying component instance to match the new element, and calls componentWillReceiveProps() and componentWillUpdate() on the underlying instance.&amp;ldquo;ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡æ¡£åº”è¯¥æ˜¯å¾ˆæ—©å†™çš„ï¼Œv16.3 ä»¥ååº”è¯¥æœ‰æ‰€å˜åŒ–äº†ï¼Œé¦–å…ˆæˆ‘ä»¬æœ‰ç”¨äºä¼˜åŒ–çš„ PureComponentã€shouldComponentUpdateã€React.memo ç­‰æ–¹å¼ï¼Œå…¶æ¬¡ componentWillReceiveProps() and componentWillUpdate() å³å°† deprecated äº†&lt;/li&gt;
&lt;li&gt;é‡åˆ°åŒç±»ä½†ä¸åŒ key çš„å…ƒç´ ä¼šç›´æ¥é‡å»ºè¯¥å­æ ‘ï¼Œåä¹‹åˆ™ä¸ä¼š&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;â€œdiff ç®—æ³•â€åœ¨ v16.8 ä¸­å½“ç„¶è¿˜æ˜¯æœ‰ç”¨çš„ï¼Œä½†æ˜¯ç°åœ¨çš„ React æ¸²æŸ“æ²¡æœ‰è¿™ä¹ˆç®€å•äº†ï¼å¦‚æœç»§ç»­ä½¿ç”¨â€œdiff ç®—æ³•â€ï¼Œé‚£åœ¨æ¸²æŸ“å¤§é‡å…ƒç´ çš„æ—¶å€™ä¼šå‡ºç°ä¸¥é‡çš„â€œæ‰å¸§â€ç°è±¡ã€‚è€Œ React å›¢é˜Ÿåœ¨ v16 å‘å¸ƒçš„æ—¶å€™å°±å·²ç»å¯¹æ¸²æŸ“ç®—æ³•è¿›è¡Œäº†é‡æ„ã€‚æ‰€ä»¥ç°åœ¨ä½ è¿˜åªåœç•™åœ¨â€œdiff ç®—æ³•â€ä¸­çš„è¯ï¼Œä½ å°± out äº†ï¼&lt;/p&gt;

&lt;h1 id=&#34;react-fiber&#34;&gt;React Fiber&lt;/h1&gt;

&lt;p&gt;åœ¨ React ä¸­ï¼Œæœ‰ä¸€ä¸ª Reconcilerï¼Œå®ƒå°±æ˜¯è´Ÿè´£è¿è¡Œ reconciliation ç®—æ³•çš„ã€‚åœ¨ React v15 ä»¥åŠæ›´æ—©çš„ç‰ˆæœ¬ï¼ŒReact ä½¿ç”¨çš„æ˜¯ Stack Reconcilerï¼Œè€Œ v16 å¼€å§‹ä½¿ç”¨çš„åˆ™æ˜¯ Fiber Reconcilerï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„â€œReact Fiberâ€ã€‚&lt;/p&gt;

&lt;h2 id=&#34;why-react-fiber&#34;&gt;Why React Fiber&lt;/h2&gt;

&lt;p&gt;ç®€å•æ€»ç»“ä¸‹å°±æ˜¯ï¼šStack Reconciler ï¼ˆReact v16 ä»¥å‰ï¼‰åœ¨æ‰§è¡Œæ¸²æŸ“çš„æ—¶å€™ï¼Œä¼šå ç”¨æµè§ˆå™¨çš„ä¸»çº¿ç¨‹ï¼Œç›´åˆ°æ¸²æŸ“å®Œæˆï¼Œè¿™æ ·ä»»ä½•çš„æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼›è€Œ Fiber Reconciler ï¼ˆReact v16 ä»¥åï¼‰åˆ™å¯ä»¥æ‹†åˆ†æ¸²æŸ“ä»»åŠ¡ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å¯ä»¥å»ç¡®å®šæ˜¯å¦æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ç”¨æˆ·è¾“å…¥ï¼‰ï¼Œå¹¶ä¼˜å…ˆæ‰§è¡Œå®ƒä»¬ã€‚è¿™ä¸ªæœ€ç›´è§‚çš„ä½“ç°å°±æ˜¯æ¸²æŸ“ä¸€æ£µå¾ˆå¤§çš„ç»„ä»¶æ ‘çš„æ€§èƒ½å¤§å¤§æé«˜äº†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;what-is-fiber&#34;&gt;What is fiber&lt;/h2&gt;

&lt;p&gt;å®˜æ–¹æ–‡æ¡£çš„ä»‹ç»ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Its main goals are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Ability to split interruptible work in chunks.&lt;/li&gt;
&lt;li&gt;Ability to prioritize, rebase and reuse work in progress.&lt;/li&gt;
&lt;li&gt;Ability to yield back and forth between parents and children to support layout in React.&lt;/li&gt;
&lt;li&gt;Ability to return multiple elements from render().&lt;/li&gt;
&lt;li&gt;Better support for error boundaries.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;requestidlecallback-requestanimationframe&#34;&gt;requestIdleCallback &amp;amp; requestAnimationFrame&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/acdlite/react-fiber-architecture&#34;&gt;React Fiber Architecture&lt;/a&gt; è¿™ç¯‡æ–‡ç« è¯´åˆ°ï¼Œfiber æ˜¯åŸºäºè¿™ä¸¤ä¸ªæµè§ˆå™¨ API æ¥ä¼˜åŒ–çš„ã€‚&lt;/p&gt;

&lt;p&gt;MDN ä¸Šè¿™ä¸¤ä¸ª API çš„å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;window.requestIdleCallback() ä¼šåœ¨æµè§ˆå™¨ç©ºé—²æ—¶æœŸä¾æ¬¡è°ƒç”¨å‡½æ•°ï¼Œè¿™å°±å¯ä»¥è®©å¼€å‘è€…åœ¨ä¸»äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œåå°æˆ–ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œè€Œä¸”ä¸ä¼šå¯¹åƒåŠ¨ç”»å’Œç”¨æˆ·äº¤äº’è¿™æ ·å»¶è¿Ÿæ•æ„Ÿçš„äº‹ä»¶äº§ç”Ÿå½±å“ã€‚&lt;/p&gt;

&lt;p&gt;window.requestAnimationFrame() å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼ŒrequestAnimationFrame å¯ä»¥ç”¨äºæ‰§è¡Œé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œè€Œ requestIdleCallback å¯ä»¥ç”¨äºæ‰§è¡Œä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚é‚£ä¹ˆäºŒè€…åˆ°åº•æ˜¯æ€ä¹ˆæ‰§è¡Œçš„å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://cdn-images-1.medium.com/max/2600/1*ad-k5hYKQnRQJF8tv8BIqg.png&#34; alt=&#34;Life of a frame (main thread edition)&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æµè§ˆå™¨ä¸­ï¼Œæ¯ä¸€å¸§é‡Œéœ€è¦åšçš„äº‹å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚å…¶ä¸­ ä¹Ÿå°±æ˜¯è¯´ï¼ŒrequestAnimationFrame çš„ callback ä¼šåœ¨ rAF é˜¶æ®µæ‰§è¡Œã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦æˆ‘ä»¬åŠ¨ç”»çš„ FPS ä¿æŒåœ¨ 60ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä¿è¯åœ¨ 1 å¸§ï¼ˆ1000/60 msï¼‰é‡Œèƒ½å¤Ÿåšå®Œè¿™äº›äº‹ã€‚è€Œå¦‚æœ 1 å¸§é‡Œåšå®Œäº†è¿™äº›äº‹å¹¶ä¸”æœ‰ç©ºé—²æ—¶é—´ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‰§è¡Œ requestIdleCallback çš„ callbackã€‚å¦å¤–å…³äº 60FPSï¼Œé€šå¸¸æˆ‘ä»¬è®¤ä¸º 60 æ˜¯ä¸ªç†æƒ³çš„æ•°å€¼ï¼ŒFPS å°äº 20 ä¼šæ„Ÿå—åˆ°æ˜æ˜¾çš„å¡é¡¿ï¼Œè€Œå¤§äº 60 éœ€è¦é¢å¤–çš„èµ„æºä½†æ˜¯äººçœ¼æ— æ³•æ„Ÿå—åˆ°æ˜æ˜¾çš„å˜åŒ–ã€‚&lt;/p&gt;

&lt;h2 id=&#34;scheduling&#34;&gt;Scheduling&lt;/h2&gt;

&lt;p&gt;å…³äºè°ƒåº¦ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;æ²¡å¿…è¦å®æ—¶æ›´æ–°æ‰€æœ‰çš„ UI&lt;/li&gt;
&lt;li&gt;ä¸åŒç±»å‹çš„æ›´æ–°æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œä¾‹å¦‚åŠ¨ç”»çš„ä¼˜å…ˆçº§ä¼šé«˜äº store çš„æ›´æ–°&lt;/li&gt;
&lt;li&gt;React çš„å®ç°æ–¹å¼æ˜¯ &amp;ldquo;pull&amp;rdquo; çš„ï¼Œå®ƒä¼šå¸®åŠ©æˆ‘æˆ‘ä»¬å†³å®šäº‹åŠ¡çš„ä¼˜å…ˆçº§ã€‚å®ƒä¸åƒæŸäº›åº“çš„ &amp;ldquo;push&amp;rdquo; æ–¹å¼ï¼Œåœ¨æœ‰æ–°çš„ data çš„æ—¶å€™å°±æ‰§è¡Œè®¡ç®—ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è€Œ Fiber Reconciler ä¸­æœ‰ä¸ª Schedulerï¼Œå®ƒå¯ä»¥ç”¨äºè°ƒåº¦ä»»åŠ¡ï¼Œé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼šè¢«å…ˆæ‰§è¡Œï¼Œè€Œ diff å±äºä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œä¼šåœ¨é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆåå†æ‰§è¡Œã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ¸²æŸ“è¿‡ç¨‹&#34;&gt;æ¸²æŸ“è¿‡ç¨‹&lt;/h2&gt;

&lt;p&gt;åœ¨æ‰§è¡Œæ¸²æŸ“çš„æ—¶å€™ï¼ŒFiber Reconciler ä¼šæ ¹æ®è™šæ‹Ÿ DOM ç”Ÿæˆä¸€æ£µ Fiber Treeã€‚è¿™ä¸ªé˜¶æ®µæ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ã€‚åœ¨ç”Ÿæˆ Fiber Tree çš„æ—¶å€™ï¼Œæ¯ç”Ÿæˆä¸€ä¸ªèŠ‚ç‚¹ï¼Œéƒ½ä¼šæŠŠæ§åˆ¶æƒäº¤è¿˜ç»™ä¸»çº¿ç¨‹ï¼Œçœ‹æ˜¯å¦æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç»§ç»­æ„å»ºï¼Œå¦åˆ™ä¼šæ‰“æ–­ Fiber Tree çš„æ„å»ºã€‚å¦‚æœåœ¨è¿™ä¸ªé˜¶æ®µè¢«æ‰“æ–­ï¼Œé‚£ä¹ˆ Fiber Reconciler ä¼šé‡æ–°ç”Ÿæˆæ–°çš„ Fiber Treeã€‚è¿™ä¸ªé˜¶æ®µä¸»è¦æ˜¯åœ¨ React ç»„ä»¶çš„ render/reconciliation é˜¶æ®µï¼Œå¯¹åº”ç”Ÿå‘½å‘¨æœŸé’©å­å°±æ˜¯æ¸²æŸ“æˆ–è€…é‡æ¸²æŸ“å‰é‚£äº›ã€‚è€Œ Fiber Tree ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ä¸­ï¼Œå¦‚æœæœ‰ side effectï¼Œå°±ä¼šè¿›è¡Œæ ‡è®°ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µä¸­ä¼šç”Ÿæˆä¸€ä¸ª effect listã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ç»è¿‡è¿™ä¸ªé˜¶æ®µä¹‹åï¼Œä¼šè¿›å…¥åˆ° commit çš„é˜¶æ®µï¼Œæ­¤æ—¶ä¼šå¯¹éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹è¿›è¡Œæ‰¹é‡æ›´æ–°ï¼Œå¦‚æ›´æ–° DOM æ ‘ã€è°ƒç”¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä»¥åŠæ›´æ–° ref ç­‰å†…éƒ¨çŠ¶æ€ã€‚è¯¥é˜¶æ®µä¸èƒ½è¢«æ‰“æ–­ï¼Œæ‰€ä»¥å°½å¯èƒ½ä¸è¦åœ¨ componentDidMountã€componentDidUpdate å’Œ componentWillUnmount ä¸­åšå¾ˆè€—èµ„æºçš„æ“ä½œã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/acdlite/react-fiber-architecture&#34;&gt;React Fiber Architecture&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://segmentfault.com/a/1190000018250127&#34;&gt;React Fiber åŸç†ä»‹ç» - å‰ç«¯å¤§å®å‰‘ - SegmentFault æ€å¦&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.ayqy.net/blog/dive-into-react-fiber/#articleHeader3&#34;&gt;å®Œå…¨ç†è§£ React Fiber | é»¯ç¾½è½»æ‰¬&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>More About React Hooks</title>
      <link>https://elizurhz.cn/frontend/more-about-react-hooks/</link>
      <pubDate>Thu, 10 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/frontend/more-about-react-hooks/</guid>
      <description>

&lt;h1 id=&#34;å†™åœ¨å‰é¢&#34;&gt;å†™åœ¨å‰é¢&lt;/h1&gt;

&lt;p&gt;è¿™ç¯‡æ–‡ç« æ˜¯å…³äºæˆ‘å‰ä¸€ç¯‡å…³äº React Hooks çš„æ–‡ç« ï¼ˆ&lt;a href=&#34;https://elizurhz.cn/frontend/how-hooks-helps/&#34;&gt;React Hooks èƒ½ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆ | La Vie en Code - ç¼–ç äººç”Ÿ&lt;/a&gt;ï¼‰çš„å»¶ä¼¸ã€‚å¦‚æœè¯´å‰ä¸€ç¯‡æ–‡ç« æ˜¯åŸºç¡€ï¼Œå‘Šè¯‰å¤§å®¶æ€ä¹ˆä½¿ç”¨åŸºæœ¬çš„ hooks çš„è¯ï¼Œé‚£è¿™ç¯‡æ–‡ç« åˆ™æ˜¯ä¸€äº›è¸©å‘å’Œæ›´å¤š hooks çš„ç”¨æ³•ã€‚&lt;/p&gt;

&lt;h1 id=&#34;ä¸å½“çš„ä½¿ç”¨å¯èƒ½å¯¼è‡´æ— é™å¾ªç¯&#34;&gt;ä¸å½“çš„ä½¿ç”¨å¯èƒ½å¯¼è‡´æ— é™å¾ªç¯&lt;/h1&gt;

&lt;p&gt;å½“ä½ å†™ä¸‹ &lt;code&gt;useState&lt;/code&gt; é‚£ä¸€è¡Œåï¼Œä½ å¯èƒ½ä¼šåœ¨æŸå¤„å»é‡è®¾è¿™ä¸ª stateã€‚æœ‰ä¸€ä¸ªè¯¯åŒºå°±æ˜¯åœ¨å‡½æ•°å¼ç»„ä»¶çš„å‡½æ•°ä½“ç›´æ¥è°ƒç”¨ set çš„æ–¹æ³•ã€‚è™½ç„¶è¿™æ ·ç¡®å®å¯ä»¥è¿è¡Œå¾—åˆ°ï¼ˆå®ƒä¼šåœ¨æ¯æ¬¡ render çš„æ—¶å€™è°ƒç”¨åˆ°ï¼‰ï¼Œä½†æ˜¯è¦çŸ¥é“ state æ”¹å˜äº†ä¹‹åç»„ä»¶ä¼š re-render çš„ã€‚è¿™æ ·å°±ä¼šåˆä¸€æ¬¡è°ƒç”¨ set çš„æ–¹æ³•è€Œé€ æˆæ— é™å¾ªç¯:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Too many re-renders. React limits the number of renders to prevent an infinite loop.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è®¾ç½®æˆä¸å˜çš„åŸºç¡€ç±»å‹ä¹Ÿä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥å¦‚æœä½ æƒ³é‡è®¾ stateï¼Œè¯·ç”¨ &lt;code&gt;useEffect&lt;/code&gt; æˆ–è€…é€šè¿‡äº‹ä»¶è§¦å‘ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨ &lt;code&gt;useEffect&lt;/code&gt; çš„æ—¶å€™ä¹Ÿåˆ‡è®°ä¸è¦é€ æˆæ— é™å¾ªç¯ã€‚å¦‚æœä½ æ‡‚å¾—æ€æ ·ä½¿ç”¨ &lt;code&gt;componentWillReceiveProps&lt;/code&gt;ã€&lt;code&gt;componentDidUpdate&lt;/code&gt; æˆ–è€… &lt;code&gt;getDerivedStateFromProps&lt;/code&gt; è¿™äº›ç”Ÿå‘½å‘¨æœŸæ›´é’©å­çš„è¯ï¼Œé‚£ä¹ˆä¹Ÿåº”è¯¥çŸ¥é“æ€æ ·åœ¨ç‰¹å®šçš„æ—¶å€™æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼Œä¾‹å¦‚æŸä¸ª prop å˜åŒ–æ—¶ï¼šè¦ç”¨æ¡ä»¶è¯­å¥æ¥åˆ¤æ–­ï¼Œå¦åˆ™ä¼šåœ¨ä¸å¿…è¦çš„æƒ…å†µä¸‹æ‰§è¡Œäº†ä½ ç¼–å†™çš„è¯­å¥ã€‚&lt;code&gt;useEffect&lt;/code&gt; ä¹Ÿä¸€æ ·ã€‚æœ€ç³Ÿç³•çš„æƒ…å†µå°±æ˜¯åœ¨ &lt;code&gt;useEffect&lt;/code&gt; ä¸­å¤šæ¬¡åœ°ã€é‡å¤åœ°é‡è®¾ stateï¼Œå¤„ç†ä¸å½“çš„è¯ä¹Ÿä¼šå¯¼è‡´ re-render çš„æ— é™å¾ªç¯ã€‚å½“ç„¶é™¤äº†ç”¨æ¡ä»¶è¯­å¥æ¥åˆ¤æ–­ä¹‹å¤–ï¼Œè¿˜æœ‰ dependenciesï¼Œä¹Ÿå°±æ˜¯ &lt;code&gt;useEffect&lt;/code&gt; çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤– &lt;code&gt;useSelector&lt;/code&gt; ä¹Ÿå¯èƒ½å¯¼è‡´è¿™ç§é—®é¢˜ï¼Œé™¤äº†ä½¿ç”¨ &lt;code&gt;react-redux&lt;/code&gt; æä¾›çš„ &lt;code&gt;shallowEqual&lt;/code&gt; ä¹‹å¤–ï¼Œè¿˜å¯èƒ½å‡ºç°å„ç§å¤æ‚çš„æƒ…å†µã€‚æ‰€ä»¥å¤„ç†è¿™ç§é—®é¢˜ï¼Œå…³é”®æ˜¯è¦äº†è§£ React åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼š re-renderï¼Œfunctional component å’Œ class component åœ¨å¤„ç†æ¸²æŸ“ä¸Šåˆæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚&lt;/p&gt;

&lt;h1 id=&#34;usememo-usecallback&#34;&gt;useMemo &amp;amp; useCallback&lt;/h1&gt;

&lt;p&gt;Hooks éƒ½åªå­˜åœ¨äº Functional Component ä¹‹ä¸­ï¼Œè€Œ Functional Component åœ¨ re-render æ—¶ä¼šæŠŠæ•´ä¸ªå‡½æ•°æ‰§è¡Œä¸€éï¼Œè€Œä¸æ˜¯åƒ Class Component ä¸€æ ·åªæ‰§è¡Œç”Ÿå‘½å‘¨æœŸé’©å­è€Œä¸ä¼šå•ç‹¬æ‰§è¡Œç±»æ–¹æ³•ã€‚å¹¶ä¸”ç”±äºå’Œ React æ¸²æŸ“ç›¸å…³çš„å‡½æ•°/è®¡ç®—éƒ½è¦å†™åœ¨ Functional Component çš„å‡½æ•°ä½“ä¸­ï¼Œæ‰€ä»¥è¿™äº›å‡½æ•°ä¸å…ä¼šå†æ‰§è¡Œä¸€éã€‚å½“æˆ‘ä»¬é‡åˆ°æ¯”è¾ƒè€—æ€§èƒ½çš„è®¡ç®—æ—¶ï¼Œè¿ç®—å‡½æ•°çš„é‡å¤æ‰§è¡Œä¼šå ç”¨å¤§é‡çš„èµ„æºã€‚è¿™æ—¶å€™å°±éœ€è¦ useMemo äº†ã€‚&lt;/p&gt;

&lt;p&gt;useMemo ä¼šä¿å­˜ä¸€ä¸ªå¸¦è®°å¿†åŠŸèƒ½çš„å€¼ã€‚å®ƒä¼šåœ¨ render çš„æ—¶å€™ï¼Œæ ¹æ®è®¾å®šçš„ä¾èµ–æ¥æ‰§è¡Œã€‚&lt;/p&gt;

&lt;p&gt;ä» &lt;code&gt;@types/react&lt;/code&gt; çš„åŒ…ä¸­å¯ä»¥æ‰¾åˆ° useMemo çš„å‡½æ•°ç­¾åï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt;function useMemo&amp;lt;T&amp;gt;(factory: () =&amp;gt; T, deps: DependencyList | undefined): T;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨ hook è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªå‡½æ•°å¿…é¡»è¦æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç›®çš„å°±æ˜¯è¦å¾—åˆ°ä¸€ä¸ªå€¼å•Šã€‚ç„¶åç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¾èµ–ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„æ„æ€æ˜¯åªæœ‰æ•°ç»„é‡Œçš„å˜é‡å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šæ‰§è¡Œè¿™ä¸ª hookï¼Œè¿™ä¸€ç‚¹å’Œ&lt;a href=&#34;https://elizurhz.cn/frontend/how-hooks-helps/&#34;&gt;ä¹‹å‰æˆ‘å†™è¿‡çš„ &lt;code&gt;useEffect&lt;/code&gt;&lt;/a&gt; æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶åï¼Œ&lt;i&gt;&lt;code&gt;useCallback(fn, deps)&lt;/code&gt; å®é™…ä¸Šå°±ç›¸å½“äº &lt;code&gt;useMemo(() =&amp;gt; fn, deps)&lt;/code&gt;&lt;/i&gt;ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt;function useCallback&amp;lt;T extends (...args: any[]) =&amp;gt; any&amp;gt;(callback: T, deps: DependencyList): T;
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;useref&#34;&gt;useRef&lt;/h1&gt;

&lt;p&gt;&lt;code&gt;useRef&lt;/code&gt; å…¶å®å¯ä»¥æŠŠå®ƒè§†ä¸º React ä¸­ &lt;code&gt;ref&lt;/code&gt; çš„ hooks ç‰ˆæœ¬ã€‚å®ƒä¹Ÿæœ‰â€œè®°å¿†â€çš„åŠŸèƒ½ï¼Œä½†æ˜¯å’Œ useMemo ä¸ä¸€æ ·çš„æ˜¯ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªåŒ…å« &lt;code&gt;.current&lt;/code&gt; çš„ JavaScript Objectï¼Œå¹¶ä¸”æ¯æ¬¡ render éƒ½ä¼šè¿”å›&lt;i&gt;ç›¸åŒ&lt;/i&gt;çš„ Objectã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Functional Component ä¸­ç”¨å®ƒæ›¿ä»£ ref çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥&lt;a href=&#34;https://reactjs.org/docs/hooks-faq.html#is-there-something-like-instance-variables&#34;&gt;ç”¨äºè®°å¿†å…¶ä»–çš„ä¸œè¥¿&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt;function useRef&amp;lt;T&amp;gt;(initialValue: T): MutableRefObject&amp;lt;T&amp;gt;;

interface MutableRefObject&amp;lt;T&amp;gt; {
  current: T;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç”¨æ³•å‚è€ƒ &lt;a href=&#34;https://reactjs.org/docs/hooks-reference.html#useref&#34;&gt;React å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-jsx&#34;&gt;function TextInputWithFocusButton() {
  const inputEl = useRef(null);
  const onButtonClick = () =&amp;gt; {
    // `current` points to the mounted text input element
    inputEl.current.focus();
  };
  return (
    &amp;lt;&amp;gt;
      &amp;lt;input ref={inputEl} type=&amp;quot;text&amp;quot; /&amp;gt;
      &amp;lt;button onClick={onButtonClick}&amp;gt;Focus the input&amp;lt;/button&amp;gt;
    &amp;lt;/&amp;gt;
  );
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å­˜å‚¨ç»„ä»¶å†…éƒ¨çš„ç§æœ‰å˜é‡&#34;&gt;å­˜å‚¨ç»„ä»¶å†…éƒ¨çš„ç§æœ‰å˜é‡&lt;/h2&gt;

&lt;p&gt;å®˜æ–¹çš„ä¾‹å­æ˜¯ç”¨äºè·å–åŸç”Ÿ DOM èŠ‚ç‚¹ï¼Œè€Œ useRef å…¶å®å¹¶æ²¡æœ‰è¢«é™åˆ¶å¿…éœ€ç”¨äº DOM èŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-jsx&#34;&gt;function TestComponent() {
  const count = useRef(0);
  useEffect(() =&amp;gt; {
    count.current = 1;
  }, []);
  return &amp;lt;div&amp;gt;{count.current}&amp;lt;/div&amp;gt;;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚ä¸Šé¢çš„ä¾‹å­æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒè®¾æˆä¸€ä¸ªå€¼ï¼Œä»–ä¼šè¿”å›è¿™æ ·ä¸€ä¸ªå¯¹è±¡ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;{ current: 1 }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é€šè¿‡ç›´æ¥ç»™ &lt;code&gt;current&lt;/code&gt; èµ‹å€¼ï¼Œå³å¯ä¿®æ”¹å®ƒã€‚å¹¶ä¸”å®ƒä¸ä¼šè§¦å‘ re-renderã€‚è¿™å…¶å®å°±å¾ˆç±»ä¼¼ class component ä¸­çš„ç±»çš„ç§æœ‰å˜é‡äº†ã€‚&lt;/p&gt;

&lt;h1 id=&#34;react-forwardref&#34;&gt;React.forwardRef&lt;/h1&gt;

&lt;p&gt;è¿™ä¸œè¥¿åœ¨ä¸šåŠ¡å¼€å‘é‡ŒåŸºæœ¬æ˜¯ç”¨ä¸ç€çš„ï¼Œåœ¨ç»„ä»¶è®¾è®¡å¯èƒ½ä¼šç”¨åˆ°ã€‚æˆ‘ä»¬çŸ¥é“ Class Component ä¸­ ref çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-jsx&#34;&gt;class MyInput extends React.Component {
  render() {
    return &amp;lt;input ref={ref =&amp;gt; (this.inputElem = ref)} /&amp;gt;;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½†æ˜¯åœ¨æŸäº›éœ€æ±‚é‡Œï¼Œæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦åœ¨è¿™ä¸ªç»„ä»¶å¤–éƒ¨åˆ›å»º refï¼Œå¹¶ä»¥æ­¤æ¥ç®¡ç†å®ƒçš„ focus çŠ¶æ€ã€åŠ¨ç”»ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-jsx&#34;&gt;const MyInput = React.forwardRef((props, ref) =&amp;gt; (
  &amp;lt;input ref={(ref) =&amp;gt; this.inputElem = ref} /&amp;gt;
))

const ref = React.createRef()
&amp;lt;MyInput ref={ref} /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®ƒå’Œ &lt;code&gt;React.createRef&lt;/code&gt; æ˜¯éœ€è¦ä¸€èµ·ä½¿ç”¨çš„ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ç”¨ React 16.3 çš„ Context API å®ç°ç±»ä¼¼ ant design çš„ Material Design ç‰ˆ Radio Group ç»„ä»¶</title>
      <link>https://elizurhz.cn/frontend/how-to-use-context-in-react/</link>
      <pubDate>Fri, 09 Aug 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/frontend/how-to-use-context-in-react/</guid>
      <description>

&lt;h1 id=&#34;radio-ç»„ä»¶æ˜¯ä»€ä¹ˆæ ·çš„&#34;&gt;Radio ç»„ä»¶æ˜¯ä»€ä¹ˆæ ·çš„&lt;/h1&gt;

&lt;p&gt;ä»¥å®˜æ–¹æ–‡æ¡£çš„ä¾‹å­ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-jsx&#34;&gt;import React from &amp;quot;react&amp;quot;;
import { Radio } from &amp;quot;antd&amp;quot;;

class App extends React.Component {
  state = {
    value: 1
  };

  onChange = e =&amp;gt; {
    console.log(&amp;quot;radio checked&amp;quot;, e.target.value);
    this.setState({
      value: e.target.value
    });
  };

  render() {
    return (
      &amp;lt;Radio.Group onChange={this.onChange} value={this.state.value}&amp;gt;
        &amp;lt;Radio value={1}&amp;gt;A&amp;lt;/Radio&amp;gt;
        &amp;lt;Radio value={2}&amp;gt;B&amp;lt;/Radio&amp;gt;
        &amp;lt;Radio value={3}&amp;gt;C&amp;lt;/Radio&amp;gt;
        &amp;lt;Radio value={4}&amp;gt;D&amp;lt;/Radio&amp;gt;
      &amp;lt;/Radio.Group&amp;gt;
    );
  }
}

ReactDOM.render(&amp;lt;App /&amp;gt;, mountNode);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é™¤äº†è¿™ç§æ–¹å¼ï¼Œè¿˜æœ‰ä½¿ç”¨ options è¿™ä¸ª prop ä¼ é€’é…ç½®æ–‡ä»¶è¿›è¡Œæ¸²æŸ“çš„ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-jsx&#34;&gt;import React from &amp;quot;react&amp;quot;;
import { Radio } from &amp;quot;antd&amp;quot;;

const plainOptions = [&amp;quot;Apple&amp;quot;, &amp;quot;Pear&amp;quot;, &amp;quot;Orange&amp;quot;];
const options = [
  { label: &amp;quot;Apple&amp;quot;, value: &amp;quot;Apple&amp;quot; },
  { label: &amp;quot;Pear&amp;quot;, value: &amp;quot;Pear&amp;quot; },
  { label: &amp;quot;Orange&amp;quot;, value: &amp;quot;Orange&amp;quot; }
];
const optionsWithDisabled = [
  { label: &amp;quot;Apple&amp;quot;, value: &amp;quot;Apple&amp;quot; },
  { label: &amp;quot;Pear&amp;quot;, value: &amp;quot;Pear&amp;quot; },
  { label: &amp;quot;Orange&amp;quot;, value: &amp;quot;Orange&amp;quot;, disabled: false }
];

class App extends React.Component {
  state = {
    value1: &amp;quot;Apple&amp;quot;,
    value2: &amp;quot;Apple&amp;quot;,
    value3: &amp;quot;Apple&amp;quot;
  };

  onChange1 = e =&amp;gt; {
    console.log(&amp;quot;radio1 checked&amp;quot;, e.target.value);
    this.setState({
      value1: e.target.value
    });
  };

  onChange2 = e =&amp;gt; {
    console.log(&amp;quot;radio2 checked&amp;quot;, e.target.value);
    this.setState({
      value2: e.target.value
    });
  };

  onChange3 = e =&amp;gt; {
    console.log(&amp;quot;radio3 checked&amp;quot;, e.target.value);
    this.setState({
      value3: e.target.value
    });
  };

  render() {
    return (
      &amp;lt;div&amp;gt;
        &amp;lt;Radio.Group
          options={plainOptions}
          onChange={this.onChange1}
          value={this.state.value1}
        /&amp;gt;
        &amp;lt;Radio.Group
          options={options}
          onChange={this.onChange2}
          value={this.state.value2}
        /&amp;gt;
        &amp;lt;Radio.Group
          options={optionsWithDisabled}
          onChange={this.onChange3}
          value={this.state.value3}
        /&amp;gt;
      &amp;lt;/div&amp;gt;
    );
  }
}

ReactDOM.render(&amp;lt;App /&amp;gt;, mountNode);
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;ant-design-æ€æ ·å®ç°çš„&#34;&gt;ant design æ€æ ·å®ç°çš„&lt;/h1&gt;

&lt;p&gt;ä» ant design çš„ &lt;a href=&#34;https://github.com/ant-design/ant-design/tree/master/components/radio&#34;&gt;github&lt;/a&gt; ä¸Šï¼Œå¯ä»¥çœ‹åˆ°ï¼ˆè¿™é‡Œæˆ‘ä»¬åªå…³å¿ƒ radio groupï¼‰è¿™ä¸ªæ¨¡å—é‡Œé¢æœ‰ radio.tsx å’Œ group.tsx ç»„ä»¶ã€‚&lt;/p&gt;

&lt;h2 id=&#34;index-tsx&#34;&gt;index.tsx&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆåœ¨ index.tsx ä¸­ï¼Œå®ç°çš„æ˜¯æ¨¡å—çš„ exportï¼Œè¿™é‡Œé€šè¿‡ Radio çš„ static property æŠŠ Group ç»„ä»¶å¼•å…¥ï¼Œè¿™æ ·å°±å¯ä»¥å®ç° &lt;code&gt;&amp;lt;Radio.Group&amp;gt;&lt;/code&gt; çš„å†™æ³•ã€‚åŒæ—¶ç”±äº TypeScript çš„ç±»å‹æ£€æŸ¥ï¼Œæˆ‘ä»¬éœ€è¦å† Radio çš„ç±»é‡Œé¢å†™ä¸Š static propertyã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt;/** index.tsx */
import Radio from &#39;./radio&#39;;
import Group from &#39;./group&#39;;

Radio.Group = Group;
export { Group };
export default Radio;

/** radio.tsx */
static Group: typeof RadioGroup;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;group-tsx-ä¸-radio-tsx&#34;&gt;group.tsx ä¸ radio.tsx&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆè¿™é‡Œä½¿ç”¨äº† &lt;a href=&#34;https://github.com/ant-design/ant-design/blob/master/components/config-provider/index.tsx&#34;&gt;config-provider&lt;/a&gt;ï¼Œè¿™ä¸ªç»„ä»¶çš„ä½œç”¨æ˜¯ä½¿ç”¨ &lt;code&gt;@ant-design/create-react-context&lt;/code&gt; æ³¨å…¥äº†ä¸€äº›é…ç½®åœ¨ context ä¸­ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦å…³æ³¨å®ƒçš„å®ç°æ–¹å¼ï¼Œåªéœ€è¦çŸ¥é“å®ƒä½¿ç”¨äº† React çš„ contextã€‚&lt;/p&gt;

&lt;p&gt;æ¥ç€æˆ‘ä»¬çœ‹ group.tsx ä¸­ &lt;a href=&#34;https://github.com/ant-design/ant-design/blob/28323b785cb8d42a4af7d2ab551c2e3141bd0545/components/radio/group.tsx#L98&#34;&gt;render&lt;/a&gt; çš„éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ options çš„éƒ¨åˆ†å°±ä¸å¤šè¯´äº†ï¼Œæ ¹æ®æ•°ç»„æ¸²æŸ“ Radio ç»„ä»¶å³å¯ã€‚å…³é”®æ˜¯å¦ä¸€ç§æ¸²æŸ“æ–¹å¼ï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬éœ€è¦åœ¨ Radio.Group çš„ props ä¼ å…¥è¿™ä¸ª radio group çš„ value å’Œ onChange äº‹ä»¶ï¼Œè€Œ &lt;code&gt;&amp;lt;Radio.Group&amp;gt;&lt;/code&gt; åœ¨è¿™é‡Œåªæ˜¯ä¸€ä¸ªåŒ…è£¹çš„ç»„ä»¶ï¼Œåœ¨ Radio.Group ä¸­æˆ‘ä»¬éœ€è¦å°† Radio çš„ onChange å’Œ props çš„ onChange å…³è”èµ·æ¥ã€‚åœ¨ä½¿ç”¨ options çš„æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠ onChange é€šè¿‡ props ä¼ ç»™ Radioï¼Œä½†æ˜¯ Radio ä½œä¸º Radio.Group çš„ children æ—¶æˆ‘ä»¬å´ä¸èƒ½è¿™æ ·ä¼ ã€‚&lt;/p&gt;

&lt;p&gt;ant design çš„åšæ³•æ˜¯åœ¨ group.tsx ä¸­ç”¨äº† &lt;a href=&#34;https://github.com/ant-design/ant-design/blob/28323b785cb8d42a4af7d2ab551c2e3141bd0545/components/radio/group.tsx#L68&#34;&gt;getChildContext&lt;/a&gt; å°†çˆ¶ç»„ä»¶çš„ onChange è®¾ç½®åˆ° context ä¸­ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt;getChildContext() {
  return {
    radioGroup: {
      onChange: this.onRadioChange,
      value: this.state.value,
      disabled: this.props.disabled,
      name: this.props.name,
    },
  };
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åŒæ—¶åœ¨ radio.tsx ä¸­ï¼Œåœ¨ Radio çš„ &lt;a href=&#34;https://github.com/ant-design/ant-design/blob/28323b785cb8d42a4af7d2ab551c2e3141bd0545/components/radio/radio.tsx#L40&#34;&gt;onChange&lt;/a&gt; ä¸­è°ƒç”¨ context çš„ onChangeï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt; onChange = (e: RadioChangeEvent) =&amp;gt; {
  if (this.props.onChange) {
    this.props.onChange(e);
  }

  if (this.context.radioGroup &amp;amp;&amp;amp; this.context.radioGroup.onChange) {
    this.context.radioGroup.onChange(e);
  }
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;getChildContext&lt;/code&gt; æ˜¯ legacy çš„ Context API äº†ï¼ŒReact å®˜æ–¹ä¹Ÿæ¨èä½¿ç”¨æœ€æ–°çš„ &lt;a href=&#34;https://reactjs.org/docs/context.html&#34;&gt;Context API&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h1 id=&#34;æˆ‘çš„å®ç°æ–¹å¼&#34;&gt;æˆ‘çš„å®ç°æ–¹å¼&lt;/h1&gt;

&lt;h2 id=&#34;tl-dr&#34;&gt;TL;DR&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§éœ€æ±‚å‘¢ï¼Œæ˜¯å› ä¸ºæ­£åœ¨åšçš„é¡¹ç›®çš„è®¾è®¡é£æ ¼æ˜¯ antd + Material Design çš„ç»“åˆä½“ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† antdï¼Œä½†æ˜¯æœ‰å¾ˆå¤š Material Design çš„åŠ¨ç”»æ•ˆæœæ— æ³•ç®€å•åœ°å®ç°ï¼Œæ‰€ä»¥éœ€è¦ä¸€éƒ¨åˆ† Material Design çš„ç»„ä»¶ã€‚è€Œ material-ui çš„å­¦ä¹ æˆæœ¬å¯¹æˆ‘ä»¬å›¢é˜Ÿæ¥è¯´æœ‰ç‚¹é«˜ï¼Œæ°å¥½ Material Design å®˜æ–¹æœ‰æä¾› web ç»„ä»¶ä¸å°è£…å¥½çš„ &lt;a href=&#34;https://github.com/material-components/material-components-web-react&#34;&gt;React ç»„ä»¶&lt;/a&gt;ï¼Œå¼•å…¥å•ä¸ªç»„ä»¶ä»¥é€‚åº”æŸäº›æ§ä»¶çš„è®¾è®¡éœ€æ±‚æ¯”è¾ƒä¸å®¹æ˜“å¢åŠ åŒ…å¤§å°ã€‚åŒæ—¶ï¼Œè¿™äº› React ç»„ä»¶å…¶å®å¹¶ä¸æ˜“ç”¨ï¼Œåšä¸€å±‚å°è£…ä¹‹åä¼šè®©å®ƒèƒ½å¤Ÿå’Œ ant design çš„ç»„ä»¶å…·æœ‰ç›¸åŒçš„ç”¨æ³•ï¼ŒåŒæ ·ä¹Ÿæ›´é€‚åˆä¸ºä¸šåŠ¡ç»„ä»¶å®šåˆ¶æ ·å¼ã€ç»Ÿä¸€ç®¡ç†æ ·å¼ç­‰ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å…·ä½“å®ç°&#34;&gt;å…·ä½“å®ç°&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt;// context.ts
import React from &#39;react&#39;

export const RadioGroupContext = React.createContext({
  groupValue: &#39;&#39;,
  onChange: (value: string) =&amp;gt; {}
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™é‡Œä½¿ç”¨äº†æ–°çš„ Context API åˆ›å»ºäº† contextã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-tsx&#34;&gt;// radio.tsx
import React from &amp;quot;react&amp;quot;;
import Radio, { NativeRadioControl } from &amp;quot;@material/react-radio&amp;quot;;
import { RadioGroupContext } from &amp;quot;./context&amp;quot;;
import &amp;quot;@material/react-radio/dist/radio.css&amp;quot;;

export default class MyRadio extends React.Component&amp;lt;RadioProps&amp;gt; {
  public static Group: typeof RadioGroup;

  public render(): JSX.Element {
    const { disabled, nativeProps, value, children } = this.props;
    return (
      &amp;lt;RadioGroupContext.Consumer&amp;gt;
        {({
          groupValue,
          onChange
        }: {
          groupValue: string;
          onChange: (value: string) =&amp;gt; void;
        }) =&amp;gt; (
          &amp;lt;div&amp;gt;
            &amp;lt;Radio&amp;gt;
              &amp;lt;NativeRadioControl
                {...nativeProps}
                checked={value === groupValue}
                value={value}
                disabled={disabled}
                onChange={(e: React.ChangeEvent&amp;lt;HTMLInputElement&amp;gt;) =&amp;gt; {
                  onChange(e.target.value);
                }}
              /&amp;gt;
            &amp;lt;/Radio&amp;gt;
            {children}
          &amp;lt;/div&amp;gt;
        )}
      &amp;lt;/RadioGroupContext.Consumer&amp;gt;
    );
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-tsx&#34;&gt;// group.tsx
import React from &amp;quot;react&amp;quot;;
import { RadioGroupContext } from &amp;quot;./context&amp;quot;;

export default class MyRadioGroup extends React.Component&amp;lt;
  PortalRadioGroupProps,
  PortalRadioGroupState
&amp;gt; {
  public constructor(props: PortalRadioGroupProps) {
    super(props);
    this.state = {
      value: props.value || &amp;quot;&amp;quot;
    };
  }

  private onChange = (value: string) =&amp;gt; {
    const { onChange } = this.props;
    this.setState({
      value
    });
    onChange &amp;amp;&amp;amp; onChange(value);
  };

  public render(): JSX.Element {
    const { children } = this.props;
    return (
      &amp;lt;RadioGroupContext.Provider
        value={{
          groupValue: this.state.value,
          onChange: this.onChange
        }}
      &amp;gt;
        {children}
      &amp;lt;/RadioGroupContext.Provider&amp;gt;
    );
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ–° Context API çš„ä½¿ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œåœ¨çˆ¶ç»„ä»¶ç”¨ Provider ä¼ å…¥ valueï¼Œè¿™æ ·æ‰€æœ‰çš„å­ç»„ä»¶å°±å¯ä»¥æ¥æ”¶åˆ° value äº†ã€‚è€Œåœ¨ä½¿ç”¨çš„åœ°æ–¹éœ€è¦ç”¨åˆ° Consumerï¼Œè¦æ³¨æ„çš„æ˜¯è¿™ä¸ªç»„ä»¶æ˜¯ä»¥ render callback çš„æ–¹å¼å®ç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦å†™æˆ render callback çš„å½¢å¼ã€‚callback çš„å‚æ•°æ˜¯ä¸Šè¿°çš„ valueï¼Œè€Œè¿”å›å€¼åˆ™æ˜¯æˆ‘ä»¬éœ€è¦çš„ç»„ä»¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä» Provider ä¼ å…¥çš„ context äº†ã€‚&lt;/p&gt;

&lt;p&gt;è€Œå®ƒä½¿ç”¨çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œå’Œ antd åŸºæœ¬ç›¸åŒã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-tsx&#34;&gt;&amp;lt;Radio.Group onChange={onChange} value={value}&amp;gt;
  &amp;lt;Radio key=&amp;quot;1&amp;quot; value=&amp;quot;1&amp;quot;&amp;gt;
    111
  &amp;lt;/Radio&amp;gt;
  &amp;lt;Radio key=&amp;quot;2&amp;quot; value=&amp;quot;2&amp;quot;&amp;gt;
    222
  &amp;lt;/Radio&amp;gt;
&amp;lt;/Radio.Group&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¸ªç»„ä»¶å”¯ä¸€çš„é—®é¢˜æ˜¯æ— æ³•åœ¨ antd çš„è¡¨å•ä¸­ä½¿ç”¨ã€‚antd Form å…¶å®å®ç°äº†åŒå‘ç»‘å®šï¼ŒåŠ«æŒäº† valueï¼ˆæˆ–è€…è‡ªå®šä¹‰å±æ€§ï¼‰ä»¥åŠ onChangeï¼Œä½†æ˜¯è¿™ä¸ªç»„ä»¶ç‚¹å‡»çš„æ—¶å€™æ— æ³•è§¦å‘ onChangeï¼Œå¯èƒ½ä¸ Material Design ç»„ä»¶çš„&lt;a href=&#34;https://github.com/material-components/material-components-web-react/blob/master/packages/checkbox/index.tsx&#34;&gt;å†…éƒ¨å®ç°&lt;/a&gt;æœ‰å…³ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>é¢å‘å‰ç«¯çš„ Flutter ä¸ flutter_web æ‚è°ˆ</title>
      <link>https://elizurhz.cn/mobile/flutter-tittle-tattle/</link>
      <pubDate>Fri, 19 Jul 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/mobile/flutter-tittle-tattle/</guid>
      <description>

&lt;h1 id=&#34;tl-dr&#34;&gt;TL;DR&lt;/h1&gt;

&lt;blockquote&gt;
&lt;p&gt;å†™åœ¨å‰é¢ï¼šæœ¬æ–‡å†™äº flutter_web æŠ€æœ¯é¢„è§ˆç‰ˆï¼ˆä¹Ÿå°±æ˜¯ Flutter 1.5ï¼‰å‘å¸ƒåä¸ä¹…ï¼Œç”±äº Preview ç‰ˆæœ¬è¿­ä»£å¾ˆå¿«å¦‚æœ‰åç»­æ›´æ–°ï¼Œå½“æ‚¨çœ‹åˆ°æœ¬æ–‡æ—¶ï¼Œæœ¬æ–‡æ‰€æåŠçš„å†…å®¹å¯èƒ½ä¼š out of dateã€‚æˆ‘ä¹Ÿä¼šæŒç»­å…³æ³¨ flutter ä»¥åŠ flutter_web çš„å‘å±•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;flutter ä¸å‰ç«¯å¼€å‘åˆ°åº•æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼ŸFlutter å…¶å®æ˜¯ç§»åŠ¨ App çš„æ¡†æ¶ï¼Œå®ƒä¸ä¹‹å‰çš„ç§»åŠ¨ç«¯å¼€å‘æœ€å¤§çš„ä¸åŒå°±æ˜¯ä½¿ç”¨äº†å£°æ˜å¼çš„ UIï¼Œå¹¶ä¸” Flutter çš„è®¸å¤šæ¦‚å¿µéƒ½æ˜¯å—äº† react çš„å¯å‘çš„ï¼Œä¾‹å¦‚ stateful &amp;amp; stateless componentã€‚å¼€å‘å›¢é˜Ÿæ›¾ç»è¯´è¦æ”¯æŒ web ç«¯ï¼Œè€Œç»ˆäºåœ¨ 2019 å¹´ 5 æœˆçš„ Google I/O ä¸Šçš„ 1.5 ç‰ˆæœ¬å‘å¸ƒæ—¶ï¼Œå…¬å¸ƒäº† flutter_web çš„ç¬¬ä¸€ä¸ªæŠ€æœ¯é¢„è§ˆç‰ˆã€‚ç°åœ¨ Flutter ä¹Ÿå·²ç»æ›´æ–°åˆ°äº† 1.8.0 ç‰ˆäº†ã€‚å¯¹äºå‰ç«¯å¼€å‘è€Œè¨€ï¼Œè·¨å¹³å°çš„æŠ€æœ¯ä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„ï¼Œæ¯•ç«Ÿç°åœ¨çš„è¶‹åŠ¿å°±æ˜¯è¿™æ ·ï¼Œè¯´ä¸å®šæˆ‘ä»¬å¯èƒ½ä¹Ÿæœ‰è¢«ç§»åŠ¨ç«¯å¼€å‘è€…â€œæŠ¢é¥­ç¢—â€çš„å¯èƒ½æ€§ï¼Œå› ä¸ºä¹‹å‰çš„ React Native ä¸æ˜¯æˆç§°å‰ç«¯å¼€å‘è¦â€œæŠ¢äº†ç§»åŠ¨ç«¯å¼€å‘çš„é¥­ç¢—â€å˜›ï¼ˆä½†æ˜¯äº‹å®ä¸Šè¿˜å·®å¾—è¿œå‘¢ï¼‰ã€‚å¯¹äº React Native æ²¡åšåˆ°çš„äº‹ï¼Œæˆ‘ä¼šå¾ˆæœŸå¾… Google çš„ Flutter èƒ½ä¸èƒ½åšåˆ°ã€‚&lt;/p&gt;

&lt;h1 id=&#34;ä»-flutter-è¯´èµ·&#34;&gt;ä» flutter è¯´èµ·&lt;/h1&gt;

&lt;p&gt;å¯èƒ½å¾ˆå¤šå‰ç«¯æ›´å…³æ³¨çš„æ˜¯ flutter_web åˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œè¿™è¾¹å¯ä»¥å…ˆè¯´ï¼Œå®ƒå…¶å®å’Œ Flutter æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œåªæ˜¯è¿ç”¨äº†ä¸åŒçš„ç¼–è¯‘å’Œæ¸²æŸ“æ–¹å¼è€Œå·²ã€‚æ‰€ä»¥ä¸ºäº†äº†è§£ flutter_webï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ Flutterã€‚ä¸‹é¢å°±è¯´ä¸‹åŸºæœ¬çš„åŸç†ï¼ˆç®—æ˜¯ä»&lt;a href=&#34;https://flutter.dev/docs/resources/technical-overview&#34;&gt;å®˜ç½‘çš„ Technical Overview&lt;/a&gt;ä¸Šæ€»ç»“å‡ºæ¥çš„ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºæ˜¯å¯¹äºå‰ç«¯å¼€å‘è€…æ¥è¯´æ˜“ç†è§£çš„ï¼‰ï¼š&lt;/p&gt;

&lt;h2 id=&#34;everything-s-a-widget&#34;&gt;Everything&amp;rsquo;s a Widget&lt;/h2&gt;

&lt;p&gt;è¿™é‡Œå°±å…ˆä¸è¯´ Widget å…·ä½“æ˜¯ä»€ä¹ˆä»¥åŠåº•å±‚å®ç°äº†ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå½“åšæ˜¯å’Œ React.Component ä¸€æ ·çš„ä¸œè¥¿ï¼Œä½†æ˜¯å®ƒæ‰€æ¶‰åŠçš„ä¼šæ¯” React.Component æ›´å¤šï¼Œä¾‹å¦‚æ ·å¼ã€å¸ƒå±€ç­‰ç­‰ï¼Œè¿™æ˜¯ä¸ JavaScript çš„å¼€å‘æœ€å¤§çš„ä¸åŒï¼ˆä¸ SwiftUI å…¶å®æ˜¯ä¸€æ ·çš„ï¼‰ã€‚&lt;/p&gt;

&lt;h2 id=&#34;building-widget&#34;&gt;Building Widget&lt;/h2&gt;

&lt;p&gt;æˆ‘ä»¬å†™å‡ºæ¥çš„ App æœ€åä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ª Widget Treeã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;A widgetâ€™s build function should be free of side effects. Whenever it is asked to build, the widget should return a new tree of widgets regardless of what the widget previously returned.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è¿™ä¸ª Widget Treeï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥æŠŠå®ƒç†è§£æˆæ˜¯ React çš„è™šæ‹Ÿ DOM ä¸€æ ·çš„ä¸œè¥¿ã€‚å¦‚æœéœ€è¦ build çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è¯´ Widget Tree æœ‰å˜æ›´çš„æ—¶å€™ï¼Œä¼šè¿”å›ä¸€æ£µæ–°çš„ Widget Treeï¼Œå¹¶ä¸”æ— å‰¯ä½œç”¨ã€‚è¿™ä¸ªç”Ÿæˆæ–° Tree çš„ç®—æ³•ï¼Œå¤§è‡´ç›¸å½“äº React çš„ diff ç®—æ³•ã€‚åœ¨æ„å»º Widget çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª key çš„ propertyï¼Œè¿™ä¸ªå°±æ˜¯ç”¨äºæ¯”è¾ƒ Widget Tree çš„ã€‚&lt;/p&gt;

&lt;h2 id=&#34;handling-user-interaction&#34;&gt;Handling user interaction&lt;/h2&gt;

&lt;p&gt;è¿™éƒ¨åˆ†å…¶å®å°±æ˜¯å…³äº Stateful Widget çš„ã€‚è¿™éƒ¨åˆ†ç”¨èµ·æ¥å…¶å®å’Œ React çš„ state åŒºåˆ«ä¸å¤§ï¼Œå‰ç«¯ç†è§£èµ·æ¥ä¹Ÿä¸éš¾ã€‚&lt;/p&gt;

&lt;h1 id=&#34;dart&#34;&gt;Dart&lt;/h1&gt;

&lt;p&gt;æåˆ° Flutterï¼Œå°±ä¸å¾—ä¸è¯´åˆ° Dart è¿™ä¸ªè¯­è¨€ã€‚æˆ‘ä»¬åœ¨åš JavaScript å¼€å‘æ—¶è‚¯å®šä¼šé‡åˆ°å¾ˆå¤šç—›ç‚¹ï¼Œä¾‹å¦‚é™æ€ç±»å‹æ£€æŸ¥ã€‚è€Œæˆ‘ä»¬ç¡®å®æœ‰ç›¸åº”çš„è§£å†³æ–¹æ³•ï¼Œæ¯”å¦‚ flow å’Œ TypeScriptï¼Œä½†æ˜¯ä¸æ˜¯æ‰€æœ‰å¼€å‘è€…éƒ½ä¼šç”¨å®ƒä»¬ï¼Œè¿ç§»èµ·æ¥ä¹Ÿæœ‰ä¸€å®šçš„éš¾åº¦ï¼Œç‰¹åˆ«æ˜¯ TypeScriptï¼Œå¯¹äºæ²¡æœ‰ Java/C++ å¼€å‘ç»éªŒçš„äººå¯èƒ½ä¼šæœ‰ç‚¹æ£˜æ‰‹ï¼Œå¹¶ä¸”ä¸Šæ‰‹ä¸€æ®µæ—¶é—´åèƒ½å¯èƒ½èƒ½è·‘èµ·æ¥ï¼Œä½†æ˜¯å†™å‡ºæ¥çš„ä»£ç ä»ç„¶æœ‰æ¼æ´ï¼Œæ¯”å¦‚æ»¥ç”¨ &lt;code&gt;any&lt;/code&gt;ã€ç±»å‹çº¦æŸä¸¢å¤±ç­‰ç­‰ã€‚
è€Œæˆ‘ä¼šæŠŠ Dart çœ‹åšå’Œ TypeScript ç±»ä¼¼çš„è¯­è¨€ï¼Œå¯¹äº JavaScript å¼€å‘è€…ï¼Œæˆ–æ˜¯ Java å¼€å‘è€…ï¼Œéƒ½å¾ˆå¥½ä¸Šæ‰‹ã€‚ä½†æ˜¯ Dart ç¡®å®æœ‰ä¸€äº›å¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œè¿™ä¹Ÿæ˜¯ Flutter é«˜æ€§èƒ½çš„åŸºç¡€ã€‚&lt;/p&gt;

&lt;h2 id=&#34;jit-just-in-time&#34;&gt;JIT(Just-in-Time)&lt;/h2&gt;

&lt;p&gt;JIT ç¼–è¯‘æ˜¯ Flutter åœ¨å¼€å‘ä¸­èƒ½å¤Ÿå®ç° hot reload çš„åŸºç¡€ã€‚å®ƒä¼šä½¿ç”¨ DartVM æ¥è¿›è¡Œ JIT ç¼–è¯‘ã€‚&lt;/p&gt;

&lt;h2 id=&#34;aot-ahead-of-time&#34;&gt;AOT(Ahead-of-Time)&lt;/h2&gt;

&lt;p&gt;AOT ç¼–è¯‘æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒç¼–è¯‘æ—¶ï¼Œç›´æ¥å°†æˆ‘ä»¬çš„ä»£ç ç¼–è¯‘æˆ ARM Codeï¼Œè¿™æ ·ç”¨ Flutter å†™çš„ app å°±ä¸åƒç”¨å…¶ä»–æ¡†æ¶å†™çš„ app é‚£æ ·éœ€è¦åœ¨è¿è¡Œæ—¶ç¼–è¯‘ï¼Œå¯ä»¥æå¤§æé«˜è¿è¡Œçš„é€Ÿåº¦ï¼Œè¿™ä¹Ÿæ˜¯ Flutter çš„ä¸»è¦äº®ç‚¹ä¹‹ä¸€ã€‚&lt;/p&gt;

&lt;h2 id=&#34;compile-to-javascript&#34;&gt;Compile to JavaScript&lt;/h2&gt;

&lt;p&gt;Dart å¯ä»¥é€šè¿‡ dart2js ç¼–è¯‘æˆ JavaScript ä»£ç ï¼Œè¿™æ˜¯ flutter_web çš„åŸºç¡€ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å¼‚æ­¥ç¼–ç¨‹&#34;&gt;å¼‚æ­¥ç¼–ç¨‹&lt;/h2&gt;

&lt;p&gt;å’Œ JavaScript ä¸€æ ·ï¼ŒDart ä¸­æœ‰å†…ç½®ä¸€äº›å¼‚æ­¥ç¼–ç¨‹çš„ libraryã€‚&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;async/awaitï¼Œå’Œ ES7 çš„ async/await æ˜¯ç±»ä¼¼çš„ï¼Œå¯ä»¥å‚è€ƒ &lt;a href=&#34;https://www.youtube.com/watch?v=SmTCmDMi4BY&#34;&gt;Flutter å®˜æ–¹æ•™ç¨‹è§†é¢‘&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Futureï¼Œå’Œ Promise æ˜¯ç±»ä¼¼çš„ï¼Œå¯ä»¥å‚è€ƒ &lt;a href=&#34;https://www.youtube.com/watch?v=OTS-ap9_aXc&#34;&gt;Flutter å®˜æ–¹æ•™ç¨‹è§†é¢‘&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Streamï¼Œæä¾›äº†æµçš„å‘å¸ƒä¸è®¢é˜…ï¼Œæ˜¯ Dart å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒä¹‹ä¸€ï¼Œå¯ä»¥å‚è€ƒ &lt;a href=&#34;https://www.youtube.com/watch?v=nQBpOIHE4eE&#34;&gt;Flutter å®˜æ–¹æ•™ç¨‹è§†é¢‘&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&#34;ä»-flutter-åˆ°-flutter-web&#34;&gt;ä» Flutter åˆ° flutter_web&lt;/h1&gt;

&lt;p&gt;ä¸Šé¢å·²ç»ç®€è¦è¯´æ˜äº†ä¸€ä¸‹ Flutterï¼Œé‚£ä¹ˆ flutter_web åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Œå®ƒå’Œ Flutter æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤å¼  layer cake å›¾æ¥çœ‹ä¸‹å§ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/flutter-tittle-tattle/flutter-layer-cake.png&#34; alt=&#34;Flutter&#39;s Layer Cake&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/flutter-tittle-tattle/flutter_web-layer-cake.png&#34; alt=&#34;flutter_web&#39;s Layer Cake&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä»ä¸Šé¢ä¸¤å¼ å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒFramework å±‚å…¶å®äºŒè€…æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼ä¸åŒä¹‹å¤„ä»…ä»…åœ¨äºæ¸²æŸ“å¼•æ“ã€‚åœ¨ Flutter ä¸­ï¼Œç»˜å›¾å¼•æ“ä½¿ç”¨çš„æ˜¯ skiaï¼Œè€Œåœ¨ flutter_web ä¸­ï¼Œå…ƒç´ éƒ½æ˜¯ç»˜åˆ¶åœ¨ canvas ä¸Šçš„ï¼&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥ç»“åˆå®é™…çš„ä¾‹å­æ¥çœ‹çœ‹ï¼Œä¾‹å¦‚ NYTIMES åšçš„ &lt;a href=&#34;https://www.nytimes.com/games/prototype/kenken#/&#34;&gt;KENKEN&lt;/a&gt; å°æ¸¸æˆã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä½¿ç”¨ Chrome Devtools æŸ¥çœ‹çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå®ƒçš„ DOM ç»“æ„æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/flutter-tittle-tattle/kenken-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬è®¤çŸ¥çš„ Web App ç»“æ„å®Œå…¨ä¸ä¸€æ ·ã€‚ç„¶åæˆ‘åœ¨ &lt;a href=&#34;https://www.reddit.com/r/FlutterDev/comments/blvrou/flutter_for_web_preview_goes_public/&#34;&gt;Reddit&lt;/a&gt; ä¸Šæ‰¾åˆ°äº†ä¸€ä½ flutter_web çš„å¼€å‘è€…çš„ç•™è¨€ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/flutter-tittle-tattle/kenken-2.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å¤§æ„æ˜¯ï¼š&lt;code&gt;&amp;lt;flt-scene-host&amp;gt;&lt;/code&gt; æ˜¯å±•ç¤ºå±‚ï¼ŒåŒ…æ‹¬ DOM å’Œ Canvas ç­‰ï¼›&lt;code&gt;&amp;lt;flt-glass-pane&amp;gt;&lt;/code&gt; æ˜¯ç”¨äºç›‘å¬äº‹ä»¶çš„å±‚ï¼›&lt;code&gt;&amp;lt;flt-ruler-host&amp;gt;&lt;/code&gt; æ˜¯ç”¨äºæµ‹é‡ text çš„å±‚ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ç§æ¸²æŸ“æ–¹å¼å°±ä¸ Flutter åœ¨ç§»åŠ¨ç«¯çš„æ¸²æŸ“æ–¹å¼å®Œå…¨ä¸€æ ·äº†ã€‚åœ¨ç§»åŠ¨ç«¯ï¼ŒFlutter é  skia åœ¨åŸç”Ÿçš„ Canvas ä¸Šç›´æ¥ç»˜åˆ¶å…ƒç´ /æ§ä»¶ï¼Œè¿™æ ·ä¸ä»…æ¸²æŸ“é€Ÿåº¦å¿«ï¼Œè€Œä¸”åœ¨ä¸åŒå¹³å°ä¸Šå¯ä»¥æ˜¾ç¤ºå‡ºåŒæ ·çš„æ ·å¼ï¼Œä¸ä¼šå› ä¸ºå„å¹³å°åŸç”Ÿæ§ä»¶çš„ä¸åŒè€Œå¯¼è‡´æ ·å¼çš„ä¸åŒã€‚ç›®å‰ Flutter æä¾›äº† Cupertino å’Œ Material ä¸¤ç§é£æ ¼å¯ä¾›é€‰æ‹©ï¼Œåˆ†åˆ«ä»£è¡¨ iOS ä¸ Android çš„ä¸¤ç§è®¾è®¡é£æ ¼ã€‚&lt;/p&gt;

&lt;p&gt;æ¢å¥è¯è¯´ï¼ŒFlutter å›¢é˜Ÿæ˜¯å®Œæ•´åœ°å°†ç§»åŠ¨ç«¯çš„æ¸²æŸ“æ–¹å¼æ¬è¿åˆ°äº† web ä¸Šï¼Œä»¥ä½¿ç”¨ canvas ä¸ºä¸»ï¼Œè€Œä¸æ˜¯åƒ React é‚£æ ·è¿˜æ˜¯ä¼šæ¸²æŸ“æˆçœŸå® DOMã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®é™…ä½“éªŒ&#34;&gt;å®é™…ä½“éªŒ&lt;/h2&gt;

&lt;p&gt;è¦æŠŠé¡¹ç›®ä» Flutter è¿ç§»åˆ° flutter_web ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚é¦–å…ˆ flutter_web ä¸ä½¿ç”¨ Cupertino å’Œ Materialï¼Œæ‰€ä»¥ Widget éœ€è¦æ›´æ”¹ï¼›å…¶æ¬¡å®ƒä»¬çš„ä¾èµ–åº“ä¸ä¸€æ ·ï¼Œé¡¹ç›®ä¾èµ–ä¹Ÿéœ€è¦æ›´æ”¹ã€‚æˆ‘å°è¯•è¿‡æŠŠ Flutter åº”ç”¨è¿ç§»åˆ° flutter_webï¼Œä½†æ˜¯ä»ç„¶æ²¡æ³•å¤„ç†å¥½è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æš‚æ—¶æ”¾å¼ƒäº†ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘æ›´æœŸå¾…çš„å…¶å®æ˜¯åƒ Taro é‚£æ ·ï¼Œèƒ½å¤Ÿåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæ ¹æ®é…ç½®å’Œå‘½ä»¤çš„ä¸åŒï¼Œèƒ½å¤Ÿç¼–è¯‘æˆä¸åŒçš„ç‰ˆæœ¬ã€‚è¿™æ ·çš„å¥½å¤„å°±æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç¼–è¯‘å‡º Native App çš„ H5 ç‰ˆæœ¬ï¼Œè¿™å¯¹äºä¸€äº›åˆ†äº«åŠŸèƒ½æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œå› ä¸ºåˆ†äº«å‡ºæ¥çš„é¡µé¢æ˜¯éœ€è¦ H5 çš„ã€‚çœ‹æ¥ flutter_web è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œæˆ‘ä¹Ÿå¾ˆæœŸå¾…å®ƒå‘å¸ƒæ­£å¼ç‰ˆçš„æ—¶å€™ä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Amazon AWS Serverless éƒ¨ç½² React é¡¹ç›®</title>
      <link>https://elizurhz.cn/backend/aws-serverless-deployment/</link>
      <pubDate>Thu, 18 Jul 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/backend/aws-serverless-deployment/</guid>
      <description>

&lt;h1 id=&#34;å†™åœ¨å‰é¢&#34;&gt;å†™åœ¨å‰é¢&lt;/h1&gt;

&lt;h2 id=&#34;ä¸ºä»€ä¹ˆä½¿ç”¨-serverless&#34;&gt;ä¸ºä»€ä¹ˆä½¿ç”¨ Serverless&lt;/h2&gt;

&lt;p&gt;å› ä¸ºå®ƒæ˜¯æŒ‰é‡(è¯·æ±‚æ•°)ä»˜è´¹çš„ï¼Œç›¸æ¯”äº EC æˆ–è€…å®¹å™¨çš„æŒ‰æ—¶é—´ä»˜è´¹ä¼šèŠ‚çœå¾ˆå¤šæˆæœ¬ï¼Œå¹¶ä¸” EC å¾€å¾€ä¼šé‡åˆ°å¸¦å®½é™åˆ¶çš„é—®é¢˜ï¼Œå¢åŠ å¸¦å®½ä¼šæé«˜å¾ˆå¤šæˆæœ¬ã€‚&lt;/p&gt;

&lt;h2 id=&#34;prerequisite&#34;&gt;Prerequisite&lt;/h2&gt;

&lt;p&gt;å¦‚æœè¦ä½¿ç”¨ Amazon AWS Serverless æ¥éƒ¨ç½² React é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå«åš &lt;code&gt;serverless&lt;/code&gt; çš„ npm packageã€‚åŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦åœ¨é¡¹ç›®ä¸‹ç¼–å†™ &lt;code&gt;serverless.yml&lt;/code&gt;ã€‚å…·ä½“çš„å†™æ³•å¯ä»¥å‚è€ƒ &lt;code&gt;serverless&lt;/code&gt; çš„&lt;a href=&#34;https://serverless.com/&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h1 id=&#34;csr-create-react-app&#34;&gt;CSR(create-react-app)&lt;/h1&gt;

&lt;p&gt;å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ create-react-app æ­å‡ºæ¥çš„é¡¹ç›®ï¼Œä½¿ç”¨ Serverless çš„æ–¹å¼éƒ¨ç½²åˆ° AWS å…¶å®å¾ˆç®€å•ã€‚è¦è®©æˆ‘ä»¬çš„éƒ¨ç½²èƒ½å¤Ÿè¿è¡Œèµ·æ¥ï¼Œåœ¨ AWS ä¸Šæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªæœåŠ¡ï¼šS3ã€‚S3 æœ‰ä¸€ä¸ªé™æ€é¡µé¢æ‰˜ç®¡çš„æœåŠ¡ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¯è®¿é—®çš„åœ°å€ã€‚è¿™ä¸ªé™æ€ç«™ç‚¹å¯ä»¥è¿è¡Œæˆ‘ä»¬æ‰“åŒ…å¥½çš„ web appã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ‰‹åŠ¨éƒ¨ç½²&#34;&gt;æ‰‹åŠ¨éƒ¨ç½²&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆåªè¦åœ¨ AWS S3 çš„æ§åˆ¶é¢æ¿é‡Œåˆ›å»ºå­˜å‚¨æ¡¶å°±å¯ä»¥äº†ï¼Œé…ç½®å¯ä»¥éƒ½ç”¨é»˜è®¤é…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/aws-serverless-deployment/aws-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦è¿›å…¥å·²ç»å»ºå¥½çš„å­˜å‚¨æ¡¶ï¼ŒæŠŠé™æ€ç½‘ç«™æ‰˜ç®¡æ‰“å¼€ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/aws-serverless-deployment/aws-2.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥ç€æˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œä¸€å®šè¦æŠŠ error.html æŒ‡å‘ index.htmlã€‚å› ä¸ºæˆ‘ä»¬å¯èƒ½åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ react-routerï¼Œè€Œåœ¨ S3 çš„é™æ€æ–‡ä»¶æ‰˜ç®¡ä¸­ï¼Œä»»ä½•å­è·¯å¾„éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯ errorï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨ create-react-app åˆ›å»ºçš„é¡¹ç›®ï¼Œå…¥å£æ–‡ä»¶åªæœ‰ä¸€ä¸ª index.htmlï¼Œè€Œä¸æ˜¯æœ‰å…¶ä»– html æ–‡ä»¶çš„å¤šé¡µé¢åº”ç”¨ã€‚åªæœ‰æŠŠé”™è¯¯é¡µé¢æŒ‡å‘ index.htmlï¼Œæ‰èƒ½æ­£å¸¸ä½¿ç”¨ react-routerã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/aws-serverless-deployment/aws-3.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è¿™é‡Œä¼šæ˜¾ç¤ºè¯¥å­˜å‚¨æ¡¶çš„è®¿é—®åœ°å€ï¼Œé€šè¿‡è¿™ä¸ªåœ°å€å°±å¯ä»¥è®¿é—®äº†ã€‚æ¥ç€æˆ‘ä»¬åœ¨å­˜å‚¨æ¡¶çš„â€œæ¦‚è¿°â€æ ‡ç­¾é¡µä¸Šä¼ æˆ‘ä»¬æ‰“åŒ…å¥½çš„æ–‡ä»¶ï¼ˆindex.html éœ€è¦åœ¨å­˜å‚¨æ¡¶çš„æ ¹ç›®å½•ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬çš„ç«™ç‚¹å°±å¯ä»¥è®¿é—®äº†ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœéœ€è¦ httpsï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ CloudFront ä¸Šåˆ›å»ºä¸€ä¸ªåŸŸåï¼ŒæŠŠæºæŒ‡å‘æˆ‘ä»¬çš„ S3 bucket å°±å¯ä»¥äº†ã€‚è¿™ä¸ªè¿‡ç¨‹æ— éœ€æˆ‘ä»¬ç”³è¯·ä»»ä½•çš„è¯ä¹¦ã€‚&lt;/p&gt;

&lt;h2 id=&#34;serverless-å‘½ä»¤è¡Œéƒ¨ç½²&#34;&gt;serverless å‘½ä»¤è¡Œéƒ¨ç½²&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£… serverlessï¼šè¿è¡Œ &lt;code&gt;yarn add --global serverless&lt;/code&gt;(å¦‚æœä½ å®‰è£…äº† yarn) æˆ–è€… &lt;code&gt;npm install -g serverless&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;serverless è¿™ä¸ª npm package å¯ä»¥ä½¿ç”¨æ’ä»¶æ¥è¾…åŠ©è¿›è¡Œéƒ¨ç½²ã€‚è¿™é‡Œæ¨èä½¿ç”¨ &lt;code&gt;serverless-finch&lt;/code&gt; è¿›è¡Œéƒ¨ç½²ã€‚æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ª &lt;code&gt;serverless.yml&lt;/code&gt; æ–‡ä»¶ï¼Œserverless åŒ…ä¼šè¯»å–è¿™ä¸ªæ–‡ä»¶çš„é…ç½®è¿›è¡Œéƒ¨ç½²ã€‚å‚è€ƒé…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;service: your-app-name

frameworkVersion: &amp;quot;=1.38.0&amp;quot;

# AWS çš„é…ç½®
provider:
  name: aws
  runtime: nodejs6.10
  stage: dev
  region: us-east-2
  profile: default

plugins:
  - serverless-finch

# ä»¥ä¸‹ä¸º serverless-finch çš„é…ç½®
custom:
  client:
    bucketName: your-bucket-name # éœ€è¦å’Œ S3 ä¸Šåˆ›å»ºçš„ bucket åŒå
    distributionFolder: build # æœ¬åœ°æ‰“åŒ…çš„è¾“å‡ºç›®å½•
    indexDocument: index.html # åŒ S3 ä¸Šé™æ€æ–‡ä»¶æ‰˜ç®¡ä¸­è®¾ç½®çš„å…¥å£æ–‡æ¡£
    errorDocument: index.html # åŒ S3 ä¸Šé™æ€æ–‡ä»¶æ‰˜ç®¡ä¸­è®¾ç½®çš„é”™è¯¯æ–‡æ¡£
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åæˆ‘ä»¬éœ€è¦åœ¨ AWS Console çš„ IAM ä¸Šåˆ›å»ºä¸€ä¸ªèƒ½è¯»å†™ S3 çš„è§’è‰²ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/aws-serverless-deployment/aws-4.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è¿›å…¥ IAM çš„æ§åˆ¶å°ï¼Œå·¦ä¾§èœå•é€‰æ‹©â€œç”¨æˆ·â€ï¼Œç„¶åæ·»åŠ ç”¨æˆ·ã€‚æ¥ç€å¡«å†™ç”¨æˆ·åï¼Œå¹¶ä¸”éœ€è¦å‹¾é€‰â€œç¼–ç¨‹è®¿é—®â€ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/aws-serverless-deployment/aws-5.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥ç€è¦ç»™åˆ›å»ºçš„ç”¨æˆ·é™„åŠ æƒé™ï¼Œè¿™è¾¹æ¨èå¯ä»¥é€‰æ‹© AmazonS3FullAccessã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/aws-serverless-deployment/aws-6.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å®Œæˆåˆ›å»ºä¹‹åï¼Œè¿™é‡Œä¼šå‡ºç° ID å’Œå¯†é’¥ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦ç”¨å®ƒï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;serverless config credentials --provider aws --key [YOUR_KEY] --secret [YOUR_SECRET]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™é‡Œçš„ key å¡«å†™ IDï¼Œsecret å¡«å†™å¯†é’¥ã€‚è¿™ä¸€æ­¥æ˜¯è®¾ç½®æˆ‘ä»¬ serverless çš„å½“å‰ç”¨æˆ·æƒé™ã€‚&lt;strong&gt;æ³¨æ„å¦‚æœéœ€è¦åˆ‡æ¢ç”¨æˆ·ï¼Œéœ€è¦ç”¨ AWS CLI æ¥åˆ‡æ¢ï¼Œå®æµ‹ serverless ä¸­è¦†ç›–æ‰ credentials çš„é…ç½®å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†é…ç½®ã€‚éœ€è¦éƒ¨ç½²çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰“åŒ…å¥½æ–‡ä»¶ï¼Œç„¶åè¿è¡Œ &lt;code&gt;serverless client deploy&lt;/code&gt; å³å¯ã€‚&lt;/p&gt;

&lt;h1 id=&#34;ssr-next-js&#34;&gt;SSR(Next.js)&lt;/h1&gt;

&lt;p&gt;ç”±äºç¯‡å¹…é™åˆ¶ï¼Œå¹¶ä¸”æˆ‘ä¸ªäººè¸©å‘è¸©äº†å¥½å‡ ä¸ªæ˜ŸæœŸï¼Œå¾ˆå¤šç»†èŠ‚æ²¡æ³•å›å¿†èµ·æ¥æˆ–è€…æ— æ³•è¯¦ç»†è¯´æ˜ã€‚å¹¶ä¸”ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦äº†è§£æ•´ä¸ª AWS Serverless çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬åªéœ€è¦é…åˆåç«¯/è¿ç»´äººå‘˜æŠŠæˆ‘ä»¬ä»£ç å±‚é¢éœ€è¦åšçš„åšå¥½å³å¯ã€‚æ‰€ä»¥è¿™é‡Œåªæä¾›ä¸€ä¸ªå¤§æ¦‚çš„æ–¹æ¡ˆã€‚&lt;/p&gt;

&lt;h2 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h2&gt;

&lt;p&gt;ä¸ CSR App ä¸åŒçš„æ˜¯ï¼ŒSSR App éƒ¨ç½²å®Œæˆåå¹¶ä¸èƒ½ç›´æ¥è®¿é—®é™æ€é¡µé¢ï¼Œè€Œæ˜¯è¦é€šè¿‡ API Gateway å»è®¿é—®ï¼ˆåœ°å€ä¼šåœ¨éƒ¨ç½²å®Œä¹‹åæ˜¾ç¤ºåœ¨å‘½ä»¤è¡Œï¼Œæˆ–è€…å¯ä»¥åœ¨ AWS çš„ API Gateway æ§åˆ¶å°æŸ¥çœ‹ï¼‰ã€‚å½“æˆ‘ä»¬è®¿é—® API Gateway æ—¶ï¼ŒAPI Gateway ä¼šè§£æç›¸åº”çš„è¯·æ±‚ï¼ˆä¹Ÿå°±æ˜¯è·¯ç”±ï¼‰ï¼Œå¹¶è½¬å‘è‡³ AWS Lambdaã€‚è€Œ AWS Lambda åˆ™ä¼šæ ¹æ®æˆ‘ä»¬å†™å¥½çš„ Lambda å‡½æ•°ï¼ˆ&lt;code&gt;./server/lambda.js&lt;/code&gt;ï¼‰æ¥è®¿é—® S3 ä¸Šå­˜å‚¨çš„å¯¹åº”çš„é™æ€æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®è‡ªå®šä¹‰çš„åŸŸåï¼Œä½†æ˜¯æœ€å¥½æ˜¯åœ¨ Route53 ç”³è¯·ï¼Œè¿™æ ·æ‰èƒ½äº«å—åˆ° AWS çš„ä¸€ç³»åˆ—æœåŠ¡ï¼ˆå…¨å®¶æ¡¶ï¼‰ã€‚&lt;/p&gt;

&lt;h2 id=&#34;api-gateway&#34;&gt;API Gateway&lt;/h2&gt;

&lt;p&gt;API Gateway æœ‰å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ/é…ç½®é¡¹ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæ˜¯ stageï¼Œå®ƒä»£è¡¨çš„æ˜¯ä¸åŒçš„é˜¶æ®µï¼Œä¾‹å¦‚å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒç­‰ç­‰ã€‚åœ¨ API Gateway çš„è®¿é—®åŸŸåä¸­ä¼šæœ‰ä¸€ä¸ª &lt;code&gt;/{stage}&lt;/code&gt; çš„è·¯å¾„ã€‚&lt;/p&gt;

&lt;p&gt;å…¶æ¬¡æ˜¯&amp;rdquo;èµ„æº&amp;rdquo;ï¼Œè¿™é‡Œå°±æ˜¯é…ç½® API è®¿é—®çš„äº†ã€‚æˆ‘ä»¬åªéœ€è¦è®¾ç½®ä¸€ä¸ªé€šç”¨çš„è®¿é—®å¦‚ &lt;code&gt;/{proxy+}&lt;/code&gt; å³å¯ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰è®¸å¤šè·¯ç”±ï¼Œä¸å¯èƒ½æ¯ä¸ªéƒ½é…ç½®åˆ°è¿™é‡Œæ¥ï¼Œè€Œä¸å¯è®¿é—®çš„è·¯ç”±æœ€å¥½ä½¿ç”¨ Next.js ä¸­çš„ &lt;code&gt;_error.js&lt;/code&gt; æ¥åšï¼Œè€Œä¸æ˜¯åœ¨è¿™é‡Œé™åˆ¶ã€‚&lt;/p&gt;

&lt;h2 id=&#34;serverless&#34;&gt;serverless&lt;/h2&gt;

&lt;p&gt;è¿™é‡Œä¼šä½¿ç”¨åˆ°ä¸€äº›ä¸åŒçš„æ’ä»¶ï¼ŒåŸæ¥çš„ serverless-finch å°†ä¸å†ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯è®¾ç½®é™æ€æ–‡ä»¶æ‰˜ç®¡çš„ã€‚è¿™é‡Œä½¿ç”¨åˆ°äº†ä¸¤ä¸ªï¼š&lt;code&gt;serverless-apigw-binary&lt;/code&gt; å’Œ &lt;code&gt;serverless-domain-manager&lt;/code&gt;ã€‚&lt;code&gt;serverless-apigw-binary&lt;/code&gt; æ˜¯ç”¨äºé…ç½® API Gateway çš„ï¼Œè€Œ &lt;code&gt;serverless-domain-manager&lt;/code&gt; å¯ä»¥æŠŠè‡ªå®šä¹‰åŸŸååˆ° S3 bucket çš„æ•´ä¸ªæµç¨‹çš„é…ç½®éƒ½é…ç½®å¥½ã€‚ç”±äºæ¶‰åŠåˆ°æœºå¯†é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸æŠŠ &lt;code&gt;serverless.yml&lt;/code&gt; æ”¾å‡ºæ¥äº†ï¼Œå…·ä½“å¯ä»¥å»æœç´¢ä¸€ä¸‹è¿™ä¸¤ä¸ªåŒ…çš„ä½¿ç”¨æ–¹å¼ã€‚&lt;/p&gt;

&lt;h2 id=&#34;lambda&#34;&gt;Lambda&lt;/h2&gt;

&lt;p&gt;Lambda å…¶å®å°±æ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œé‡Œé¢æ˜¯å„ç§å‡½æ•°åŒ…ã€‚å®ƒå®é™…ä¸Šæœ‰ç‚¹ç±»ä¼¼äºä¸€ä¸ªå°å‹çš„è™šæ‹Ÿæœºï¼Œæ‰€ä»¥ Next.js ä¸­æ¯ä¸ªé¡µé¢æ‰“åŒ…å‡ºæ¥éƒ½æœ‰ 5.9MBã€‚AWS ä¸Šçš„ Lambda å¹³å°ä¼šåšä¸€ä¸ªä» API Gateway åˆ°æˆ‘ä»¬ä¸Šä¼ çš„å‡½æ•°åŒ…ä¸­å¯¹åº”çš„æ–‡ä»¶çš„æ˜ å°„ï¼Œè¿™æ ·å°±å®ç°äº†è·¯ç”±åŠŸèƒ½ã€‚&lt;/p&gt;

&lt;p&gt;Lambda åœ¨ SSR(Next.js) ä¸­å…¶å®å°±æ˜¯é‚£ä¸ªè¿›è¡Œæ¸²æŸ“å’Œè·¯ç”±å¯¼èˆªçš„ Node.js æœåŠ¡ã€‚è€Œå®é™…ä¸Šå®ƒå°±æ˜¯ä¸€ä¸ª Node æœåŠ¡å™¨ï¼Œå¯ä»¥ç”¨ä»»æ„çš„ Node æ¡†æ¶æ¥å†™ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ Expressã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const express = require(&amp;quot;express&amp;quot;);
const routes = require(&amp;quot;./routes&amp;quot;); // next-routes åšçš„è‡ªå®šä¹‰è·¯ç”±

const app = express();

// host the static files
app.use(&amp;quot;/_next/static&amp;quot;, express.static(path.join(__dirname, &amp;quot;/static&amp;quot;)));
app.use(&amp;quot;/static&amp;quot;, express.static(&amp;quot;static&amp;quot;));

app.get(&amp;quot;*&amp;quot;, (req, res) =&amp;gt; {
  const parsedUrl = parse(req.url, true);
  const { pathname, query, search } = parsedUrl;

  // Map url to page directory
  const matchRoute = routes.match(pathname);
  if (matchRoute &amp;amp;&amp;amp; matchRoute.route) {
    const page = matchRoute.route.page;
    const params = matchRoute.params;

    if (params) {
      if (search) {
        req.url += &amp;quot;&amp;amp;&amp;quot; + querystring.stringify(params);
      } else {
        req.url += &amp;quot;?&amp;quot; + querystring.stringify(params);
      }

      try {
        __non_webpack_require__(`./serverless/pages${page}`).render(
          req,
          res,
          parsedUrl,
          Object.assign(params, query)
        );
      } catch (err) {
        __non_webpack_require__(&amp;quot;./serverless/pages/_error&amp;quot;).render(
          req,
          res,
          parsedUrl,
          Object.assign(params, query)
        );
      }
    } else {
      try {
        __non_webpack_require__(`./serverless/pages${page}`).render(
          req,
          res,
          parsedUrl
        );
      } catch (err) {
        __non_webpack_require__(&amp;quot;./serverless/pages/_error&amp;quot;).render(
          req,
          res,
          parsedUrl
        );
      }
    }
  } else {
    __non_webpack_require__(&amp;quot;./serverless/pages/_error&amp;quot;).render(
      req,
      res,
      parsedUrl
    );
  }
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™è¾¹å®é™…ä¸Šå°±æ˜¯åœ¨åšè·¯ç”±çš„æ˜ å°„ï¼Œç„¶åè½½å…¥ Next.js æ‰“åŒ…å‡ºæ¥å¯¹åº”çš„é¡µé¢å…¥å£ï¼Œæ¥ç€å°±å¯ä»¥ä½¿ç”¨ React çš„èƒ½åŠ›è¿›è¡Œæ¸²æŸ“ã€‚å…³äº Next.jsï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡åšæ–‡ï¼š&lt;a href=&#34;https://elizurhz.cn/frontend/mirgation-from-csr-to-ssr/&#34;&gt;Next.js å®æˆ˜ï¼šä» CSR è¿ç§»åˆ° SSR&lt;/a&gt;ã€‚ä½†æ˜¯åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯éœ€è¦è¢«ç¼–è¯‘æˆ ES5 çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å†™ä¸€ä¸ª Webpack é…ç½®æ¥æ‰“åŒ…å®ƒï¼Œåªéœ€è¦åœ¨æ ¹ç›®å½•å»ºä¸€ä¸ª &lt;code&gt;webpack.config.js&lt;/code&gt; å³å¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;// webpack.config.js
const path = require(&amp;quot;path&amp;quot;);
const CopyWebpackPlugin = require(&amp;quot;copy-webpack-plugin&amp;quot;);

const LAMBDA_FILE_LOC = path.join(__dirname, &amp;quot;./server/lambda.js&amp;quot;);
const LAMBDA_DIR = path.join(__dirname, &amp;quot;./build&amp;quot;);
const LAMBDA_FILE_PROD = &amp;quot;./lambda_prod.js&amp;quot;;

const plugins = [
  new CopyWebpackPlugin([
    // your custom config
  ])
];

// æ‰“åŒ…é…ç½®
module.exports = {
  entry: LAMBDA_FILE_LOC,
  externals: [&amp;quot;aws-sdk&amp;quot;], // è®¾ç½®æˆ AWS Lambda æ”¯æŒçš„æ ¼å¼
  output: {
    libraryTarget: &amp;quot;commonjs&amp;quot;,
    filename: LAMBDA_FILE_PROD,
    path: LAMBDA_DIR
  },
  target: &amp;quot;node&amp;quot;,
  node: {
    __filename: false,
    __dirname: false
  },
  mode: &amp;quot;production&amp;quot;,
  plugins
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åè¿è¡Œ &lt;code&gt;npx webpack&lt;/code&gt; å³å¯è¿›è¡Œæ‰“åŒ…ã€‚ä½¿ç”¨ &lt;code&gt;CopyWebpackPlugin&lt;/code&gt; çš„åŸå› ä¸»è¦æ˜¯ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°ä¸€äº›æ–‡ä»¶æ— æ³•è¢« Next.js æ‰“åŒ…ï¼Œä½†æ˜¯å®ƒä»¬åˆæ˜¯ Web App è¿è¡Œå¿…éœ€çš„ï¼Œæˆ–è€…æ˜¯ AWS Lambda çš„å‡½æ•°åŒ…éœ€è¦çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªèƒ½æ‰‹åŠ¨æŠŠå®ƒä»¬æ‹·è´åˆ° Next.js çš„ build ç›®å½•ï¼Œå› ä¸º serverless ä¼šæ ¹æ®è¿™ä¸ªç›®å½•æ¥æ‰“åŒ…å‡º AWS Lambda æ‰€éœ€çš„å‡½æ•°åŒ…ã€‚&lt;/p&gt;

&lt;h2 id=&#34;éƒ¨ç½²æµç¨‹&#34;&gt;éƒ¨ç½²æµç¨‹&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;é¦–å…ˆä¼šå…ˆè¿è¡Œ &lt;code&gt;next build&lt;/code&gt;ï¼Œå°†æ–‡ä»¶æ‰“åŒ…è‡³ &lt;code&gt;./build&lt;/code&gt; ç›®å½•ã€‚ç”±äºåœ¨ &lt;code&gt;next.config.js&lt;/code&gt; ä¸­è®¾ç½®äº† &lt;code&gt;target: &#39;serverless&#39;&lt;/code&gt;ï¼Œæ‰€ä»¥æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶æ˜¯ serverless çš„ç‰ˆæœ¬ï¼Œä¼šä¸äº‘ä¸»æœºã€å®¹å™¨éƒ¨ç½²çš„ç‰ˆæœ¬ä¸åŒã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ç¼–è¯‘ &lt;code&gt;./server/lambda.js&lt;/code&gt;. å¹¶åœ¨ &lt;code&gt;./build&lt;/code&gt; ç›®å½•ä¸‹ç”Ÿæˆ &lt;code&gt;lambda_prod.js&lt;/code&gt;ã€‚è¿™ä¸€æ­¥ä¸»è¦æ˜¯è¦æŠŠ ES6 å†™çš„ lambda å‡½æ•°ç¼–è¯‘æˆ ES5ï¼Œè¿™æ · AWS Lambda æ‰èƒ½æ­£å¸¸è®¿é—®å®ƒã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å°†æ‰€éœ€æ–‡ä»¶æ‰“åŒ…æˆ &lt;code&gt;.zip&lt;/code&gt;ã€‚å‹ç¼©æ–‡ä»¶ä¼šåœ¨ &lt;code&gt;./.serverless&lt;/code&gt; ç›®å½•ä¸‹ç”Ÿæˆã€‚ éœ€è¦æ‰“åŒ…çš„å†…å®¹å¯ä»¥åœ¨ &lt;code&gt;serverless.yml&lt;/code&gt; çš„å¦‚ä¸‹å­—æ®µä¸­è®¾ç½®ï¼š&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;package:
  exclude:
    - ./**
  include:
    - build/**
    - static/**
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
&lt;li&gt;ä¸Šä¼ å‹ç¼©æ–‡ä»¶è‡³ S3ï¼ŒåŒæ—¶ä¼šè‡ªåŠ¨ä¿®æ”¹ API Gateway å’Œ AWS Lambda çš„ç›¸åº”è®¾ç½®ã€‚&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>React Hooks èƒ½ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆ</title>
      <link>https://elizurhz.cn/frontend/how-hooks-helps/</link>
      <pubDate>Thu, 18 Jul 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/frontend/how-hooks-helps/</guid>
      <description>

&lt;h1 id=&#34;tl-dr&#34;&gt;TL;DR&lt;/h1&gt;

&lt;p&gt;å¾ˆå¤š React çš„æ–°æŠ€æœ¯ï¼Œæˆ‘ä»¬å¤§å¤šæ•°äººä¹Ÿåªæ˜¯å¬è¯´è€Œå·²ï¼Œå®é™…ä¸ŠæŠ•å…¥ç”Ÿäº§çš„æœºä¼šéå¸¸å°‘ã€‚é¦–å…ˆå¾ˆå¤šæ—§é¡¹ç›®ä¸ä¼šå»å‡çº§ React çš„ç‰ˆæœ¬ï¼Œå¾ˆå¤šå›¢é˜Ÿå› ä¸ºä¸ç²¾é€šæŠ€æœ¯è€Œä¸”åªéœ€è¦ä¸“æ³¨äºåšä¸šåŠ¡ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰è¿™æ ·çš„æˆæœ¬æ¥å‡çº§ React çš„ç‰ˆæœ¬ã€‚è€Œæˆ‘åˆšå¥½é‡åˆ°äº†å¥½çš„æœºä¼šï¼Œè®©æˆ‘æœ‰è¶³å¤Ÿçš„æŠ€æœ¯è‡ªç”±åº¦ï¼Œæˆ‘ä¹Ÿè¶ç€ä¸€ä¸ªé‡æ„çš„æœºä¼šï¼Œé¡ºä¾¿æŠŠè´Ÿè´£ç»„ä»¶å…¨éƒ¨ç”¨ hooks é‡æ„äº†ã€‚è¿™æ¬¡é‡æ„æ˜¯åœ¨ 2019 å¹´ 6 æœˆä¸‹æ—¬å¼€å§‹çš„ï¼Œå¹¶ä¸”ä¹Ÿè¦æ„Ÿè°¢ react-redux åœ¨ 6 æœˆä¸Šæ—¬çš„æ—¶å€™å‘å¸ƒäº† v7.1.0ï¼ŒHooks API æ­£å¼æŠ•å…¥ç”Ÿäº§äº†ï¼Œè®©æˆ‘èƒ½å¤Ÿå¤§å±•èº«æ‰‹ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸ä¼šæ¶‰åŠåˆ° React ä¸­æ‰€æœ‰ Hooks çš„ç»†èŠ‚ï¼Œè€Œæ˜¯å°±å¼€å‘è€Œè¨€è°ˆè°ˆå¸¸ç”¨çš„ä¸€äº› Hooksï¼Œç‰¹åˆ«æ˜¯æœ€è¿‘æ¨å‡ºçš„ã€è®© redux app èƒ½å¤Ÿä½¿ç”¨ functional component æ›¿ä»£ connect çš„ Hooksã€‚&lt;/p&gt;

&lt;h1 id=&#34;before-after-hooks&#34;&gt;Before &amp;amp; After Hooks&lt;/h1&gt;

&lt;p&gt;ä½¿ç”¨ Hooks å¯¹ä»£ç çš„ä¿®æ”¹ä¸å°‘ï¼Œä½†æ˜¯å®Œæˆé‡æ„åä»£ç çœ‹ç€ä¼šéå¸¸ç®€æ´ï¼Œå› ä¸ºå°‘äº†éå¸¸å¤šçš„ä»£ç ï¼Œæˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªç»„ä»¶åªéœ€è¦çœ‹ä¸€ä¸ª function å³å¯ã€‚&lt;/p&gt;

&lt;h2 id=&#34;before&#34;&gt;Before&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt;/** container.ts */
import { connect } from &#39;react-redux&#39;
import { injectIntl } from &#39;react-intl&#39;
import ComponentA from &#39;./componentA&#39;
import * as actions from &#39;your/path/to/actions&#39;
import { bindActionCreators, Dispatch } from &#39;redux&#39;

function mapStateToProps(state: any): any {
  return {
    variableA: state.stateA.variableA
  }
}

function mapDispatchToProps(dispatch: Dispatch): any {
  return {
    actionA: bindActionCreators(actions.actionA, dispatch)
  }
}

export default connect(
  mapStateToProps,
  mapDispatchToProps
)(ComponentA) as any
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-tsx&#34;&gt;/** component.tsx */
interface Props {
  actionA: () =&amp;gt; void;
  variableA: string;
}

export default class ComponentA extends React.Component {
  public render(): JSX.Element {
    return &amp;lt;div onClick={() =&amp;gt; this.props.actionA}&amp;gt;{this.props.variableA}&amp;lt;/div&amp;gt;;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;after&#34;&gt;After&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-tsx&#34;&gt;/** index.tsx */
import * as React from &amp;quot;react&amp;quot;;
import { useDispatch, useSelector, shallowEqual } from &amp;quot;react-redux&amp;quot;;
import * as actions from &amp;quot;path/to/actions&amp;quot;;

interface Props {
  stateA: string;
}

export const ComponentA = (props: Props) =&amp;gt; {
  const dispatch = useDispatch();
  const variableA = useSelector(
    (state: any) =&amp;gt; state.stateA.variableA,
    shallowEqual
  );

  return &amp;lt;div onClick={() =&amp;gt; dispatch(actions.actionA())}&amp;gt;{variableA}&amp;lt;/div&amp;gt;;
};

export default injectIntl(React.memo(ComponentA));
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;so&#34;&gt;So?&lt;/h2&gt;

&lt;p&gt;ä»æ”¹é€ å‰çš„ä»£ç å’Œæ”¹é€ åçš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨ Hooks ç¡®å®èŠ‚çœäº†å¾ˆå¤šä»£ç çš„è¡Œæ•°ã€‚åœ¨ connect çš„å†™æ³•ä¸­ï¼Œä¸Šé¢çš„ä¾‹å­å¹¶æœªæŒ‡å®š mapDispatchToProps çš„è¿”å›å€¼ç±»å‹ã€‚è€Œåœ¨ dumb component ä¸­ï¼Œç»„ä»¶çš„ action ç±»å‹å…¶å®æ˜¯éµå¾ªäºç»„ä»¶å†…å®šä¹‰çš„ props çš„ç±»å‹çš„ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç»„ä»¶å†…å®šä¹‰çš„ action ç±»å‹å’Œ action creator ä¸­å®šä¹‰çš„ç±»å‹ä¸åŒï¼Œä¾‹å¦‚ä¼ å…¥å‚æ•°ä¸åŒï¼Œé‚£ä¹ˆå®é™…ä¸Š TypeScript æ˜¯æ£€æµ‹ä¸å‡ºè¿™ä¸ªé—®é¢˜çš„ã€‚è¿™æ ·å°±ä¼šå¼•èµ·ä¸å¿…è¦çš„ Bugã€‚è€Œä½¿ç”¨ Hooks å®Œå…¨å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ç›´æ¥æŠŠ action creator å¼•è¿›æ¥çš„ï¼ŒTypeScript å¯ä»¥è¯†åˆ«å‡º action creator ä¸­å®šä¹‰çš„ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ ä¼ å…¥äº†é”™è¯¯çš„å‚æ•°ï¼Œé‚£ä¹ˆæ­¤æ—¶ TypeScript ç¼–è¯‘æ˜¯ä¸ä¼šé€šè¿‡çš„ã€‚æ‰€ä»¥å¯è§ï¼Œä½¿ç”¨ Hooks å¯ä»¥å‡å°‘å¼€å‘ä¸­äº§ç”Ÿ bug çš„å‡ ç‡ï¼Œä¹Ÿç®€åŒ–äº†ä»£ç ï¼Œæ›´æ˜“è¯»æ›´æ˜“ç»´æŠ¤ã€‚&lt;/p&gt;

&lt;h1 id=&#34;tech-spec&#34;&gt;Tech Spec&lt;/h1&gt;

&lt;h2 id=&#34;useeffect&#34;&gt;useEffect&lt;/h2&gt;

&lt;p&gt;Class Component å¯¹äºæˆ‘ä»¬æ¥è¯´æœ‰è¶³å¤Ÿçš„åŠŸèƒ½æ–°ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç”Ÿå‘½å‘¨æœŸé’©å­æ¥å®ç°å¾ˆå¤šå¤æ‚çš„åŠŸèƒ½ï¼Œè¿™æ˜¯åœ¨ React v16.8 å‰ Functional Component æ— æ³•å®ç°çš„ã€‚è¿™ä¹Ÿæ˜¯ä¹‹å‰æˆ‘å–œæ¬¢ç”¨ Class Component çš„åŸå› ã€‚è€Œ useEffect è¿™ä¸ªè¿‘ä¹â€œä¸‡èƒ½â€çš„ hook å¯ä»¥å®ç°å‡ ä¹æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œè¿™å¯¹äº Functional Component éå¸¸å…³é”®ï¼Œä¹Ÿæ˜¯æˆ‘é‡æ„ç»„ä»¶æœ€ä¾èµ–çš„ä¸€ä¸ª hookã€‚useEffect çš„ç±»å‹ç­¾åå¦‚ä¸‹:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt;function useEffect(effect: EffectCallback, deps?: DependencyList): void;

type EffectCallback = () =&amp;gt; (void | (() =&amp;gt; void | undefined));
type DependencyList = ReadonlyArray&amp;lt;any&amp;gt;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ° &lt;code&gt;useEffect&lt;/code&gt; æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª callbackï¼Œé‡Œé¢å†™çš„æ˜¯æˆ‘ä»¬çš„é€»è¾‘ã€‚è€Œç¬¬äºŒä¸ªå‚æ•°ä¸è¦å°çœ‹å®ƒï¼Œè™½ç„¶å®ƒæ˜¯å¯é€‰å‚æ•°ï¼Œä½†æ˜¯å¦‚ä½•ç©è½¬ &lt;code&gt;useEffect&lt;/code&gt; å®Œå…¨å°±é å®ƒäº†ï¼å®ƒæ˜¯â€œä¾èµ–â€ï¼ŒReact å®˜ç½‘ä¹Ÿæœ‰ä¸å°çš„ç¯‡å¹…æ¥æè¿°æ€æ ·ä½¿ç”¨å®ƒã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªâ€œä¾èµ–â€ï¼Œå°±æ˜¯&lt;strong&gt;å½“å®ƒæ”¹å˜çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œé‡Œé¢çš„ callback&lt;/strong&gt;ã€‚å…ˆè¯´ä¸‹ä¸ä¼ è¿™ä¸ªå‚æ•°çš„æƒ…å†µï¼Œé‚£å°±æ˜¯æ¯æ¬¡ re-render éƒ½ä¼šè°ƒç”¨è¿™ä¸ª hookã€‚è€Œæˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­å¾€å¾€ä¸ä¼šå¸Œæœ›æˆ‘ä»¬æ‰€æœ‰çš„ &lt;code&gt;useEffect&lt;/code&gt; çš„ callback åœ¨æ¯æ¬¡æ¸²æŸ“éƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚æ‰€ä»¥â€œä¾èµ–â€çš„ä½œç”¨å°±åœ¨äºæ­¤ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt;useEffect(() =&amp;gt; {
  console.log(props.name)
}, [props.name])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¸ª hook åªä¼šåœ¨ &lt;code&gt;props.name&lt;/code&gt; å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æŠŠ &lt;code&gt;props.name&lt;/code&gt; åœ¨æ§åˆ¶å°æ‰“å°å‡ºæ¥ã€‚è¿™ä¸ªç›¸å½“äº Class Component ä¸­çš„ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt;public componentDidUpdate(prevProps) {
  if (this.props.name !== prevProps.name) {
    console.log(this.props.name)
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ–è€…æ˜¯å³å°†è¢«åºŸå¼ƒçš„ &lt;code&gt;componentWillReceiveProps&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è€Œå¦‚æœæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªä¾èµ–å‘¢ï¼Ÿè¿™å…¶å®æŒºçº ç»“çš„ï¼Œå› ä¸ºå¦‚æœä½ åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨äº† eslintï¼Œé‚£ä¹ˆè¿™é‡Œå®ƒä¼šæç¤ºä¸€ä¸ª &lt;code&gt;exhaustive-deps&lt;/code&gt; çš„ warningã€‚è€Œå¦‚æœä½ å¼€äº† Prettier çš„ eslint é”™è¯¯è‡ªåŠ¨ä¿®å¤ã€‚ã€‚ã€‚é‚£ä¸å¥½æ„æ€ï¼Œè¦ä¹ˆä½ åªèƒ½ä¸å†™ï¼Œè¦ä¹ˆä¼šè¢«å¼ºåˆ¶æ”¹æˆé‡Œé¢æ‰€æœ‰ç”¨åˆ°çš„ä¾èµ–ï¼Œå¦‚ stateã€props æˆ–è€…å…¶ä»–å˜é‡ç­‰ã€‚èµ·åˆæˆ‘ä¹Ÿé™·å…¥äº†æ·±æ€ï¼Œåˆ°åº•æ˜¯ä¸å…è®¸è¿™ä¹ˆå†™ï¼Œè¿˜æ˜¯ eslint æœ‰æ¯›ç—…å‘¢ï¼Ÿä½†æ˜¯å®é™…ä¸Šï¼Œæˆ‘ä»¬åº”è¯¥å…ˆæŠ›å¼ƒ eslintï¼Œå…ˆåœ¨è¿™å°†å®ƒ disable äº†ï¼Œå› ä¸º &lt;code&gt;useEffect&lt;/code&gt; èƒ½å¤Ÿåšåˆ°çš„è¿œæ¯”æˆ‘ä»¬æƒ³è±¡çš„å¤šã€‚&lt;/p&gt;

&lt;p&gt;ä¸Šé¢æ—¢ç„¶æˆ‘ä»¬å®ç°äº† &lt;code&gt;componentDidUpdate&lt;/code&gt;ï¼Œé‚£å…¶ä»–çš„é’©å­å‘¢ï¼Ÿæœ‰ä¸¤ä¸ªå¾ˆå…³é”®çš„é’©å­ &lt;code&gt;componentDidMount&lt;/code&gt; å’Œ &lt;code&gt;componentWillUnmount&lt;/code&gt; æˆ‘ä»¬è¿˜ä¸çŸ¥é“æ€ä¹ˆå®ç°å‘¢ã€‚è€Œæˆ‘ä¹‹å‰æåˆ°å®ƒæ˜¯â€œè¿‘ä¹â€˜ä¸‡èƒ½â€™â€çš„ï¼Œæ˜¯çš„ï¼Œå®ƒå°±æ˜¯å¯ä»¥å®ç°è¿™äº›ç”Ÿå‘½å‘¨æœŸé’©å­çš„æ•ˆæœã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†å®ç° &lt;code&gt;componentDidMount&lt;/code&gt;ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ä¾èµ–ä¸­ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ &lt;code&gt;[]&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è€Œä¸ºäº†å®ç° &lt;code&gt;componentWillUnmount&lt;/code&gt;ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ &lt;code&gt;useEffect&lt;/code&gt; ä¸­ return ä¸€ä¸ª callbackï¼Œé‚£ä¸ª callback ä¾¿æ˜¯åœ¨ &lt;code&gt;componentWillUnmount&lt;/code&gt; æ—¶æ‰§è¡Œçš„ã€‚ä¸Šé¢æåˆ°çš„&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-TypeScript&#34;&gt;type EffectCallback = () =&amp;gt; (void | (() =&amp;gt; void | undefined));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ˜¯æœ‰å†™è¿”å›å€¼ç±»å‹çš„ï¼Œè€Œå®ƒä¹Ÿä¸æ˜¯ç™½å†™çš„ï¼Œæ­£æ˜¯ç”¨åœ¨è¿™ç§åœºæ™¯ã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;ä¾èµ–å¾ˆä¸‡èƒ½ï¼Œä½†æ˜¯ä¸è¦ä¹±ç”¨ï¼Œå› ä¸ºä¹±å†™ä¾èµ–ä¼šå¯¼è‡´ä½ çš„ç»„ä»¶æ¸²æŸ“çš„è¡Œä¸ºå¼‚å¸¸ï¼Œç”šè‡³ä¼šå¯¼è‡´ Infinite Loop (&lt;code&gt;useEffect&lt;/code&gt; çš„ callback è§¦å‘äº†æŸä¸ªå˜é‡çš„å˜åŒ–å¯¼è‡´äº† re-render, è€Œ re-render åˆè§¦å‘äº† useEffect å¹¶è¿è¡Œäº† callback)ã€‚å› ä¸º re-render å¤§æ¦‚æ˜¯æˆ‘ä»¬åœ¨ React å¼€å‘ä¸­æœ€ç»å¸¸éœ€è¦å¤„ç†çš„ä¸€ä»¶äº‹äº†ï¼Œæ‰€ä»¥ç”¨å¥½ &lt;code&gt;useEffect&lt;/code&gt; æ˜¯ç”¨å¥½ React hooks çš„å…³é”®ã€‚&lt;/p&gt;

&lt;h2 id=&#34;hooks-in-react-redux&#34;&gt;Hooks in react-redux&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://react-redux.js.org/api/hooks&#34;&gt;Hooks&lt;/a&gt; åœ¨ react-redux ä¸­æœ‰ä¸“é—¨çš„æ–‡æ¡£ä»‹ç»ã€‚å¸¸ç”¨çš„ API å…¶å®å°±ä¸¤ä¸ªï¼šç”¨äºè·å– state çš„ &lt;code&gt;useSelector&lt;/code&gt; å’Œç”¨æˆ· dispatch action çš„ &lt;code&gt;useDispatch&lt;/code&gt;ã€‚ä½¿ç”¨çš„æ–¹å¼å¾ˆç®€å•ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£å°±å¯ä»¥äº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;useselector&#34;&gt;useSelector&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;useSelector&lt;/code&gt; å…è®¸æˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;reselect&lt;/code&gt; çš„ selector è¿›è¡Œ memorize çš„æ“ä½œï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä» redux store ä¸­è·å–ç›¸åº”çš„ propertyã€‚ä½†æ˜¯æœ‰ä¸ªâ€œæ¯”è¾ƒâ€çš„é—®é¢˜ï¼Œå°±æ˜¯å®˜æ–¹æ–‡æ¡£ä½¿ç”¨äº† === çš„æ¯”è¾ƒï¼ˆ&lt;a href=&#34;https://github.com/reduxjs/react-redux/blob/316467a07e29911d82ba0342364a907e05d9066c/src/hooks/useSelector.js#L17&#34;&gt;å‚è€ƒæºç &lt;/a&gt;ï¼‰ï¼Œè€Œå¦‚æœæˆ‘ä»¬ select å‡ºæ¥çš„æ˜¯ Objectï¼Œé‚£æ¯æ¬¡æ¯”è¾ƒå‡ºæ¥çš„ Object éƒ½æ˜¯ä¸åŒçš„ã€‚å› ä¸º reducer éµå¾ªäº†çº¯å‡½æ•°çš„åŸåˆ™ï¼Œæ¯æ¬¡éƒ½ä¼š return ä¸€ä¸ªæ–°çš„ stateï¼Œè€Œ state æ˜¯ä¸€ä¸ª JavaScript Plain Objectï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡ return å‡ºæ¥çš„ Object æŒ‡å‘çš„å†…å­˜åœ°å€éƒ½æ˜¯ä¸åŒçš„ï¼Œé‚£ä¹ˆ select å‡ºæ¥çš„ Object ä¹Ÿæ˜¯ä¸åŒçš„ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´&lt;strong&gt;æ¯æ¬¡ redux store æœ‰å˜åŒ–ï¼Œè¿™ä¸ªç»„ä»¶å°±ä¼šé‡æ–°æ¸²æŸ“&lt;/strong&gt;ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æµ…æ¯”è¾ƒäº†ã€‚å®˜æ–¹ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª &lt;code&gt;shallowEqual&lt;/code&gt; å‡½æ•°ï¼Œè®©æˆ‘ä»¬å¯ä»¥åšæµ…æ¯”è¾ƒã€‚è¿™ä¸ªæ–¹æ³•å…¶å®åœ¨æ—©å‰çš„ react-redux ç‰ˆæœ¬ä¸­å°±æœ‰äº†ï¼Œå› ä¸ºä¹‹å‰ react-redux çš„ connect å°±æ˜¯ç”¨äº† shallowEqual çš„ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¸å¦‚ lodash ä¸­çš„æµ…æ¯”è¾ƒæ–¹æ³•ã€‚&lt;/p&gt;

&lt;h3 id=&#34;usedispatch&#34;&gt;useDispatch&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;useDispatch&lt;/code&gt; å…¶å®æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸æ¥æ”¶ä»»ä½•å‚æ•°ï¼Œåªèƒ½åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;const dispatch = useDispatch()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®ƒçš„åŠŸèƒ½å°±æ˜¯ redux ä¸­çš„ &lt;code&gt;store.dispatch&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;react-memo&#34;&gt;React.memo&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;React.memo&lt;/code&gt; å…¶å®å¹¶ä¸æ˜¯ Hooks çš„å†…å®¹ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬åªèƒ½åœ¨ Functional Component ä¸­ä½¿ç”¨ Hooksï¼ŒClass Component ä¸­èƒ½ç”¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¹Ÿéƒ½ä¸èƒ½ç”¨ï¼Œæ‰€ä»¥ä¹‹å‰çš„
&lt;code&gt;React.PureComponent&lt;/code&gt; å’Œ &lt;code&gt;shouldComponentUpdate()&lt;/code&gt; ä¹Ÿéƒ½æ— æ³•ä½¿ç”¨ã€‚é‚£ä¹ˆå¯¹äºåº”ç”¨ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ‰‹æ®µåœ¨ Functional Component ä¸­éƒ½æ— æ³•ä½¿ç”¨äº†ã€‚&lt;code&gt;React.memo&lt;/code&gt; çš„å‡ºç°å°±å¾ˆæœ‰æ•ˆåœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å®ƒèƒ½å®ç°ä¸ &lt;code&gt;React.PureComponent&lt;/code&gt; å’Œ &lt;code&gt;shouldComponentUpdate()&lt;/code&gt; ç›¸åŒçš„åŠŸèƒ½ï¼Œå°±æ˜¯é˜²æ­¢çˆ¶ç»„ä»¶ re-render å¯¼è‡´çš„å­ç»„ä»¶çš„ä¸å¿…è¦çš„ re-renderã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºâ€œä¸å¿…è¦çš„ re-renderâ€ï¼Œä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå°±æ˜¯çˆ¶ç»„ä»¶ä½¿ç”¨ &lt;code&gt;useSelector&lt;/code&gt; è®¢é˜…äº† redux store çš„æŸä¸ªå±æ€§ï¼Œä½†æ˜¯å®ƒä¸å­ç»„ä»¶æ— å…³ã€‚å¦‚æœè¿™ä¸ªå±æ€§æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆæŒ‰ç…§ React çš„ diff ç®—æ³•ï¼Œå®ƒçš„å­ç»„ä»¶éƒ½ä¼š re-render ä¸€éã€‚è¿™ä¹Ÿä¸èƒ½è¯´ React æœ¬èº«æœ‰é—®é¢˜ï¼Œå› ä¸º diff ç®—æ³•å·²ç»è¶³å¤Ÿå¥½ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°è§£å†³ React æ¸²æŸ“è®¡ç®—çš„é—®é¢˜ã€‚é‚£ä¹ˆæˆ‘ä»¬å…¶å®æ˜¯ä¸å¸Œæœ›ä¸è¯¥å±æ€§æ— å…³çš„å­ç»„ä»¶å» re-render çš„ï¼Œå› ä¸ºå¯¹æˆ‘ä»¬æ¥è¯´å®ƒå…¶å®ä¸€ç‚¹å˜åŒ–éƒ½æ²¡æœ‰ã€‚æ‰€ä»¥ &lt;code&gt;React.memo&lt;/code&gt;ã€&lt;code&gt;React.PureComponent&lt;/code&gt; å’Œ &lt;code&gt;shouldComponentUpdate()&lt;/code&gt; å°±æ˜¯ç”¨äºè§£å†³è¿™ç§é—®é¢˜çš„ã€‚&lt;/p&gt;

&lt;p&gt;å®ƒåœ¨ react-redux ä¸­ä¹ŸæŒºé‡è¦çš„ï¼Œå› ä¸ºå®˜æ–¹è¯´ &lt;code&gt;useSelector&lt;/code&gt; ä¸ä¼šé˜»æ­¢å­ç»„ä»¶çš„ä¸å¿…è¦çš„ re-renderï¼Œè€Œå®˜æ–¹ä¹Ÿæ¨èä½¿ç”¨ &lt;code&gt;React.memo&lt;/code&gt; è¿›è¡Œä¼˜åŒ–ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å•å…ƒæµ‹è¯•&#34;&gt;å•å…ƒæµ‹è¯•&lt;/h2&gt;

&lt;p&gt;å…¶å® Hooks å¹¶ä¸æ˜¯å®Œç¾çš„ï¼Œæ¯”å¦‚å•å…ƒæµ‹è¯•ã€‚&lt;/p&gt;

&lt;p&gt;Jest + Enzyme æ˜¯ React ä¸­å¸¸ç”¨çš„å•å…ƒæµ‹è¯•åº“ï¼Œä½†æ˜¯ Enzyme å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°ï¼š&lt;code&gt;With React 16 and above, instance() returns null for stateless functional components.&lt;/code&gt;ã€‚å¯¹äº Hooks è€Œè¨€ï¼ˆä½¿ç”¨äº† Hooks çš„ç»„ä»¶å¿…ç„¶æ˜¯ functional componentsï¼‰ï¼Œè™½ç„¶å®˜æ–¹æ–‡æ¡£ä¹Ÿè¯´æ˜äº†&lt;a href=&#34;https://github.com/airbnb/enzyme#react-hooks-support&#34;&gt;å¯¹ Hooks çš„æ”¯æŒ&lt;/a&gt;ï¼šç›®å‰åªåœ¨ &lt;code&gt;shallow()&lt;/code&gt; é‡Œæä¾›æœ‰é™çš„æ”¯æŒï¼Œä½†æ˜¯æƒ³è¦ç…§æ¬ class component ä¸­ç”¨çš„æµ‹è¯•å¥—è·¯æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚React å®˜æ–¹åˆ™æ¨èä½¿ç”¨ &lt;a href=&#34;https://github.com/testing-library/react-testing-library&#34;&gt;react-testing-library&lt;/a&gt; æ¥æµ‹è¯•ã€‚&lt;strong&gt;ä½†æ˜¯è¿™äº›ç›®å‰åªèƒ½æµ‹è¯• React å®˜æ–¹çš„ Hooksï¼Œå¯¹äº react-redux çš„ &lt;code&gt;useDispatch&lt;/code&gt; å’Œ &lt;code&gt;useSelector&lt;/code&gt;ï¼Œç›®å‰æˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°æµ‹è¯•çš„æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ•™ç¨‹æˆ–è€…æ–‡æ¡£ï¼Œç”šè‡³ react-redux å®˜æ–¹ä¹Ÿæ²¡æœ‰è¯¦ç»†çš„æ•™ç¨‹ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç›¸æ¯”ä¹‹ä¸‹ï¼Œclass component å¯ä»¥ç›´æ¥æŠŠæ‰€æœ‰çš„ connect ä»¥åŠå…¶ä»–é«˜é˜¶ç»„ä»¶å’Œ dumb component å‰¥ç¦»å¼€æ¥æµ‹è¯•ï¼Œå› ä¸ºæˆ‘ä»¬æµ‹è¯•ç»„ä»¶ä»…ä»…å…³æ³¨çš„æ˜¯ dumb component ä¸Šçš„é€»è¾‘ï¼Œé«˜é˜¶ç»„ä»¶æ³¨å…¥çš„ props å®Œå…¨å¯ä»¥é€šè¿‡ mock æ¥åšï¼ˆé€šå¸¸æˆ‘ä¼šç›´æ¥æ— è§† TypeScript çš„ç±»å‹é”™è¯¯ï¼Œå› ä¸ºå¾ˆå¤š props å…¶å®æµ‹è¯•ä¸­æ˜¯ä¸å¿…è¦çš„ï¼Œä¾‹å¦‚ react-intl çš„é«˜é˜¶ç»„ä»¶æ³¨å…¥çš„é‚£äº› propsï¼‰ã€‚ä½†æ˜¯å¯¹äº Hooksï¼Œæ²¡æœ‰äº† connectï¼Œä¹Ÿå°±æ˜¯è¯´ redux å’Œ dumb component å…¶å®æ˜¯è€¦åˆåœ¨ä¸€èµ·äº†ï¼Œåšå•å…ƒæµ‹è¯•é¦–å…ˆå°±ä¼šæç¤ºï¼Œå¿…é¡»ç”¨ react-redux çš„ &lt;code&gt;&amp;lt;Provider&amp;gt;&lt;/code&gt; æŠŠç»„ä»¶åŒ…è£¹èµ·æ¥ã€‚è¿™æ ·å…¶å®æ— å½¢ä¸­å¢åŠ äº†æµ‹è¯•çš„éš¾åº¦ã€‚&lt;/p&gt;

&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h1&gt;

&lt;p&gt;Hooks æ˜¯ä¸ªæ–°æŠ€æœ¯ï¼Œå®ƒç¡®å®ç»™æˆ‘ä»¬çš„å¼€å‘å¸¦æ¥äº†ä¾¿åˆ©ï¼Œä½†æ˜¯å•å…ƒæµ‹è¯•ä¸Šå´å¹¶ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œå°±æ˜¯åªåœ¨æ„åŠŸèƒ½è€Œå¿½è§†äº†ä»£ç è´¨é‡ã€‚åªæœ‰åŠŸèƒ½å’Œè´¨é‡åŒæ—¶æœ‰ä¿éšœçš„ä»£ç æ‰æ˜¯å¥½çš„ä»£ç ã€‚å…³äºå•å…ƒæµ‹è¯•è¿™éƒ¨åˆ†ï¼Œæˆ‘ä¼šç»§ç»­ç ”ç©¶å¹¶ç»§ç»­å…³æ³¨ç¤¾åŒºä¸Šçš„ç›¸å…³åŠ¨æ€ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Next.js å®æˆ˜ï¼šä» CSR è¿ç§»åˆ° SSR</title>
      <link>https://elizurhz.cn/frontend/mirgation-from-csr-to-ssr/</link>
      <pubDate>Tue, 26 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/frontend/mirgation-from-csr-to-ssr/</guid>
      <description>

&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;CSR: å®¢æˆ·ç«¯æ¸²æŸ“ï¼ŒClient Side Rendering&lt;/li&gt;
&lt;li&gt;SSR: æœåŠ¡ç«¯æ¸²æŸ“ï¼ŒServer Side Rendering&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;tl-dr&#34;&gt;TL;DR&lt;/h2&gt;

&lt;p&gt;ç›®å‰æ­£åœ¨åšä¸€ä¸ªé¡¹ç›®ï¼Œç”±äºé‡‡ç”¨äº†æ•æ·å¼€å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„è‡ªä¸»æƒæ¯”è¾ƒå¤§ï¼Œé¢†å¯¼ä¹Ÿè®©æˆ‘ä»¬å°è¯•ä½¿ç”¨ SSRï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªç„¶è€Œç„¶åœ¨åŸæœ‰çš„ create-react-app åˆ›å»ºçš„åº”ç”¨çš„åŸºç¡€ä¸Šé€‰æ‹©äº† Next.jsã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢å¤§è‡´è¯´æ˜ä¸€ä¸‹ SSR é¡¹ç›®ä¸ CSR é¡¹ç›®åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒã€‚&lt;/p&gt;

&lt;h2 id=&#34;å…³äºæµè§ˆå™¨ä¸-dom&#34;&gt;å…³äºæµè§ˆå™¨ä¸ DOM&lt;/h2&gt;

&lt;p&gt;SSR é¡¹ç›®è¿˜æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æµè§ˆå™¨çš„é¡¹ç›®ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥æ”¯æŒæµè§ˆå™¨ API çš„ï¼Œä½†æ˜¯å®ƒæ˜¯ç”±ä¸€ä¸ª Node.js æœåŠ¡å™¨æ¥å†™å…¥ htmlï¼Œè€Œä¸æ˜¯åƒ CSR ä¸€æ ·åŠ è½½é™æ€çš„ js æ¥æ¸²æŸ“ã€‚è¿™æ ·ä¼šå¯¼è‡´é—®é¢˜å°±æ˜¯ï¼Œå¦‚æœåœ¨æ¸²æŸ“æ—¶ç«‹å³è°ƒç”¨äº†æµè§ˆå™¨/DOM ç›¸å…³çš„ APIï¼Œæ­¤æ—¶å¯èƒ½æµè§ˆå™¨ç¯å¢ƒè¿˜æœªåŠ è½½å®Œæˆï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç° &lt;code&gt;document is not defined&lt;/code&gt; çš„é”™è¯¯ã€‚&lt;/p&gt;

&lt;p&gt;å…³äº &lt;code&gt;document is not defined&lt;/code&gt;ï¼Œæ¯”è¾ƒå¸¸é‡åˆ°çš„æƒ…å†µæœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é¡µé¢è°ƒç”¨äº† documentã€window ç›¸å…³çš„ API&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨äº† ReactDOM.createPortalã€‚ç”±äº ReactDOM.createPortal å¿…é¡»æœ‰ä¸€ä¸ªæŒ‚è½½çš„ DOM èŠ‚ç‚¹ï¼Œæ‰€ä»¥åœ¨æµè§ˆå™¨ç¯å¢ƒå®Œæˆå‰æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯åœ¨ &lt;code&gt;componentDidMount&lt;/code&gt; ä¹‹åå†åŠ è½½ï¼šç”¨å˜é‡è¿›è¡Œæ¡ä»¶æ¸²æŸ“ï¼Œå‚è€ƒ&lt;a href=&#34;https://github.com/zeit/next.js/tree/canary/examples/with-portals&#34;&gt;å®˜æ–¹ä¾‹å­&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æŸäº›ç»„ä»¶å¦‚æœä½¿ç”¨ DOM APIï¼Œä¸”åœ¨è¢«å¼•ç”¨æ—¶æœªä½¿ç”¨ &lt;code&gt;next/dynamic&lt;/code&gt; è¿›è¡Œå¼‚æ­¥åŠ è½½ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´è¿™ç§é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;packages&#34;&gt;Packages&lt;/h2&gt;

&lt;p&gt;å¤§éƒ¨åˆ† CSR App ä¸­å…³é”®çš„ packages éƒ½å¯ä»¥ç›´æ¥åœ¨ Next.js ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚ redux, redux-saga, react-intl ç­‰ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ–¹å¼å’Œåœ¨ CSR App ä¸­çš„æœ‰æ‰€åŒºåˆ«ã€‚å¦å¤–ï¼ŒNext.js ä¸­éœ€è¦ä½¿ç”¨ &lt;code&gt;@zeit&lt;/code&gt; çš„ä¸€äº› packagesï¼Œå®ƒä»¬ä¸ SSR ç›¸å…³ã€‚&lt;/p&gt;

&lt;h2 id=&#34;next-config-js&#34;&gt;next.config.js&lt;/h2&gt;

&lt;p&gt;è¿™ä¸ªæ˜¯æ”¾åœ¨æ ¹ç›®å½•çš„ next çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¯ä»¥é…ç½®ä¸€äº› webpack loaders çš„æ”¯æŒï¼Œä¾‹å¦‚ CSSï¼ˆå¦‚æœä¸é…ç½®å°±åªèƒ½æ”¯æŒè¡Œå†…å’Œ styled-jsxï¼‰, SASS, TypeScript ç­‰ï¼Œéœ€è¦å®‰è£…ä¸€äº› &lt;code&gt;@zeit&lt;/code&gt; çš„ pluginsã€‚&lt;/p&gt;

&lt;p&gt;æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œæˆ‘åšäº†å¦‚ä¸‹é…ç½®ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const withTypescript = require(&amp;quot;@zeit/next-typescript&amp;quot;);
const withCSS = require(&amp;quot;@zeit/next-css&amp;quot;);
const withSass = require(&amp;quot;@zeit/next-sass&amp;quot;);

module.exports = withSass(withCSS(withTypescript()));
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;æ ·å¼&#34;&gt;æ ·å¼&lt;/h3&gt;

&lt;p&gt;åœ¨ Next.js ä¸­ï¼Œæ ·å¼é»˜è®¤ä½¿ç”¨çš„æ˜¯ React çš„ inline style æˆ–è€… Next.js çš„ styled-jsxï¼Œå®ƒä»¬åªèƒ½å†™åœ¨ç»„ä»¶æ–‡ä»¶ä¸­ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ç‹¬ç«‹çš„ css æ–‡ä»¶æˆ–è€…å…¶ä»– css é¢„å¤„ç†å™¨ï¼Œé‚£ä¹ˆéœ€è¦å®‰è£…ç›¸å…³çš„&lt;a href=&#34;https://nextjs.org/docs/#importing-css--sass--less--stylus-files&#34;&gt;æ’ä»¶&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å°±å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼Œæ’ä»¶å®‰è£…å®Œä¹‹åéœ€è¦åœ¨ &lt;code&gt;next.config.js&lt;/code&gt; ä¸­è¿›è¡Œé…ç½®ã€‚&lt;/p&gt;

&lt;h3 id=&#34;typescript&#34;&gt;TypeScript&lt;/h3&gt;

&lt;p&gt;Next.js å®˜æ–¹æœ‰ TypeScript æ”¯æŒï¼Œéœ€è¦å®‰è£… &lt;code&gt;@zeit/next-typescript&lt;/code&gt; è¿™ä¸ªæ’ä»¶ï¼Œå¹¶é…ç½® &lt;code&gt;tsconfig.json&lt;/code&gt; å’Œ &lt;code&gt;next.config.js&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;server-js&#34;&gt;server.js&lt;/h2&gt;

&lt;p&gt;è¿™æ˜¯ SSR å’Œ CSR æœ€å¤§çš„ä¸åŒ â€”â€” æˆ‘ä»¬éœ€è¦ä¸€ä¸ª Node.js æœåŠ¡å™¨ã€‚åœ¨ &lt;code&gt;package.json&lt;/code&gt; ä¸­ï¼Œé»˜è®¤çš„ &lt;code&gt;scripts&lt;/code&gt; ä¼šè¿è¡Œ &lt;code&gt;next&lt;/code&gt; è¿™ä¸ªå‘½ä»¤ï¼Œå¯åŠ¨çš„æ˜¯ Next.js å†…ç½®çš„ SSR æœåŠ¡å™¨ï¼Œè€Œå¦‚æœæˆ‘ä»¬å†™ä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œå¹¶åœ¨ &lt;code&gt;scripts&lt;/code&gt; ä¸­è¿è¡Œå®ƒï¼ŒåŒæ ·å¯ä»¥å®ç° SSR çš„åŠŸèƒ½ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥åœ¨é‡Œé¢å®šåˆ¶è·¯ç”±ã€æ¸²æŸ“æ–¹å¼ã€ç¼“å­˜ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;h3 id=&#34;è·¯ç”±&#34;&gt;è·¯ç”±&lt;/h3&gt;

&lt;p&gt;åœ¨ Next.js ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Node.js æ¡†æ¶ï¼ˆKoaï¼‰çš„è·¯ç”±ï¼Œæ‰€ä»¥ &lt;code&gt;react-router&lt;/code&gt; ç›¸å…³çš„ä»£ç éƒ½å¿…é¡»æ›´æ”¹ã€‚è¯¦æƒ…å¯ä»¥å‚è€ƒ&lt;a href=&#34;https://nextjs.org/docs/#routing&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;react-router&lt;/code&gt; çš„ history æ— æ³•åœ¨ Next.js ä¸­ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;next/router&lt;/code&gt; æ›¿ä»£ä¹‹ï¼ˆ&lt;code&gt;import Router from &#39;next/router&#39;&lt;/code&gt;ï¼‰ã€‚ä¾‹å¦‚ &lt;code&gt;history.push()&lt;/code&gt; å¯ä»¥ç”¨ &lt;code&gt;Router.push()&lt;/code&gt; æ›¿ä»£ï¼›ä¹Ÿå¯ä»¥ &lt;code&gt;import { withRouter } from &#39;next/router&#39;&lt;/code&gt; æ¥æŠŠè·¯ç”±å‚æ•°æ³¨å…¥åˆ°ç»„ä»¶çš„ props ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;åŸæœ¬çš„ &lt;code&gt;react-router-dom&lt;/code&gt; ä¸­çš„ &lt;code&gt;&amp;lt;Link&amp;gt;&lt;/code&gt; å¯ä»¥è¢« &lt;code&gt;next/link&lt;/code&gt; çš„ &lt;code&gt;&amp;lt;Link&amp;gt;&lt;/code&gt; å–ä»£ï¼Œä½†æ˜¯ props æœ‰æ‰€ä¸åŒï¼Œæ¯”å¦‚ &lt;code&gt;to&lt;/code&gt; éœ€è¦æ¢æˆ &lt;code&gt;href&lt;/code&gt;ï¼Œä»¥åŠ &lt;code&gt;&amp;lt;Link&amp;gt;&lt;/code&gt; ä¸­ä¸èƒ½ä½¿ç”¨ text èŠ‚ç‚¹ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;è·¯ç”±ä¸ &lt;code&gt;.js/.tsx&lt;/code&gt; æ–‡ä»¶çš„ç»‘å®šåœ¨ Koa ä¸­å®Œæˆï¼Œä½¿ç”¨ &lt;code&gt;koa-router&lt;/code&gt; çš„å†™æ³•ï¼Œå½“æµè§ˆå™¨è®¿é—®è·¯ç”±æ—¶ï¼Œç”±æœåŠ¡ç«¯çš„ä¸­é—´ä»¶è®¾ç½®å¯¹åº”çš„ return body å¹¶è¿”å›ç»™å‰ç«¯ã€‚å…·ä½“å¯ä»¥å‚è€ƒ &lt;a href=&#34;https://github.com/ZijianHe/koa-router&#34;&gt;koa-router&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;å›½é™…åŒ–&#34;&gt;å›½é™…åŒ–&lt;/h3&gt;

&lt;p&gt;å›½é™…åŒ–çš„æ–¹å¼å·²ç»åœ¨ä¸Šé¢çš„ &lt;code&gt;server.js&lt;/code&gt; çš„éƒ¨åˆ†å™è¿°è¿‡ã€‚åœ¨é¡¹ç›®ä¸­æˆ‘ä»¬ä¸€æ ·éœ€è¦ä¸€ä¸ªå­˜æ”¾ &lt;code&gt;.json&lt;/code&gt; ç¿»è¯‘æ–‡ä»¶çš„åœ°æ–¹ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æ˜¯ä¸€æ®µå®˜æ–¹çš„ä»£ç ç¤ºä¾‹ï¼Œæˆ‘åœ¨å®˜æ–¹ä½¿ç”¨çš„ express æ¡†æ¶çš„åŸºç¡€ä¸Šå°†å…¶ä¿®æ”¹æˆäº†é€‚ç”¨äº koa çš„ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const supportedLanguages = glob
  .sync(&amp;quot;./lang/*.json&amp;quot;)
  .map(f =&amp;gt; basename(f, &amp;quot;.json&amp;quot;));
const localeDataCache = new Map();
const getLocaleDataScript = locale =&amp;gt; {
  const lang = locale.split(&amp;quot;-&amp;quot;)[0];
  if (!localeDataCache.has(lang)) {
    const localeDataFile = require.resolve(`react-intl/locale-data/${lang}`);
    const localeDataScript = readFileSync(localeDataFile, &amp;quot;utf8&amp;quot;);
    localeDataCache.set(lang, localeDataScript);
  }
  return localeDataCache.get(lang);
};

const getMessages = locale =&amp;gt; {
  return require(`./lang/${locale}.json`);
};

const localization = ctx =&amp;gt; {
  const { req } = ctx;
  const { query } = ctx.request;
  let locale;
  if (query.lang) {
    locale = query.lang;
  } else {
    const accept = accepts(req);
    locale = accept.language(accept.languages(supportedLanguages)) || &amp;quot;en&amp;quot;;
  }
  req.locale = locale;
  req.localeDataScript = getLocaleDataScript(locale);
  req.messages = getMessages(locale);
  ctx.req = req;
  return ctx;
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ®µä»£ç çš„ç›®çš„æ˜¯ä¿®æ”¹å‰ç«¯è¯·æ±‚æ—¶çš„ contextã€‚æ¥å½“æµè§ˆå™¨è®¿é—®è·¯ç”±æ—¶ï¼ŒæœåŠ¡ç«¯å¯¹åº”çš„ &lt;code&gt;Controller&lt;/code&gt; å¯ä»¥è·å–åˆ° koa çš„ &lt;code&gt;context&lt;/code&gt; å¯¹è±¡ï¼Œå¹¶é€šè¿‡ä¸€äº›æ–¹æ³•æŠŠå½“å‰æ‰€éœ€çš„å›½é™…åŒ–çš„æ–‡ä»¶å†…å®¹åŠ å…¥åˆ° &lt;code&gt;context.req&lt;/code&gt; ä¸­ï¼Œè¿™æ ·å‰ç«¯é¡µé¢å°±å¯ä»¥æ¥æ”¶åˆ°è¿™äº›æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨è·¯ç”±çš„ &lt;code&gt;Controller&lt;/code&gt; å¤„ç† ctx çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨ &lt;code&gt;localization&lt;/code&gt; è¿™ä¸ªå‡½æ•°ï¼Œå¯¹ ctx è¿›è¡Œä¸€å±‚â€œåŒ…è£…â€å³å¯ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ç¼“å­˜&#34;&gt;ç¼“å­˜&lt;/h3&gt;

&lt;p&gt;React SSR æˆ–è€…è¯´ Next.js é‡Œï¼Œæœ€å¸¸ç”¨çš„é¡µé¢ç¼“å­˜å·¥å…·å°±æ˜¯ &lt;code&gt;lru-cache&lt;/code&gt; äº†ã€‚ä½¿ç”¨ &lt;code&gt;lru-cache&lt;/code&gt; å¯ä»¥å‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“ä»¥åŠåŠ å¿«åŠ è½½çš„é€Ÿåº¦ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;const getCacheKey = req =&amp;gt; `${req.url}`;

function renderAndCache(ctx, pagePath, queryParams) {
  const key = getCacheKey(ctx.req);

  // If we have a page in the cache, let&#39;s serve it
  if (ssrCache.has(key)) {
    console.log(`CACHE HIT: ${key}`);
    ctx.body = ssrCache.get(key);
    return;
  }

  // If not let&#39;s render the page into HTML
  return app
    .renderToHTML(ctx.req, ctx.res, pagePath, queryParams)
    .then(html =&amp;gt; {
      // Let&#39;s cache this page
      console.log(`CACHE MISS: ${key}`);
      ssrCache.set(key, html);
      ctx.body = html;
    })
    .catch(err =&amp;gt; {
      console.log(&amp;quot;ERRR&amp;quot;, err);
      return app.renderError(err, ctx.req, ctx.res, pagePath, queryParams);
    });
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯åœ¨å‘å‰ç«¯è¿”å›æ•°æ®æ—¶è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœ å­˜åœ¨ cache keyï¼Œåˆ™è°ƒå–ç¼“å­˜ä¸­ç›¸åº”çš„å†…å®¹ï¼›å¦åˆ™æœåŠ¡ç«¯æ‰ä¼šæ ¹æ®è·¯ç”±è°ƒç”¨ç›¸åº”çš„ &lt;code&gt;Controller&lt;/code&gt; å‘å‰ç«¯è¿”å›æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœéœ€è¦ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å¯ä»¥å°†è·¯ç”±çš„ &lt;code&gt;Controller&lt;/code&gt; ç›´æ¥è®¾æˆ &lt;code&gt;renderAndCache&lt;/code&gt; å‡½æ•°å³å¯ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;router.get(&amp;quot;/your/path&amp;quot;, async ctx =&amp;gt; renderAndCache(ctx, &amp;quot;/your/path&amp;quot;));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœéœ€è¦ç»“åˆå›½é™…åŒ–æ¥ä½¿ç”¨ï¼Œåªè¦å¯¹ &lt;code&gt;renderAndCache&lt;/code&gt; çš„ç¬¬ä¸€ä¸ªå‚æ•° &lt;code&gt;ctx&lt;/code&gt; ä½¿ç”¨ä¸Šé¢çš„ &lt;code&gt;localization&lt;/code&gt; å‡½æ•°è¿›è¡Œå¤„ç†å³å¯ã€‚&lt;/p&gt;

&lt;h2 id=&#34;pages&#34;&gt;pages&lt;/h2&gt;

&lt;p&gt;æ ¹ç›®å½•çš„ &lt;code&gt;pages&lt;/code&gt; æ–‡ä»¶å¤¹æ˜¯ Next.js é»˜è®¤çš„è·¯ç”±å¯¹åº”çš„é¡µé¢å…¥å£ã€‚&lt;/p&gt;

&lt;h3 id=&#34;app-tsx&#34;&gt;_app.tsx&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªæ–‡ä»¶ç›¸å½“äº CSR App ä¸­çš„ &lt;code&gt;App.tsx&lt;/code&gt;ã€‚å¦‚æœä½ ä¸åˆ›å»ºè¿™ä¸ªæ–‡ä»¶ï¼ŒSSR App ä¹Ÿå¯ä»¥è¿è¡Œï¼Œå› ä¸º Next.js ä¸­æœ‰ä¸€ä¸ªé»˜è®¤çš„ &lt;code&gt;_app.tsx&lt;/code&gt;ã€‚æˆ‘ä»¬åˆ›å»ºå®ƒæ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦é‡å†™è¿™ä¸ªä¸»å…¥å£ç»„ä»¶ï¼Œä¾‹å¦‚åŠ å…¥ Redux çš„ &lt;code&gt;&amp;lt;Provider&amp;gt;&lt;/code&gt; å’Œ &lt;code&gt;react-intl&lt;/code&gt; çš„ &lt;code&gt;&amp;lt;IntlProvider&amp;gt;&lt;/code&gt; ç­‰é«˜é˜¶ç»„ä»¶ã€‚&lt;/p&gt;

&lt;h3 id=&#34;document-tsx&#34;&gt;_document.tsx&lt;/h3&gt;

&lt;p&gt;ä¸ &lt;code&gt;_app.tsx&lt;/code&gt; ä¸€æ ·ï¼Œè¿™ä¹Ÿæ˜¯ä¸ª Next.js å†…ç½®çš„ç»„ä»¶ï¼Œè€Œå¦‚æœæˆ‘ä»¬éœ€è¦å®ç°æŸéœåŠŸèƒ½ï¼Œä¹Ÿéœ€è¦é‡å†™å®ƒã€‚å®ƒç›¸å½“äºæ˜¯ CSR App ä¸­çš„ &lt;code&gt;index.html&lt;/code&gt;ã€‚åœ¨ &lt;code&gt;_document.tsx&lt;/code&gt; ä¸­ï¼Œæœ‰ &lt;code&gt;&amp;lt;Head /&amp;gt;&lt;/code&gt;ã€&lt;code&gt;&amp;lt;Main /&amp;gt;&lt;/code&gt;ã€&lt;code&gt;&amp;lt;NextScript /&amp;gt;&lt;/code&gt; ç­‰ç»„ä»¶ï¼Œ&lt;code&gt;&amp;lt;Head /&amp;gt;&lt;/code&gt; å¯¹åº”çš„å°±æ˜¯ html çš„ &lt;code&gt;&amp;lt;head /&amp;gt;&lt;/code&gt; æ ‡ç­¾ï¼Œ&lt;code&gt;&amp;lt;Main /&amp;gt;&lt;/code&gt; çš„ä½ç½®åˆ™ä¼šæ³¨å…¥ &lt;code&gt;_app.tsx&lt;/code&gt; è¿™ä¸ªç»„ä»¶ï¼Œ&lt;code&gt;&amp;lt;NextScript /&amp;gt;&lt;/code&gt; åˆ™æ˜¯æ‰“åŒ…åä¸€äº› js æ–‡ä»¶æ’å…¥çš„ä½ç½®ã€‚ä½ å¯ä»¥åœ¨é‡Œé¢æ·»åŠ  style å’Œ script ç­‰æ ‡ç­¾ï¼Œå®ƒä»¬å°†æœ€ç»ˆä¼šæ¸²æŸ“åœ¨é¡µé¢ä¸Šã€‚&lt;code&gt;&amp;lt;NextScript /&amp;gt;&lt;/code&gt; åœ¨ Next.js çš„ production ç¯å¢ƒä¸­ä¼šé»˜è®¤å¯ç”¨ preloadï¼Œè¿™æ ·å¯ä»¥èŠ‚çº¦åŠ è½½çš„æ—¶é—´ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é¡¹ç›®ç»“æ„&#34;&gt;é¡¹ç›®ç»“æ„&lt;/h2&gt;

&lt;p&gt;æˆ‘ä»¬çš„å®è·µæ–¹å¼æ˜¯ï¼ŒæŠŠ &lt;code&gt;pages&lt;/code&gt; ä½œä¸º Containerï¼Œåœ¨è¿™é‡Œè¿›è¡Œé«˜é˜¶ç»„ä»¶çš„è¿æ¥ï¼ŒåŒ…æ‹¬ reduxã€å›½é™…åŒ–ç­‰ç­‰ã€‚å…¶ä»–çš„ç»“æ„ä¸ react + redux + redux-saga çš„æœ€ä½³å®è·µæ— å¼‚ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ„å»ºæ–¹å¼&#34;&gt;æ„å»ºæ–¹å¼&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;dev&lt;/code&gt; å¯ä»¥å¯åŠ¨ä¸€ä¸ª dev serverï¼Œå®ƒä¼šè‡ªåŠ¨æ„å»ºé¡¹ç›®åˆ°æ ¹ç›®å½•ä¸‹çš„ &lt;code&gt;.next&lt;/code&gt; æ–‡ä»¶å¤¹ä¸­ï¼Œå¯ä»¥åœ¨ä»£ç ä¿å­˜åçƒ­æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœéœ€è¦åœ¨ EC/Docker ä¹‹ç±»çš„ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œï¼Œéœ€è¦å…ˆ &lt;code&gt;build&lt;/code&gt;ï¼Œä»¥ç”Ÿäº§çš„ç¯å¢ƒå˜é‡æ„å»ºé¡¹ç›®ï¼Œå† &lt;code&gt;start&lt;/code&gt; å¯åŠ¨æœåŠ¡ã€‚è¿™é‡Œæˆ‘ä»¬ç›¸å½“äºæ˜¯ç›´æ¥éƒ¨ç½²/ä½¿ç”¨äº† Node.js çš„ runtimeï¼Œå¼€å¯äº†ä¸€ä¸ª Node.js è¿›ç¨‹ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥å¯ä»¥ç”¨ pm2 ç­‰ç®¡ç†å·¥å…·æ¥æ›¿ä»£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;next export&lt;/code&gt; æ˜¯å¯ä»¥è¾“å‡ºé™æ€æ–‡ä»¶çš„ã€‚å®ƒæ˜¯æ ¹æ® pages çš„ç›®å½•ç»“æ„è¾“å‡ºçš„ï¼Œå¯ä»¥ä¸ä¾èµ–äºæœåŠ¡ç«¯æ¥å±•ç¤ºé™æ€é¡µé¢ï¼Œå½“ç„¶æ­£å¸¸çš„ JavaScript ä¹Ÿæ˜¯å¯ä»¥è¿è¡Œçš„ã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹å°±æ˜¯ï¼Œå¦‚æœåœ¨åç«¯åŠ äº†ä¸€äº›ä¿®æ”¹æ¸²æŸ“çš„æ“ä½œï¼Œæ¯”å¦‚ä¸Šé¢æåˆ°çš„ç¼“å­˜å’Œå›½é™…åŒ–ï¼Œé‚£åœ¨è¿™ä¸ªæ‰“åŒ…æ–¹å¼ä¸‹ï¼Œå®ƒä»¬æ˜¯å®Œå…¨ä¸å¯ç”¨çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ æœ‰åœ¨ Node.js å±‚åŠ å…¥ä¸€äº›é™¤è·¯ç”±å¤–çš„é¢å¤–åŠŸèƒ½ï¼Œé‚£ä½ æ˜¯ä¸èƒ½ä½¿ç”¨é™æ€é¡µé¢çš„æ–¹å¼æ„å»ºå¹¶ç›´æ¥ä¸Šä¼ åˆ° github pages æˆ–è€… firebase ç­‰æ‰˜ç®¡æœåŠ¡çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;é”™è¯¯æç¤º&#34;&gt;é”™è¯¯æç¤º&lt;/h2&gt;

&lt;p&gt;ç”±äº Next.js è¿è¡Œæ—¶æ¯æ¬¡éƒ½éœ€è¦ç¼–è¯‘ï¼Œå¦‚æœç¼–è¯‘æœªæŠ¥é”™è€Œåœ¨è¿è¡Œæ—¶æŠ¥é”™ï¼Œé‚£ä¹ˆé”™è¯¯æç¤ºåªä¼šæ˜¾ç¤ºç¼–è¯‘å®Œçš„æ–‡ä»¶çš„é”™è¯¯ä½ç½®ï¼Œè€Œä¸åƒ CSR ä¸€æ ·èƒ½æ˜¾ç¤ºåŸå§‹æ–‡ä»¶çš„é”™è¯¯ä½ç½®ï¼Œè¿™å¯¹è°ƒè¯•éå¸¸ä¸å‹å¥½ã€‚æœ€å¸¸é‡åˆ°çš„å°±æ˜¯ &lt;code&gt;document is not defined&lt;/code&gt;ï¼Œä½†æ˜¯å¤§é¡¹ç›®çš„è¿ç§»ä¸­å¾ˆå¯èƒ½ä¸è®°å¾—è‡ªå·±é‚£ä¸ªåœ°æ–¹ç”¨åˆ°äº† DOM API å¯¼è‡´è¿™æ ·çš„æŠ¥é”™ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å•å…ƒæµ‹è¯•&#34;&gt;å•å…ƒæµ‹è¯•&lt;/h2&gt;

&lt;p&gt;ç”±äº &lt;code&gt;create-react-app&lt;/code&gt; è‡ªå¸¦ jest å¹¶ä¸”å°†æµ‹è¯•å‘½ä»¤é›†æˆåœ¨äº† react-scripts ä¸­ï¼ˆinject ä¹‹å‰ï¼‰ï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢å¤–å¯¹ jest çš„ matchã€mockã€transform ç­‰å±æ€§è¿›è¡Œé…ç½®ã€‚åœ¨ Next.js ä¸­ï¼Œæˆ‘ä»¬åˆ™éœ€è¦é‡æ–°å¯¹ jest è¿›è¡Œé…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä½¿ç”¨çš„ jest é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;module.exports = {
  moduleFileExtensions: [&amp;quot;ts&amp;quot;, &amp;quot;tsx&amp;quot;, &amp;quot;js&amp;quot;],
  transform: {
    &amp;quot;^.+\\.tsx?$&amp;quot;: &amp;quot;ts-jest&amp;quot;,
    &amp;quot;^.+\\.js$&amp;quot;: &amp;quot;babel-jest&amp;quot;
  },
  testMatch: [&amp;quot;**/*.(test|spec).(ts|tsx)&amp;quot;, &amp;quot;**/__tests__/*&amp;quot;],
  globals: {
    &amp;quot;ts-jest&amp;quot;: {
      babelConfig: true,
      tsConfig: &amp;quot;jest.tsconfig.json&amp;quot;
    }
  },
  coveragePathIgnorePatterns: [&amp;quot;/node_modules/&amp;quot;, &amp;quot;enzyme.js&amp;quot;],
  setupFilesAfterEnv: [&amp;quot;&amp;lt;rootDir&amp;gt;/enzyme.js&amp;quot;],
  coverageReporters: [&amp;quot;json&amp;quot;, &amp;quot;lcov&amp;quot;, &amp;quot;text&amp;quot;, &amp;quot;text-summary&amp;quot;],
  moduleNameMapper: {
    &amp;quot;\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$&amp;quot;:
      &amp;quot;&amp;lt;rootDir&amp;gt;/__mocks__/fileMock.js&amp;quot;,
    &amp;quot;\\.(css|less|scss)$&amp;quot;: &amp;quot;&amp;lt;rootDir&amp;gt;/__mocks__/styleMock.js&amp;quot;
  }
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç”±äºæˆ‘ä»¬é¡¹ç›®ä½¿ç”¨äº† TypeScriptï¼Œæ‰€ä»¥éœ€è¦ç”¨ ts-jest æ¥è§£æ TypeScriptï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸‹è¿è¡Œå•å…ƒæµ‹è¯•æ˜¯çš„ TypeScript ç¼–è¯‘è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯ &lt;code&gt;jest.tsconfig.json&lt;/code&gt; è¿™ä¸ªæ–‡ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
  &amp;quot;compilerOptions&amp;quot;: {
    &amp;quot;allowSyntheticDefaultImports&amp;quot;: true,
    &amp;quot;module&amp;quot;: &amp;quot;commonjs&amp;quot;,
    &amp;quot;target&amp;quot;: &amp;quot;esnext&amp;quot;,
    &amp;quot;jsx&amp;quot;: &amp;quot;react&amp;quot;,
    &amp;quot;sourceMap&amp;quot;: false,
    &amp;quot;experimentalDecorators&amp;quot;: true,
    &amp;quot;noImplicitUseStrict&amp;quot;: true,
    &amp;quot;removeComments&amp;quot;: true,
    &amp;quot;moduleResolution&amp;quot;: &amp;quot;node&amp;quot;,
    &amp;quot;lib&amp;quot;: [&amp;quot;es2017&amp;quot;, &amp;quot;dom&amp;quot;],
    &amp;quot;typeRoots&amp;quot;: [&amp;quot;node_modules/@types&amp;quot;]
  },
  &amp;quot;exclude&amp;quot;: [&amp;quot;node_modules&amp;quot;, &amp;quot;out&amp;quot;, &amp;quot;.next&amp;quot;]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·çš„é…ç½®ä»ç„¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ï¼šjest ä¸­æ— æ³•æ­£å¸¸è§£ææŸäº› import è¯­å¥ã€‚&lt;code&gt;&amp;quot;allowSyntheticDefaultImports&amp;quot;: true&lt;/code&gt; è¿™ä¸ª TypeScript é…ç½®çš„ç›®çš„æ˜¯å…è®¸ default importã€‚åœ¨æŸäº›åŒ…é‡Œæ˜¯æ²¡æœ‰ default export çš„ï¼Œä¾‹å¦‚ Reactã€‚åœ¨ JavaScript ä¸­æˆ‘ä»¬å¯ä»¥ç”¨ &lt;code&gt;import React from &#39;react&#39;&lt;/code&gt; çš„åŸå› æ˜¯è¿™ä¸ªæ˜¯ç›´æ¥ä» react åŒ…æœ¬ä½“ä¸­å¼•å…¥çš„ï¼Œè€Œ react åŒ…ä¸­æ˜¯æœ‰ &lt;code&gt;module.exports&lt;/code&gt; çš„è¯­å¥çš„ã€‚ä½†æ˜¯åœ¨ TypeScript ä¸­ï¼Œimport å®é™…ä¸Šè§£æåˆ°çš„å¹¶ä¸æ˜¯ react åŒ…æœ¬ä½“ï¼Œè€Œæ˜¯ &lt;code&gt;@types/react&lt;/code&gt; è¿™ä¸ªåŒ…ã€‚è€Œè¿™ä¸ªåŒ…çš„ index.d.ts æ–‡ä»¶é‡Œæ˜¯æ²¡æœ‰ä¸€ä¸ª default export çš„ï¼Œæ‰€ä»¥ TypeScript ä¸­å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ &lt;code&gt;&amp;quot;allowSyntheticDefaultImports&amp;quot;: true&lt;/code&gt; çš„é…ç½®ï¼Œ&lt;code&gt;import React from &#39;react&#39;&lt;/code&gt; æ˜¯ä¼šæŠ¥é”™çš„ã€‚è€Œåœ¨ jest æ‰§è¡Œçš„æ—¶å€™ï¼Œæˆ‘å³ä½¿å¼€å¯äº†é…ç½®ï¼Œè¿˜æ˜¯é‡åˆ°äº†è¿™æ ·çš„æŠ¥é”™ã€‚æ‰€ä»¥æœ€åæˆ‘ä»¬å†³å®šå…¨éƒ¨æ”¹æˆ &lt;code&gt;import * as React from &#39;react&#39;&lt;/code&gt; çš„å†™æ³•äº†ã€‚åŒæ ·æœ‰è¿™ç§æƒ…å†µçš„è¿˜æœ‰ &lt;code&gt;ReactDOM&lt;/code&gt; å’Œ &lt;code&gt;proptypes&lt;/code&gt; è¿™ä¸¤ä¸ªåŒ…ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>TypeScript &#43; å•å…ƒæµ‹è¯•ï¼šä»é›¶å¼€å§‹çš„ç»éªŒä¹‹è°ˆ</title>
      <link>https://elizurhz.cn/frontend/typescript-and-unit-testing-in-action/</link>
      <pubDate>Tue, 26 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/frontend/typescript-and-unit-testing-in-action/</guid>
      <description>

&lt;h2 id=&#34;tl-dr&#34;&gt;TL;DR&lt;/h2&gt;

&lt;p&gt;å…¬å¸å’Œéƒ¨é—¨å†…éƒ¨ä¹‹å‰æœ‰åœ¨æ¨å¹¿ TypeScriptï¼Œä½†æ˜¯ç”±äºç§ç§åŸå› å¾ˆéš¾æŠ•å…¥ä½¿ç”¨ï¼Œä½†è¿™æ¬¡æˆ‘å‚ä¸äº†ä¸€ä¸ªä»é›¶å¼€å§‹çš„é¡¹ç›®ï¼Œæ²¡æœ‰æŠ€æœ¯æ ˆé™åˆ¶ï¼Œé¢†å¯¼ä¹Ÿè¯´å¸Œæœ›ç”¨ TypeScript è¯•ä¸€è¯•ã€‚ä½œä¸ºå¼€å‘å›¢é˜Ÿä¸­å”¯ä¸€è®¤çœŸå­¦è¿‡ TypeScript çš„äººï¼ˆåœ¨éƒ¨é—¨è¿›è¡Œè¿‡å†…éƒ¨åˆ†äº«ï¼Œå†™è¿‡å†…éƒ¨åšå®¢ï¼‰ï¼Œæˆ‘ä»¬çš„ç»éªŒå…¶å®éƒ½æ˜¯å¾ˆç¼ºä¹çš„ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œé™¤äº† TypeScript ä¹‹å¤–ï¼Œå•å…ƒæµ‹è¯•ä¹Ÿæ˜¯æˆ‘ä»¬å›¢é˜Ÿé¦–æ¬¡å°è¯•çš„ã€‚&lt;/p&gt;

&lt;p&gt;åŒæ—¶ï¼Œæˆ‘çš„æ€§æ ¼å’Œå¼€å‘é£æ ¼ä¹Ÿæ¯”è¾ƒåå‘â€œæ¢ç´¢è€…â€ï¼Œæ‰€ä»¥é¢†å¯¼ä¹Ÿå¸ƒç½®ç»™æˆ‘ä¸€äº›é¢„ç ”ã€æ–°å°è¯•ï¼Œæ‰€ä»¥è‡ªç„¶è€Œç„¶ä¾¿æˆäº†ä¸€ä¸ª leader çš„è§’è‰²ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é¡¹ç›®æ„æ¶&#34;&gt;é¡¹ç›®æ„æ¶&lt;/h2&gt;

&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ create-react-app æ­å»ºé¡¹ç›®ï¼Œæ²¡æœ‰ &lt;code&gt;eject&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è€Œå¯¹äºæ–‡ä»¶çš„ç»„ç»‡ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†æŒ‰æ¨¡å—åˆ’åˆ†çš„æ–¹å¼ï¼Œå³å„ä¸ªæ¨¡å—é›†æˆè‡ªå·±çš„ store, reducers, actions, å±•ç¤ºç»„ä»¶, å®¹å™¨ç»„ä»¶ç­‰ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªå…¥å£æ–‡ä»¶å°†å®ƒä»¬éƒ½æš´éœ²ç»™å¤–éƒ¨ï¼Œå¤–éƒ¨éœ€è¦å¼•ç”¨çš„æ—¶å€™ç›´æ¥å¼•ç”¨è¿™ä¸ªæ–‡ä»¶å³å¯ã€‚&lt;/p&gt;

&lt;p&gt;ä¸»ç›®å½•ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;â”œâ”€â”€ docs // æ–‡æ¡£
â”œâ”€â”€ e2e // E2E æµ‹è¯•
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ App.tsx // ä¸»é¡µé¢
â”‚   â”œâ”€â”€ index.tsx // ä¸»å…¥å£
â”‚   â”œâ”€â”€ common.d.ts // å…¨å±€é€šç”¨ç±»å‹
â”‚   â”œâ”€â”€ components // é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ i18n // å›½é™…åŒ–
â”‚   â”œâ”€â”€ @types // å¦‚æœæŸä¸ªä¾èµ–åŒ…æ²¡æœ‰ TypeScript æ”¯æŒï¼Œåˆ™åœ¨è¿™é‡Œç¼–å†™ d.ts æ–‡ä»¶
â”‚   â”œâ”€â”€ modules // ä¸šåŠ¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ moduleA
â”‚   â”‚   â”œâ”€â”€ moduleB
â”‚   â”‚   ...
â”‚   â”œâ”€â”€ styles // å…¨å±€ scss æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ services // ä¸æœåŠ¡ç«¯è¯·æ±‚ç›¸å…³çš„å°è£…
â”‚   â”œâ”€â”€ constants // é€šç”¨å¸¸é‡
â”‚   â””â”€â”€ utils // é€šç”¨å·¥å…·å‡½æ•°
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ¨¡å—å†…éƒ¨ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;â”œâ”€â”€ index.ts // ä¸»å…¥å£ï¼Œç”¨äºå¯¼å‡ºå¤–éƒ¨å¯èƒ½å¼•ç”¨åˆ°çš„æ‰€æœ‰è¯¥æ¨¡å—çš„å†…å®¹
â”œâ”€â”€ [MODULE_NAME].d.ts // è¯¥ç»„ä»¶ä¸‹çš„é€šç”¨ç±»å‹
â”œâ”€â”€ actions // è¯¥æ¨¡å—çš„ redux action
â”œâ”€â”€ common // è¯¥æ¨¡å—å†…çš„é€šç”¨ç»„ä»¶ï¼ˆä¸€èˆ¬æ˜¯ä¸æ¨¡å—ä¸šåŠ¡æ¯”è¾ƒç›¸å…³çš„ï¼‰
â”‚   â”œâ”€â”€ commonComponentA // ç»„ä»¶æ–‡ä»¶å¤¹ï¼ŒåŒ…å«ç»„ä»¶ã€æ ·å¼ã€å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ index.test.tsx
â”‚   â”‚   â””â”€â”€ index.module.scss
â”‚   â”œâ”€â”€ componentB
â”‚   ...
â”œâ”€â”€ components // æ¨¡å—å†…çš„å±•ç¤ºç»„ä»¶
â”‚   â”œâ”€â”€ componentA
â”‚   â”‚   â”œâ”€â”€ __test__ // å•å…ƒæµ‹è¯•
â”‚   â”‚   â”‚   â”œâ”€â”€ __snapshots__ // å¿«ç…§æµ‹è¯•ï¼Œå¦‚æœæœ‰å¿«ç…§æµ‹è¯•ï¼ŒJest ä¼šè‡ªåŠ¨åˆ›å»ºå®ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ index.test.js
â”‚   â”‚   â”‚   â””â”€â”€ someComponent.test.js
â”‚   â”‚   â”œâ”€â”€ index.ts // ä¸»å…¥å£ï¼Œç”¨äºå¯¼å‡ºå¤–éƒ¨å¯èƒ½å¼•ç”¨åˆ°çš„æ‰€æœ‰ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ componentA.tsx // å±•ç¤ºç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ componentAContainer.tsx // å®¹å™¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ someComponent.tsx // å…¶ä»–ç»„ä»¶
â”‚   â”‚   â””â”€â”€ index.module.scss
â”‚   ...
â”œâ”€â”€ reducers // è¯¥æ¨¡å—å†…çš„ reducer
â”‚   â”œâ”€â”€ index.ts // ä¸»å…¥å£
â”‚   â”œâ”€â”€ featureA.ts // å„å­åŠŸèƒ½çš„ reducers
â”‚   ...
â”œâ”€â”€ sagas // redux-saga
â”‚   â”œâ”€â”€ index.ts // ä¸»å…¥å£
â”‚   ...
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;typescript&#34;&gt;TypeScript&lt;/h2&gt;

&lt;p&gt;åœ¨ä½¿ç”¨ TypeScript æ—¶ï¼Œé‡åˆ°çš„é—®é¢˜ä¹Ÿæ˜¯å”¯ä¸€å¯èƒ½çš„é—®é¢˜å°±æ˜¯ç±»å‹ä¸åŒ¹é…ã€‚åˆšå¼€å§‹çš„æ—¶å€™ï¼Œå¤§å®¶å¯¹ React çš„å„ç§ç±»å‹éƒ½éå¸¸ä¸ç†Ÿæ‚‰ï¼Œæ‰€ä»¥ä¸çŸ¥é“è®¾å®šæˆä»€ä¹ˆå¥½ã€‚äº‹å®ä¸Šè¿™åº”è¯¥ä¹Ÿæ˜¯æ‰€æœ‰çš„å¼€å‘è€…å…¥é—¨é‡åˆ°çš„æœ€å¤§é—®é¢˜ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ï¼Œä¸€æ˜¯å»ç¨å¾®è¯»ä¸€ä¸‹ react çš„ &lt;code&gt;index.d.ts&lt;/code&gt;ï¼ŒçŸ¥é“å®ƒå¤§æ¦‚æœ‰ä»€ä¹ˆç±»å‹ï¼›äºŒæ˜¯å‚è€ƒä¸€ä¸‹æˆç†Ÿçš„ TypeScript é¡¹ç›®ã€‚Ant Design å¯èƒ½æ˜¯æœ€åˆé€‚çš„é¡¹ç›®å‚è€ƒäº†ã€‚æ€ä¹ˆå†™ç±»å‹ï¼ŒReact é‡Œæœ‰ä»€ä¹ˆå¸¸ç”¨çš„ç±»å‹ï¼Œä»¥åŠæ€ä¹ˆå»ç»§æ‰¿å¤ç”¨ç±»å‹ï¼Œè¿™äº›é—®é¢˜éƒ½å¯ä»¥åœ¨ Ant Design ä¸Šæ‰¾åˆ°ç­”æ¡ˆã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œæ€»ç»“ä¸€äº›å¸¸ç”¨çš„ React ç±»å‹ï¼ˆç‰¹æ®Šæœªæ³¨æ˜çš„éƒ½éœ€è¦ importï¼‰ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ children æ—¶ç”¨ &lt;code&gt;React.ReactNode&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;inline CSS ä½¿ç”¨ &lt;code&gt;React.CSSProperties&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;input çš„ç›¸å…³äº‹ä»¶ä½¿ç”¨ &lt;code&gt;React.ChangeEvent&lt;/code&gt; (æ³›å‹ä¸º &lt;code&gt;ChangeEvent&amp;lt;HTMLInputElement&amp;gt;&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;é¼ æ ‡ç›¸å…³çš„äº‹ä»¶ä½¿ç”¨ &lt;code&gt;React.MouseEvent&lt;/code&gt; (æ³›å‹ä¸º &lt;code&gt;MouseEvent&amp;lt;HTMLButtonElement&amp;gt;&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;render()&lt;/code&gt; å‡½æ•°çš„è¿”å›å€¼ç±»å‹æ˜¯ &lt;code&gt;JSX.Element&lt;/code&gt;ï¼Œä¸éœ€è¦ importã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦å¤– &lt;code&gt;react-router&lt;/code&gt; å’Œ &lt;code&gt;react-intl&lt;/code&gt; åˆ†åˆ«æœ‰å„è‡ªçš„ç±»å‹ &lt;code&gt;RouteComponentProps&lt;/code&gt; å’Œ &lt;code&gt;InjectedIntlProps&lt;/code&gt;ï¼Œéœ€è¦ importã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;ä½¿ç”¨ TypeScript å¯¹äºåˆšå…¥é—¨çš„æ–°æ‰‹æ¥è¯´ç»å¯¹æ˜¯å¾ˆæµªè´¹æ—¶é—´çš„ï¼Œå› ä¸ºä½ å†™åŒæ ·ä¸€ä¸ªç»„ä»¶ï¼Œç›¸æ¯” JavaScript æ¥è¯´å¯èƒ½ä¼šèŠ±ä¸Šä¸¤å€çš„æ—¶é—´ã€‚ä½†æ˜¯æˆ‘ä»¬å›¢é˜Ÿå·®ä¸å¤šåœ¨å¼€å‘çš„ç¬¬äºŒå‘¨å¼€å§‹å°±èƒ½ç†Ÿç»ƒå¼€å‘äº†ï¼Œæ‰€ä»¥ TypeScript éœ€è¦çš„ä»…ä»…æ˜¯ä¸€äº›å‰æœŸçš„å­¦ä¹ æˆæœ¬ï¼Œåˆ°åé¢å®ƒå¹¶ä¸ä¼šæˆä¸ºé£é™©æˆ–è€…è´Ÿæ‹…ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯èŠ±è¿™äº›æ—¶é—´å»å­¦ä¹  TypeScriptï¼Œå¸¦æ¥çš„å¥½å¤„æ˜¯ä¸è¨€è€Œå–»çš„ã€‚é¦–å…ˆæˆ‘ä»¬å¼€å‘ä¸‹æ¥çš„ä½“éªŒå°±æ˜¯ï¼šæå°‘ Bugã€‚Bug å¤§éƒ¨åˆ†éƒ½æ˜¯åœ¨å¼€å‘æ—¶è¢«è§£å†³çš„ï¼Œå› ä¸ºæœ‰äº† TypeScript çš„çº¦æŸï¼Œæˆ‘ä»¬ä¸€æ—¦å‡ºç°ç±»å‹é”™è¯¯ç­‰ç­‰ï¼Œåœ¨å¼€å‘æ—¶å°±å¯ä»¥è¢«åŠæ—¶å‘ç°å¹¶ä¿®å¤ï¼Œæ‰€ä»¥éƒ¨ç½²ä¸Šå»ä¹‹åèƒ½å‘ç°çš„ Bug å°±å°‘äº†å¾ˆå¤šäº†ã€‚å½“ç„¶å¯¹äºå‡å°‘ Bug è´¡çŒ®æ›´å¤šçš„å…¶å®æ˜¯å•å…ƒæµ‹è¯•ï¼Œè¿™ä¸ªåé¢ä¼šè¯´ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å•å…ƒæµ‹è¯•&#34;&gt;å•å…ƒæµ‹è¯•&lt;/h2&gt;

&lt;p&gt;å•å…ƒæµ‹è¯•æ¡†æ¶æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ jest + enzymeã€‚React çš„å•å…ƒæµ‹è¯•ç›¸å…³çš„æ–‡ç« å¾ˆå¤šï¼Œä½†æ˜¯éƒ½æ˜¯å…³äºâ€œæ¡†æ¶æ€ä¹ˆç”¨â€ï¼Œå¾ˆå°‘æœ‰äººæ€»ç»“â€œä¸€ä¸ªé¡¹ç›®é‡Œåˆ°åº•è¯¥æ€ä¹ˆç»„ç»‡æµ‹è¯•â€ã€‚æœ€è¿‘çœ‹åˆ°äº†ä¸€ç¯‡ &lt;a href=&#34;https://juejin.im/post/5bd640abf265da0ad63c125e&#34;&gt;React å•å…ƒæµ‹è¯•ç­–ç•¥åŠè½åœ° #ä¸€ç¯‡å°±å¤Ÿç³»åˆ—&lt;/a&gt; å†™å¾—éå¸¸å¥½ï¼Œæˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ä¹ŸåŸºæœ¬æ˜¯æŒ‰ç…§è¿™ä¸ªæ¥ç»„ç»‡çš„ã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒä¸Šé¢çš„æ–‡ç« ï¼Œæˆ‘ä»¬çš„å•å…ƒæµ‹è¯•çš„ç»„ç»‡æ–¹å¼æ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;connect ç»„ä»¶ä¸æµ‹&lt;/li&gt;
&lt;li&gt;å±•ç¤ºç»„ä»¶éœ€è¦æµ‹è¯•

&lt;ul&gt;
&lt;li&gt;UI ç”¨å¿«ç…§æµ‹è¯•(Jest)&lt;/li&gt;
&lt;li&gt;åˆ†æ”¯æ¸²æŸ“å¿…æµ‹&lt;/li&gt;
&lt;li&gt;äº‹ä»¶å¿…æµ‹&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;å·¥å…·å‡½æ•°éœ€è¦æµ‹è¯•&lt;/li&gt;
&lt;li&gt;reducers éœ€è¦æµ‹è¯•&lt;/li&gt;
&lt;li&gt;sagas éœ€è¦æµ‹è¯•&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•å…¨éƒ¨ç”¨ JavaScript ç¼–å†™ï¼Œè¿™ç‚¹ä¹Ÿå‚è€ƒäº† Ant Designã€‚æˆ‘è®¤ä¸ºå•å…ƒæµ‹è¯•æ²¡å¿…è¦å»çœŸæ­£å®Œæ•´åœ°æŠŠé‚£äº› props mock å‡ºæ¥ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨éªŒè¯ä»£ç é€»è¾‘çš„æ­£ç¡®æ€§ï¼Œåº”è¯¥æ›´å¤šå…³æ³¨ä¸ä»£ç æœ¬èº«ï¼Œè€Œä¸æ˜¯ç±»å‹æœ‰æ²¡æœ‰æ­£ç¡®ã€‚å¦‚æœåœ¨ä½¿ç”¨æ—¶ä¼ å…¥äº†é”™è¯¯çš„ç±»å‹ï¼Œé‚£ä¹ˆç¼–è¯‘æ˜¯ä¸ä¼šé€šè¿‡çš„ï¼Œè¿™æ˜¯ TypeScript çš„ç¼–è¯‘å™¨å¸®æˆ‘ä»¬åšçš„ï¼Œå†å†™å…³äºç±»å‹é”™è¯¯çš„æµ‹è¯•ç”¨ä¾‹å…¶å®æ˜¯ç”»è›‡æ·»è¶³ã€‚å¦å¤–ï¼Œåœ¨é¡¹ç›®å˜å¾—å¤æ‚ä¹‹åï¼Œå¾€å¾€ä¼šå‡ºç°ä¸€äº›å¾ˆéš¾ mock çš„ç±»å‹ï¼Œå¼ºè¡Œå» mock å®ƒä»¬åªä¼šæµªè´¹æˆ‘ä»¬å†™æµ‹è¯•çš„æ—¶é—´ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ç»„ä»¶&#34;&gt;ç»„ä»¶&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬çš„ç»„ä»¶åˆ†ä¸ºä¸šåŠ¡ç»„ä»¶å’Œé€šç”¨ç»„ä»¶ã€‚é€šç”¨ç»„ä»¶çš„æµ‹è¯•å°±æ¯”è¾ƒç®€å•äº†ï¼Œé’ˆå¯¹å„ä¸ª props è¿›è¡Œæµ‹è¯•å³å¯ï¼Œç›®çš„å°±æ˜¯è¦†ç›–æ‰€æœ‰çš„åˆ†æ”¯é€»è¾‘å’Œäº‹ä»¶ï¼ŒåŒæ—¶ç”¨å¿«ç…§æµ‹è¯•æµ‹ UIã€‚è€Œä¸šåŠ¡ç»„ä»¶ç»å¸¸æ¶‰åŠåˆ°ä¸€äº›å¾ˆå¤æ‚çš„ propsï¼Œæ›´æœ‰å¯èƒ½å‡ºç°å„ç§é«˜é˜¶ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å›¢é˜Ÿçº¦å®šï¼Œåœ¨ä¸šåŠ¡ç»„ä»¶ä¸­ä¸è¿›è¡Œä»»ä½•çš„é«˜é˜¶ç»„ä»¶è£…é¥°ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æµ‹è¯•ç»„ä»¶çš„æ—¶å€™ï¼Œå¿…ç„¶ä¼šä½¿ç”¨åˆ° enzymeã€‚åœ¨ enzyme çš„ä½¿ç”¨ä¸Šï¼Œæˆ‘ä»¬ç¡®å®ç¢°åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œæœ€å¤§çš„é—®é¢˜è¿˜æ˜¯åœ¨æ²¡ç»éªŒçš„æ—¶å€™å¾ˆéš¾æŠŠç›®çš„è½¬åŒ–æˆä»£ç ã€‚ä¾‹å¦‚æˆ‘éœ€è¦æ‰¾ä¸€ä¸ªâ€œprops ä¸­æœ‰ &lt;code&gt;type=&amp;quot;primary&amp;quot;&lt;/code&gt; çš„ Button ç»„ä»¶â€ï¼Œæˆ–è€…â€œè§¦å‘ Button å­ç»„ä»¶çš„ onClick æ–¹æ³•â€ã€‚å½“ç„¶è¿™ä¹Ÿå’Œå®˜æ–¹æ–‡æ¡£å†™çš„ä¸å¤Ÿï¼ˆæœ‰çš„å¯èƒ½æ‰¾ä¸åˆ°ï¼‰æœ‰å…³ï¼Œå¹¶ä¸”å¾ˆå¤šæ–‡ç« ä¹Ÿä¸ä¼šæ¶‰åŠåˆ°è¿™ç§æ·±å…¥çš„å†…å®¹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;reducers&#34;&gt;reducers&lt;/h3&gt;

&lt;p&gt;reducers æµ‹è¯•æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆéœ€è¦æ¨¡æ‹Ÿå‡ºæˆ‘ä»¬éœ€è¦çš„ storeï¼Œç„¶åè§¦å‘ä¸åŒçš„ actions å»è°ƒç”¨ reducers çš„ä¸åŒå¤„ç†é€»è¾‘ã€‚å…·ä½“æµ‹è¯•æ–¹æ³•å®˜æ–¹æ–‡æ¡£éƒ½æœ‰è¯´æ˜ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p&gt;

&lt;h3 id=&#34;sagas&#34;&gt;sagas&lt;/h3&gt;

&lt;p&gt;sagas çš„æµ‹è¯•åœ¨å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰ä¸“é—¨é¡µé¢è¯´æ˜ã€‚é¦–å…ˆ saga ä¸€å®šæ˜¯å¼‚æ­¥çš„ï¼Œè€Œæˆ‘ä»¬å•å…ƒæµ‹è¯•å¹¶ä¸å…³æ³¨å¼‚æ­¥çš„ç»“æœï¼Œåªéœ€è¦æµ‹è¯•ç›¸åº”çš„ saga æ˜¯å¦è¢«æ­£ç¡®è°ƒç”¨ã€‚redux-saga ä¸­æœ‰ &lt;code&gt;runSaga()&lt;/code&gt; çš„ API å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆå•å…ƒæµ‹è¯•ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æµ‹è¯•è§„èŒƒ&#34;&gt;æµ‹è¯•è§„èŒƒ&lt;/h3&gt;

&lt;p&gt;åœ¨é¡¹ç›®ä¸­ï¼Œå•å…ƒæµ‹è¯•çš„è§„èŒƒåŒ–ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿è¯ç”¨ä¾‹èƒ½å®ç°ä½ çš„æµ‹è¯•ç›®çš„ï¼Œå…¶æ¬¡è¿˜éœ€è¦æœ‰å¯è¯»æ€§ã€‚æ‰€ä»¥æˆ‘å¯¹äºå•å…ƒæµ‹è¯•è´¨é‡çš„ç†è§£å¤§æ¦‚å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æµ‹è¯•æè¿°éœ€å†™ç²¾ç¡®ï¼Œä»¥ä¾¿ä»–äººé˜…è¯»ï¼Œä¹Ÿæ–¹ä¾¿è¯´æ˜è¯¥ç»„ã€æŸä¸ªæµ‹è¯•åœ¨æµ‹ä»€ä¹ˆ

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;describe&lt;/code&gt; çš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºè¿™ä¸€ç»„æµ‹è¯•åœ¨åšä»€ä¹ˆ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;it&lt;/code&gt; çš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºè¿™ä¸ªæµ‹è¯•åœ¨åšä»€ä¹ˆ&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;æµ‹è¯•çš„ expect éœ€è¦ç¬¦åˆæµ‹è¯•ç›®çš„(å³ &lt;code&gt;it&lt;/code&gt; çš„æè¿°)

&lt;ul&gt;
&lt;li&gt;ä¾‹å¦‚ç»™æŸä¸ª input èµ‹åˆå§‹ valueï¼Œæƒ³åˆ¤æ–­å®ƒæ˜¯å¦æ˜¾ç¤ºæ­£ç¡®çš„ valueï¼Œæ­¤æ—¶ä¸èƒ½ç®€å•åˆ¤æ–­æŸä¸ª DOM å­˜åœ¨&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœéœ€è¦æµ‹è¯•æ˜¯å¦æ¸²æŸ“æˆåŠŸï¼Œè¯·ä½¿ç”¨ Jest çš„å¿«ç…§æµ‹è¯•ï¼Œä¸è¦å»åˆ¤æ–­æŸä¸ª DOM æˆ–è€…æŸä¸ªå­ç»„ä»¶æ˜¯å¦å­˜åœ¨

&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬æ— æ³•ä»æŸä¸ª DOM èŠ‚ç‚¹å­˜åœ¨æ¨å¯¼å‡ºç»„ä»¶æ˜¯æ­£å¸¸æ¸²æŸ“çš„&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;å•å…ƒæµ‹è¯•å…¶å®ä¹Ÿæ˜¯å¾ˆè€—æ—¶é—´çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸ç†Ÿç»ƒçš„æ—¶å€™ï¼Œå¯èƒ½åœ¨å†™æµ‹è¯•æ—¶èŠ±çš„æ—¶é—´æ¯”å¼€å‘èŠ±çš„æ—¶é—´è¿˜å¤šã€‚ä½†æ˜¯å•å…ƒæµ‹è¯•èƒ½å¤Ÿç›´æ¥å¸¦æ¥çš„å¥½å¤„å°±æ˜¯æå¤§å‡å°‘äº† Bug æ•°é‡ã€‚QA å¾€å¾€æ˜¯ä»¥ä¸šåŠ¡åœºæ™¯æ¥è¿›è¡Œé»‘ç›’æµ‹è¯•ï¼Œä»–ä»¬ä¸äº†è§£æˆ‘ä»¬ä»£ç çš„å†™æ³•ï¼Œå¾ˆå¤šæƒ…å†µå°±æ˜¯ QA æµ‹è¯•èƒ½é€šï¼Œä½†æ˜¯å®é™…ä¸Šè•´è—äº†å¾ˆå¤šèƒ½äº§ç”Ÿ bug çš„åœ°æ–¹ã€‚åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å’Œ QA ä¸€æ ·å»æ„æ€ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œç¼–å†™ä¸åŒçš„æµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿä¼šå‘ç°ä»£ç å¯èƒ½å¯¹äºæŸäº›åœºæ™¯ã€é€»è¾‘çš„å¤„ç†æœ‰ç¼ºå¤±ï¼Œå¯ä»¥ä¾æ­¤å¯¹ä»£ç è¿›è¡Œä¿®æ­£å’Œè¡¥å……ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;TypeScript å’Œå•å…ƒæµ‹è¯•åˆšå…¥é—¨çš„æ—¶å€™ä¼šè§‰å¾—è¿™äº›ä¸œè¥¿æ²¡ç”¨è€Œä¸”æµªè´¹æ—¶é—´ï¼Œä½†æ˜¯çœŸæ­£ä¼šç”¨å®ƒä»¬äº†ä¹‹åå…¶å®æ˜¯â€œçœŸé¦™â€ï¼Œå¾ˆæ¨èå¼€å‘è€…ä»¬éƒ½æŠ•å…¥è¿™ä¸ªæ—¶é—´æˆæœ¬ï¼Œå› ä¸ºå®ƒä»¬åæœŸå¸¦æ¥çš„å›æŠ¥æ˜¯å®Œå…¨å¯ä»¥å¼¥è¡¥è¿™ä¸ªæˆæœ¬ï¼Œç”šè‡³è¿˜æœ‰èµšçš„ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Canvas æ‰‹å†™æ¿çš„å®ç°ä¸ä¼˜åŒ–</title>
      <link>https://elizurhz.cn/frontend/canvas-writing-pad/</link>
      <pubDate>Sun, 24 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/frontend/canvas-writing-pad/</guid>
      <description>

&lt;p&gt;æœ€è¿‘åœ¨å…¬å¸æ¥äº†å‡ ä¸ªé¡¹ç›®ï¼Œéƒ½å’Œ Canvas æ‰‹ç»˜æ‰‹å†™æœ‰å…³çš„ï¼Œæœ‰å†å²é—ç•™é¡¹ç›®ï¼Œè¿˜æœ‰è¦ä»å¤´å†™çš„æ–°éœ€æ±‚ã€‚ä¹‹å‰å¯¹ Canvas çš„è®¤çŸ¥æ¯”è¾ƒå°‘ï¼Œåªå†™è¿‡ä¸€ä¸ªå¸¦åŠ¨ç”»çš„åœ†ç¯ç™¾åˆ†æ¯”å°ç»„ä»¶ï¼ˆ&lt;a href=&#34;https://github.com/ElizurHz/vue-percentage&#34;&gt;GitHub - ElizurHz/vue-percentage: åœ†ç¯ç™¾åˆ†æ¯”å°ç»„ä»¶&lt;/a&gt;ï¼‰ï¼Œæ˜¯å®šå¥½æ•°æ®åå†æŠŠå®ƒç”»åˆ° Canvas ä¸Šï¼Œè€Œæ‰‹å†™æ¿æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ã€‚&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡æ‰€æ¶‰åŠçš„ä»£ç æ˜¯åŸºäº &lt;a href=&#34;https://github.com/szimek/signature_pad&#34;&gt;szimek/signature_pad&lt;/a&gt; è¿™ä¸ªå¼€æºç»„ä»¶è¿›è¡Œæ”¹é€ çš„ï¼Œæ‰€ä»¥ä¸‹é¢ä¼šå¯¹æºç è¿›è¡Œä¸€äº›è§£æï¼Œä¹Ÿä¼šè®²è§£ä¸€äº›æˆ‘è‡ªå·±å¯¹å…¶è¿›è¡Œæ”¹é€ çš„ç»éªŒã€‚&lt;/p&gt;

&lt;h2 id=&#34;canvas-ç›¸å…³åŸºç¡€çŸ¥è¯†&#34;&gt;Canvas ç›¸å…³åŸºç¡€çŸ¥è¯†&lt;/h2&gt;

&lt;p&gt;æœ¬æ–‡åˆ—ä¸¾ä¸€äº›æœ¬æ–‡æ¶‰åŠåˆ°çš„å¿…å¤‡çŸ¥è¯†å’Œå¸¸ç”¨çš„ APIï¼ŒAPI å…·ä½“å†…å®¹ä¸è¿‡å¤šèµ˜è¿°ï¼Œè¯¦æƒ…å¯ä»¥åœ¨ &lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API&#34;&gt;Canvas - Web API æ¥å£å‚è€ƒ | MDN&lt;/a&gt; æŸ¥çœ‹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åŸºæœ¬ç”¨æ³•&#34;&gt;åŸºæœ¬ç”¨æ³•&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;&amp;lt;canvas&amp;gt;&lt;/code&gt; æ˜¯ HTML5 ä¸­çš„ä¸€ä¸ªæ ‡ç­¾ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥å¦‚ä¸‹æ–¹å¼ä¹¦å†™ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;canvas id=&amp;quot;test&amp;quot; width=&amp;quot;150&amp;quot; height=&amp;quot;150&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å…¶ä¸­ width å’Œ height æ˜¯ canvas çš„å¿…éœ€å±æ€§ï¼Œå¦åˆ™æ— æ³•çœ‹åˆ°ç»˜åˆ¶çš„å†…å®¹ã€‚åœ¨åˆå§‹åŒ–æ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ &lt;code&gt;document.getElementById&lt;/code&gt; çš„æ–¹å¼è·å– DOM èŠ‚ç‚¹ï¼Œå¹¶è®¾ç½®å…¶ width å’Œ height å±æ€§ã€‚&lt;strong&gt;ã€æ³¨æ„ï¼šåœ¨å·²ç»ç»˜åˆ¶è¿‡çš„ canvas ä¸Šé‡è®¾è¿™ä¸¤ä¸ªå±æ€§ä¼šå¯¼è‡´å·²ç»˜åˆ¶å†…å®¹è¢«æ¸…ç©ºã€‘&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¦‚éœ€åœ¨ canvas ä¸Šç»˜åˆ¶ï¼Œæˆ‘ä»¬éœ€è¦è·å–å®ƒçš„â€œæ¸²æŸ“ä¸Šä¸‹æ–‡ (The rendering context)â€&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;const test = document.getElementById(&#39;test&#39;)
const ctx = test.getContext(&#39;2d&#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ç»˜åˆ¶&#34;&gt;ç»˜åˆ¶&lt;/h3&gt;

&lt;p&gt;åœ¨ Canvas ä¸­æˆ‘ä»¬å®šä½ä½¿ç”¨çš„æ˜¯åæ ‡ç³»ï¼Œ(0, 0) ä»£è¡¨çš„æ˜¯æœ€å·¦ä¸Šçš„ç‚¹ï¼Œå¯è§†åŒºåŸŸæœ€å³ä¸‹çš„ç‚¹ä¸º (width, height)ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;context.clearRect(x, y, width, height): ä»¥ (x, y) ä¸ºåŸºå‡†ï¼ˆå·¦ä¸Šè§’çš„ç‚¹ï¼‰ï¼Œæ¸…ç©ºé•¿ä¸º widthã€å®½ä¸º height çš„çŸ©å½¢ä¸­æ‰€ç»˜åˆ¶çš„æ‰€æœ‰å†…å®¹&lt;/li&gt;
&lt;li&gt;context.eginPath(): æ–°å»ºè·¯å¾„&lt;/li&gt;
&lt;li&gt;context.closePath(): é—­åˆè·¯å¾„&lt;/li&gt;
&lt;li&gt;context.stroke(): ç»˜åˆ¶è½®å»“&lt;/li&gt;
&lt;li&gt;context.moveTo(x, y): ç§»åŠ¨è‡³ç‚¹ (x, y)&lt;/li&gt;
&lt;li&gt;context.lineTo(x, y): ç»˜åˆ¶ä¸€æ¡ä»å½“å‰ç‚¹åˆ° (x, y) çš„ç›´çº¿&lt;/li&gt;
&lt;li&gt;context.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y): ä¸‰æ¬¡è´å¡å°”æ›²çº¿&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸å›¾ç‰‡ç›¸å…³çš„ API&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;canvas.toBlob(): å½“å‰ canvas è½¬åŒ–ä¸º blob å¯¹è±¡ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°å°±æ˜¯ blob å¯¹è±¡ã€‚&lt;strong&gt;å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;canvas.toDataURL(): è½¬åŒ–ä¸º base64 ç¼–ç çš„ urlã€‚å‚æ•°ä¸ºå›¾ç‰‡æ ¼å¼ï¼Œå¦‚ &lt;code&gt;&#39;image/png&#39;&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;context.drawImage(): æŠŠå›¾ç‰‡ç»˜åˆ¶åˆ° canvas ä¸Šã€‚å®ƒæœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼Œæ ¹æ®ä¼ å‚æ•°é‡çš„ä¸åŒä¼šæœ‰ä¸åŒçš„ç»“æœã€‚è¯¦æƒ…è§ &lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage&#34;&gt;CanvasRenderingContext2D.drawImage() - Web API æ¥å£å‚è€ƒ | MDN&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;è´å¡å°”æ›²çº¿&#34;&gt;è´å¡å°”æ›²çº¿&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E8%B2%9D%E8%8C%B2%E6%9B%B2%E7%B7%9A&#34;&gt;è´å¡å°”æ›²çº¿ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/canvas-writing-pad/Bezier_3_big.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è¿™é‡Œä¸»è¦è®²ä¸€ä¸‹æœ¬æ–‡æ¶‰åŠåˆ°çš„ä¸‰æ¬¡è´å¡å°”æ›²çº¿ã€‚å®ƒæœ‰èµ·ç‚¹ã€æ§åˆ¶ç‚¹ 1ã€æ§åˆ¶ç‚¹ 2ã€ç»ˆç‚¹å››ä¸ªå…³é”®çš„ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‰æ¬¡è´å¡å°”æ›²çº¿çš„å…¬å¼å¦‚ä¸‹ï¼ˆLeaveIt ä¸»é¢˜çš„ Dark Mode ä¸‹ä¼šçœ‹ä¸æ¸…ï¼Œè¯·åˆ‡æ¢åˆ° Light Modeï¼‰ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/canvas-writing-pad/bezier_3_formulation.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å…¶ä¸­ t ä¸ºå‚æ•°ã€‚ä½¿ t é€æ¸ä» 0 å¢å¤§åˆ° 1ï¼Œå³å¯é€šè¿‡è¿™ä¸ªæ–¹ç¨‹å¼ç”»å‡ºè´å¡å°”æ›²çº¿ã€‚&lt;/p&gt;

&lt;h3 id=&#34;äº‹ä»¶&#34;&gt;äº‹ä»¶&lt;/h3&gt;

&lt;p&gt;å®ç°æ‰‹å†™æ¿ï¼Œæˆ‘ä»¬éœ€è¦ç›‘å¬ Canvas ä¸Šçš„äº‹ä»¶ã€‚ç”±äºæˆ‘ä»¬å¯èƒ½æ˜¯ç”¨é¼ æ ‡å»ç»˜ç”»ï¼Œä¹Ÿå¯èƒ½æ˜¯åœ¨è§¦å±ä¸Šç»˜ç”»ï¼Œæ‰€ä»¥æˆ‘ä»¬é™¤äº†ç›‘å¬é¼ æ ‡äº‹ä»¶ä¹‹å¤–ï¼Œè¿˜éœ€è¦ç›‘å¬è§¦æ‘¸äº‹ä»¶ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;mousedown/touchstart: é¼ æ ‡ç‚¹å‡»/å¼€å§‹è§¦æ‘¸&lt;/li&gt;
&lt;li&gt;mousemove/touchmove: é¼ æ ‡/è§¦æ‘¸ç§»åŠ¨ä¸­&lt;/li&gt;
&lt;li&gt;mouseup/touchend: é¼ æ ‡æŒ‰é”®æŠ¬èµ·/è§¦æ‘¸ç»“æŸ(ç¦»å¼€å±å¹•)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç”¨è¿™äº› API èƒ½æ»¡è¶³å¤§å¤šæ•°æƒ…å†µä¸‹çš„éœ€æ±‚ï¼Œä½†æ˜¯ç°åœ¨å‡ºç°äº†å¦‚ Surface Pen, Apple Pen è¿™ç±»çš„æ‰‹å†™ç¬”ï¼ŒW3C ä¹Ÿæœ‰ç›¸åº”çš„æ–°æ ‡å‡†ï¼šPointerEvent (&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Web/API/PointerEvent&#34;&gt;PointerEvent - Web API æ¥å£ | MDN&lt;/a&gt;)ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;PointerEvent æ¥å£ä»£è¡¨äº†ç”± æŒ‡é’ˆ å¼•å‘çš„ DOM äº‹ä»¶çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬æ¥è§¦ç‚¹çš„ä½ç½®ï¼Œå¼•å‘äº‹ä»¶çš„è®¾å¤‡ç±»å‹ï¼Œæ¥è§¦è¡¨é¢å—åˆ°çš„å‹åŠ›ç­‰ã€‚
æŒ‡é’ˆ æ˜¯è¾“å…¥è®¾å¤‡çš„ç¡¬ä»¶å±‚æŠ½è±¡ï¼ˆæ¯”å¦‚é¼ æ ‡ï¼Œè§¦æ‘¸ç¬”ï¼Œæˆ–è§¦æ‘¸å±ä¸Šçš„ä¸€ä¸ªè§¦æ‘¸ç‚¹ï¼‰ã€‚æŒ‡é’ˆ èƒ½æŒ‡å‘ä¸€ä¸ªå…·ä½“è¡¨é¢ï¼ˆå¦‚å±å¹•ï¼‰ä¸Šçš„ä¸€ä¸ªï¼ˆæˆ–ä¸€ç»„ï¼‰åæ ‡ã€‚
æŒ‡é’ˆçš„ å‡»ä¸­æ£€æµ‹ æŒ‡æµè§ˆå™¨ç”¨æ¥æ£€æµ‹ æŒ‡é’ˆäº‹ä»¶çš„ç›®æ ‡å…ƒç´ çš„è¿‡ç¨‹ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¸ªç›®æ ‡å…ƒç´ æ˜¯ç”± æŒ‡é’ˆçš„ä½ç½®å’Œå…ƒç´ åœ¨æ–‡ç« ä¸­çš„ä½ç½®å’Œåˆ†å±‚å…±åŒå†³å®šçš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;PointerEvent çš„ä½¿ç”¨æ–¹æ³•å’Œ MouseEventã€TouchEvent å¾ˆç±»ä¼¼ï¼Œä½†æœ‰æ–°å¢ä¸€äº›æœ‰ç”¨çš„ Properties:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;PointerEvent.pointerType: è¿™ä¸ª property è¡¨ç¤ºçš„æ˜¯æ¥è§¦ç±»å‹ï¼Œæœ‰ 3 ç§ string ç±»å‹çš„å€¼ - mouse, pen, touchï¼Œåˆ†åˆ«ä»£è¡¨é¼ æ ‡ã€è§¦æ§ç¬”ã€è§¦æ‘¸ã€‚&lt;/li&gt;
&lt;li&gt;PointerEvent.pressure: è¿™ä¸ª property è¡¨ç¤ºçš„æ˜¯å‹åŠ›ç­‰çº§ï¼Œæ•°å€¼èŒƒå›´æ˜¯ä» 0 åˆ° 1 ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å‹æ„Ÿè§¦æ§ç¬”ï¼Œæˆ–è€…ä½¿ç”¨é¼ æ ‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼é»˜è®¤æ˜¯ 0.5ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å®ç°æ–¹æ¡ˆ&#34;&gt;å®ç°æ–¹æ¡ˆ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;å†å²é—ç•™çš„é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ç›‘å¬ move çš„äº‹ä»¶ï¼Œæ¯æ¬¡éƒ½ç”¨ &lt;code&gt;lineTo()&lt;/code&gt;å’Œ&lt;code&gt;stroke()&lt;/code&gt;ç»˜åˆ¶å‡ºçº¿æ¡ã€‚è¿™æ ·åšå­˜åœ¨çš„é—®é¢˜æ˜¯å»¶è¿Ÿå¾ˆä¸¥é‡ï¼Œç¬”ç”»ä¸è·Ÿç¬”ï¼ŒåŒæ—¶é”¯é½¿æ„Ÿä¹Ÿå¾ˆä¸¥é‡ã€‚&lt;/li&gt;
&lt;li&gt;å‚è€ƒäº† &lt;a href=&#34;https://github.com/szimek/signature_pad&#34;&gt;GitHub - szimek/signature_pad: HTML5 canvas based smooth signature drawing&lt;/a&gt; çš„å®ç°æ–¹æ¡ˆï¼Œä½¿ç”¨çš„æ˜¯ä¸‰æ¬¡è´å¡å°”æ›²çº¿ï¼Œç”±äºä¸‰æ¬¡è´å¡å°”æ›²çº¿çš„ç»˜åˆ¶éœ€è¦è‡³å°‘ 4 ä¸ªç‚¹ï¼Œåˆ†åˆ«æ˜¯èµ·ç‚¹ã€æ§åˆ¶ç‚¹ 1ã€æ§åˆ¶ç‚¹ 2ã€ç»ˆç‚¹ï¼Œæ‰€ä»¥ä¸èƒ½æ¯æ¬¡ move éƒ½ &lt;code&gt;stroke()&lt;/code&gt;è¿›è¡Œç»˜åˆ¶ï¼Œè€Œæ˜¯éœ€è¦è®°å½•ç‚¹åæ ‡å¹¶é€šè¿‡è®¡ç®—æ¥ç»˜åˆ¶ã€‚å®é™…æ•ˆæœæ¯”ä¸Šé¢ä¸€ç§æ–¹æ³•çš„å»¶è¿Ÿå’Œé”¯é½¿æ„Ÿéƒ½å¥½å¾ˆå¤šï¼Œ&lt;strong&gt;ä½†æ˜¯å”¯ç‹¬åœ¨ Surface Book + Surface Pen ä¸Šçš„å»¶è¿Ÿæ„Ÿè¿˜æ˜¯å¾ˆæ˜æ˜¾ï¼Œè€Œå‰ä¸€ä»£çš„ iPad Pro + Apple Pen éå¸¸æµç•…ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰åšè¿‡ Surface Pen é€‚é…çš„å¤§ç¥èƒ½è§£ç­”è¿™ä¸ªé—®é¢˜&lt;/strong&gt;ã€‚äºæ˜¯æˆ‘å°±æƒ³èƒ½ä¸èƒ½ç”¨ PointerEvent æ¥è§£å†³ï¼Œä½†æµ‹è¯•ç”¨çš„ Surface Book æ˜¯å…¬å¸çš„å¼€å‘æœºï¼Œæˆ‘ä»¬å°ç»„åªæœ‰ä¸€å°ï¼Œå¸¸å¸¸è¢«å…¶ä»–å¼€å‘å’Œ QA æŠ¢å»ä½¿ç”¨ï¼Œæ‰€ä»¥æ²¡æœ‰æœºä¼šå»éªŒè¯è¿™ä¸ªé—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å…·ä½“å®ç°&#34;&gt;å…·ä½“å®ç°&lt;/h2&gt;

&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹ &lt;a href=&#34;https://github.com/szimek/signature_pad&#34;&gt;szimek/signature_pad&lt;/a&gt; çš„æºç è¿›è¡Œä¸€ç•ªè§£æã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œmaster åˆ†æ”¯çš„æºç æ˜¯ç”¨ TypeScript å†™çš„ï¼Œè€Œåœ¨ gh-pages åˆ†æ”¯ä¸Šæœ‰ ES5 çš„ç‰ˆæœ¬ã€‚ä¸ºäº†è®©ä¸æ‡‚ ts çš„è¯»è€…èƒ½çœ‹æ‡‚ï¼Œä¸‹é¢ä¼šå¯¹ &lt;a href=&#34;https://github.com/szimek/signature_pad/blob/gh-pages/js/signature_pad.js&#34;&gt;ES5 ç‰ˆæœ¬&lt;/a&gt; çš„ä»£ç è¿›è¡Œè§£æã€‚&lt;/p&gt;

&lt;h3 id=&#34;classes&#34;&gt;Classes&lt;/h3&gt;

&lt;p&gt;è¿™é‡Œç”¨äº†ä¸¤ä¸ªè¾…åŠ©ç±»ï¼ŒBezier æ˜¯è´å¡å°”æ›²çº¿ï¼Œè€Œ Point æ˜¯ canvas ä¸­éœ€è¦ç”¨åˆ°çš„ç‚¹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;function Bezier(startPoint, control1, control2, endPoint) {
  this.startPoint = startPoint;
  this.control1 = control1;
  this.control2 = control2;
  this.endPoint = endPoint;
}

// Returns approximated length.
Bezier.prototype.length = function () {
  var steps = 10;
  var length = 0;
  var px = void 0;
  var py = void 0;

  for (var i = 0; i &amp;lt;= steps; i += 1) {
    var t = i / steps;
    var cx = this._point(t, this.startPoint.x, this.control1.x, this.control2.x, this.endPoint.x);
    var cy = this._point(t, this.startPoint.y, this.control1.y, this.control2.y, this.endPoint.y);
    if (i &amp;gt; 0) {
      var xdiff = cx - px;
      var ydiff = cy - py;
      length += Math.sqrt(xdiff * xdiff + ydiff * ydiff);
    }
    px = cx;
    py = cy;
  }

  return length;
};

Bezier.prototype._point = function (t, start, c1, c2, end) {
  return start * (1.0 - t) * (1.0 - t) * (1.0 - t) + 3.0 * c1 * (1.0 - t) * (1.0 - t) * t + 3.0 * c2 * (1.0 - t) * t * t + end * t * t * t;
};
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;function Point(x, y, time) {
  this.x = x;
  this.y = y;
  this.time = time || new Date().getTime();
}

Point.prototype.velocityFrom = function (start) {
  return this.time !== start.time ? this.distanceTo(start) / (this.time - start.time) : 1;
};

Point.prototype.distanceTo = function (start) {
  return Math.sqrt(Math.pow(this.x - start.x, 2) + Math.pow(this.y - start.y, 2));
};

Point.prototype.equals = function (other) {
  return this.x === other.x &amp;amp;&amp;amp; this.y === other.y &amp;amp;&amp;amp; this.time === other.time;
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å€¼å¾—æ³¨æ„çš„æ˜¯ Point è¿™ä¸ªç±»ä¸­ï¼ŒåŸä½œè€…åŠ å…¥äº†ç‚¹ç»˜åˆ¶çš„æ—¶é—´ï¼Œåœ¨åŸä½œè€…çš„é¡¹ç›®ä¸­æ˜¯æœ‰æ ¹æ®ç»˜åˆ¶é€Ÿåº¦è°ƒæ•´ç¬”ç”»ç²—ç»†çš„ï¼Œä½†è¿™ä¸ªåœ¨æˆ‘çš„æ”¹é€ ä¸­å› ä¸ºéœ€æ±‚çš„ç¼˜æ•…è¢«å»æ‰äº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;mousedown-touchstart&#34;&gt;mousedown/touchstart&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆæºç ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ª SignaturePad çš„ç±»ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;SignaturePad.prototype._strokeBegin = function (event) {
  this._data.push([]);
  this._reset();
  this._strokeUpdate(event);

  if (typeof this.onBegin === &#39;function&#39;) {
    this.onBegin(event);
  }
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»è¿™é‡Œå¼€å§‹çš„ä»£ç ä¼šå‡ºç°å¾ˆå¤š this æˆ–è€… selfï¼Œå®ƒä»¬å¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜éƒ½æ˜¯æŒ‡ä»£çš„æ„é€ å‡½æ•°ä¸­çš„ this æœ¬èº«ã€‚&lt;/p&gt;

&lt;p&gt;è¿™éƒ¨åˆ†æ²¡æœ‰ä»€ä¹ˆå…³é”®çš„ä»£ç ï¼Œç›´æ¥è°ƒç”¨ &lt;code&gt;this._strokeUpdate&lt;/code&gt; äº†ã€‚&lt;code&gt;onBegin&lt;/code&gt; æ˜¯ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰çš„å›è°ƒå‡½æ•°ã€‚&lt;/p&gt;

&lt;h3 id=&#34;mousemove-touchmove&#34;&gt;mousemove/touchmove&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;SignaturePad.prototype._strokeUpdate = function (event) {
  var x = event.clientX;
  var y = event.clientY;

  var point = this._createPoint(x, y); // æ ¹æ® event å¯¹è±¡ä¸­çš„ clientX å’Œ clientY ç”Ÿæˆè¯¥ç‚¹åœ¨ canvas åæ ‡ç³»ä¸­çš„ Point å¯¹è±¡
  var lastPointGroup = this._data[this._data.length - 1];
  var lastPoint = lastPointGroup &amp;amp;&amp;amp; lastPointGroup[lastPointGroup.length - 1];
  var isLastPointTooClose = lastPoint &amp;amp;&amp;amp; point.distanceTo(lastPoint) &amp;lt; this.minDistance;

  // å¦‚æœç»˜åˆ¶çš„ç‚¹å’Œä¹‹å‰çš„ç‚¹è·ç¦»å¤ªè¿‘ï¼Œåˆ™è·³è¿‡è¯¥ç‚¹çš„ç»˜åˆ¶
  // Skip this point if it&#39;s too close to the previous one
  if (!(lastPoint &amp;amp;&amp;amp; isLastPointTooClose)) {
    var _addPoint = this._addPoint(point),
        curve = _addPoint.curve,
        widths = _addPoint.widths;

    if (curve &amp;amp;&amp;amp; widths) {
      this._drawCurve(curve, widths.start, widths.end);
    }

    this._data[this._data.length - 1].push({
      x: point.x,
      y: point.y,
      time: point.time,
      color: this.penColor
    });
  }
};

SignaturePad.prototype._createPoint = function (x, y, time) {
  var rect = this._canvas.getBoundingClientRect();

  return new Point(x - rect.left, y - rect.top, time || new Date().getTime());
};

/*
 * ç”Ÿæˆ Bezier å¯¹è±¡å’Œæ›²çº¿çš„å®½åº¦å€¼
 * curve: Bezier å¯¹è±¡
 * widths: åŒ…å« start å’Œ end ä¸¤ä¸ª properties
*/
SignaturePad.prototype._addPoint = function (point) {
  var points = this.points;
  var tmp = void 0;

  points.push(point);

  if (points.length &amp;gt; 2) {
    // Bezier ç±»éœ€è¦ 4 ä¸ªç‚¹çš„å‚æ•°ï¼Œä½œè€…ä¸ºäº†å‡å°‘å»¶è¿Ÿï¼ŒæŠŠç¬¬ä¸€ä¸ªç‚¹å¤åˆ¶äº†ä¸€æ¬¡ï¼Œæ„é€ æˆ 4 ä¸ªç‚¹çš„æ•°ç»„ï¼Œä»¥æ­¤è®¡ç®—å‰ä¸¤ä¸ªç‚¹ä¹‹é—´çš„ä¸‰æ¬¡è´å¡å°”æ›²çº¿çš„æ§åˆ¶ç‚¹
    // To reduce the initial lag make it work with 3 points
    // by copying the first point to the beginning.
    if (points.length === 3) points.unshift(points[0]);

    tmp = this._calculateCurveControlPoints(points[0], points[1], points[2]);
    var c2 = tmp.c2;
    tmp = this._calculateCurveControlPoints(points[1], points[2], points[3]);
    var c3 = tmp.c1;
    var curve = new Bezier(points[1], c2, c3, points[2]);
    var widths = this._calculateCurveWidths(curve);

    // Remove the first element from the list,
    // so that we always have no more than 4 points in points array.
    points.shift();

    return { curve: curve, widths: widths };
  }

  return {};
};

/*
 * ç»˜åˆ¶è´å¡å°”æ›²çº¿
 * ç»˜åˆ¶æ–¹æ³•ä¸ºä» 0 è‡³ 1 é€æ­¥å¢å¤§è´å¡å°”æ›²çº¿çš„å‚æ•° t
 * ä»£ç å®é™…ä¸Šå°±æ˜¯å…¬å¼çš„è®¡ç®—
*/
SignaturePad.prototype._drawCurve = function (curve, startWidth, endWidth) {
  var ctx = this._ctx;
  var widthDelta = endWidth - startWidth;
  var drawSteps = Math.floor(curve.length()); // ç»˜åˆ¶æ­¥é•¿æ˜¯æ›²çº¿çš„é•¿åº¦

  ctx.beginPath();

  for (var i = 0; i &amp;lt; drawSteps; i += 1) {
    // Calculate the Bezier (x, y) coordinate for this step.
    var t = i / drawSteps;
    var tt = t * t;
    var ttt = tt * t;
    var u = 1 - t;
    var uu = u * u;
    var uuu = uu * u;

    var x = uuu * curve.startPoint.x;
    x += 3 * uu * t * curve.control1.x;
    x += 3 * u * tt * curve.control2.x;
    x += ttt * curve.endPoint.x;

    var y = uuu * curve.startPoint.y;
    y += 3 * uu * t * curve.control1.y;
    y += 3 * u * tt * curve.control2.y;
    y += ttt * curve.endPoint.y;

    var width = startWidth + ttt * widthDelta;
    this._drawPoint(x, y, width);
  }

  ctx.closePath();
  ctx.fill();
};

// ç»˜åˆ¶å¼§çº¿
SignaturePad.prototype._drawPoint = function (x, y, size) {
  var ctx = this._ctx;

  ctx.moveTo(x, y);
  ctx.arc(x, y, size, 0, 2 * Math.PI, false);
  this._isEmpty = false;
};

// è®¡ç®—è´å¡å°”æ›²çº¿çš„æ§åˆ¶ç‚¹
SignaturePad.prototype._calculateCurveControlPoints = function (s1, s2, s3) {
  var dx1 = s1.x - s2.x;
  var dy1 = s1.y - s2.y;
  var dx2 = s2.x - s3.x;
  var dy2 = s2.y - s3.y;

  var m1 = { x: (s1.x + s2.x) / 2.0, y: (s1.y + s2.y) / 2.0 };
  var m2 = { x: (s2.x + s3.x) / 2.0, y: (s2.y + s3.y) / 2.0 };

  var l1 = Math.sqrt(dx1 * dx1 + dy1 * dy1);
  var l2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);

  var dxm = m1.x - m2.x;
  var dym = m1.y - m2.y;

  var k = l2 / (l1 + l2);
  var cm = { x: m2.x + dxm * k, y: m2.y + dym * k };

  var tx = s2.x - cm.x;
  var ty = s2.y - cm.y;

  return {
    c1: new Point(m1.x + tx, m1.y + ty),
    c2: new Point(m2.x + tx, m2.y + ty)
  };
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¸€éƒ¨åˆ†å°±æ˜¯ç»˜å›¾çš„æ ¸å¿ƒç®—æ³•äº†ï¼Œæˆ‘åœ¨é¡¹ç›®ä¸­ä¹Ÿæ˜¯ç›´æ¥ä½¿ç”¨äº†ä½œè€…ç¼–å†™çš„ä»£ç ã€‚
åœ¨ &lt;code&gt;_addPoint()&lt;/code&gt; ä¸­æœ‰åä¸º &lt;code&gt;_calculateCurveWidths&lt;/code&gt; çš„å‡½æ•°ï¼Œæ˜¯åŸä½œè€…ç”¨äºæ ¹æ®ç»˜åˆ¶é€Ÿåº¦è®¡ç®—ç¬”ç”»ç²—ç»†çš„ç®—æ³•ï¼ŒåŸä»£ç å¯¹åº”çš„ç›¸å…³å‚æ•°æ˜¯ &lt;code&gt;constructor&lt;/code&gt; ä¸­çš„ &lt;code&gt;this.maxWidth&lt;/code&gt; å’Œ &lt;code&gt;this.minWidth&lt;/code&gt;ã€‚
ç”±äºæˆ‘åšçš„é¡¹ç›®ä¸éœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘åªéœ€è¦æŠŠ &lt;code&gt;this.maxWidth&lt;/code&gt; å’Œ &lt;code&gt;this.minWidth&lt;/code&gt; è®¾ç½®æˆç›¸åŒçš„å€¼å³å¯ã€‚
è¿™ä¸ªåŠŸèƒ½è¯¦æƒ…å¯ä»¥å‚è€ƒå‰æ–‡æä¾›çš„ä½œè€…çš„ GitHub ä¸Šçš„æºç ã€‚&lt;/p&gt;

&lt;p&gt;ä¸»è¦å†…å®¹å·²ç»ç”¨ä¸­æ–‡å¤‡æ³¨åœ¨ä»£ç ä¸­äº†ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯ï¼šé€‰å– 3 ä¸ªç‚¹æ¥è®¡ç®—æ§åˆ¶ç‚¹ï¼Œæ ¹æ®æ§åˆ¶ç‚¹ç»˜åˆ¶å‡ºä¸¤ç‚¹ä¹‹é—´çš„æ›²çº¿&lt;/p&gt;

&lt;h3 id=&#34;mouseup-touchend&#34;&gt;mouseup/touchend&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-JavaScript&#34;&gt;SignaturePad.prototype._strokeEnd = function (event) {
  var canDrawCurve = this.points.length &amp;gt; 2; // å¦‚æœç‚¹çš„æ•°é‡å¤ªå°‘ï¼Œåˆ™æ— æ³•ç»˜åˆ¶æ›²çº¿
  var point = this.points[0]; // Point instance

  if (!canDrawCurve &amp;amp;&amp;amp; point) {
    this._drawDot(point); // ç‚¹æ•°é‡å¤ªå°‘æ—¶æ”¹ä¸ºç»˜åˆ¶å•ä¸ªç‚¹
  }

  if (point) {
    var lastPointGroup = this._data[this._data.length - 1];
    var lastPoint = lastPointGroup[lastPointGroup.length - 1]; // plain object

    // ç›¸åŒçš„ç‚¹ä¼šè¢«æ’é™¤ï¼Œä¸ä¼šè¢«ç»˜åˆ¶
    // When drawing a dot, there&#39;s only one point in a group, so without this check
    // such group would end up with exactly the same 2 points.
    if (!point.equals(lastPoint)) {
      lastPointGroup.push({
        x: point.x,
        y: point.y,
        time: point.time,
        color: this.penColor
      });
    }
  }

  if (typeof this.onEnd === &#39;function&#39;) {
    this.onEnd(event);
  }
};

// ç”»ç‚¹
SignaturePad.prototype._drawDot = function (point) {
  var ctx = this._ctx;
  var width = typeof this.dotSize === &#39;function&#39; ? this.dotSize() : this.dotSize;

  ctx.beginPath();
  this._drawPoint(point.x, point.y, width);
  ctx.closePath();
  ctx.fill();
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™é‡Œä½œè€…åšäº†ä¸€ä¸ªå¤„ç†ï¼Œå°±æ˜¯åœ¨ç”Ÿæˆæœ‰æ•ˆçš„ç‚¹æ•°é‡å¤ªå°‘æ—¶åˆ™ä¸ä¼šç»˜åˆ¶æ›²çº¿ï¼Œæ”¹ä¸ºç»˜åˆ¶å•ç‚¹ã€‚å¦‚æœå¿½ç•¥äº†æ­¤æ­¥ï¼Œåˆ™ä¼šå‡ºç°ç‚¹è§¦å’Œå°èŒƒå›´å†…ç§»åŠ¨æ— ååº”çš„æƒ…å†µï¼Œä¸¥é‡å½±å“æ‰‹å†™ä½“éªŒã€‚&lt;/p&gt;

&lt;h2 id=&#34;å…¶ä»–åŠŸèƒ½&#34;&gt;å…¶ä»–åŠŸèƒ½&lt;/h2&gt;

&lt;p&gt;è¿™éƒ¨åˆ†åŠŸèƒ½éƒ½æ˜¯æˆ‘æ ¹æ®éœ€æ±‚åŠ è¿›å»çš„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å•æ¬¡æ‰‹å†™ä¿å­˜æˆå›¾ç‰‡&#34;&gt;å•æ¬¡æ‰‹å†™ä¿å­˜æˆå›¾ç‰‡&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆæˆ‘ä½¿ç”¨çš„ canvas åŒºåŸŸå¾ˆå¤§ï¼Œä½†æ˜¯å®é™…ä¸Šå¯èƒ½æœ‰æ‰‹å†™å†…å®¹çš„èŒƒå›´å¾ˆå°ï¼Œæ‰€ä»¥è¿™è¾¹è¦åšä¸€æ­¥å‰ªè£çš„æ“ä½œã€‚
åœ¨ä¸Šé¢çš„ä»£ç ä¸­æœ‰ä¸€ä¸ª &lt;code&gt;this._data&lt;/code&gt; çš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡è®°å½•äº†æ‰€æœ‰ç»˜åˆ¶è¿‡çš„ç‚¹ã€‚
å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªåæ ‡æ•°æ®æ¥æ‰¾å‡ºä¸€ä¸ªåŒ…å«æ‰€æœ‰ç‚¹çš„åŒºåŸŸï¼Œå†ç”¨ &lt;code&gt;drawImage()&lt;/code&gt; å°†å…¶ç»˜åˆ¶åˆ°ä¸€ä¸ªå¤§å°å’Œè¿™ä¸ªåŒºåŸŸç›¸åŒçš„ã€éšè—çš„ canvas ä¸­ã€‚
æ¥ç€ä½¿ç”¨ &lt;code&gt;toBlob()&lt;/code&gt; æˆ–è€… &lt;code&gt;toDataURL()&lt;/code&gt; å°±å¯ä»¥å¯¼å‡ºå›¾ç‰‡äº†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ‰€æœ‰çš„æ‰‹å†™å†…å®¹æ‹¼æ¥å¹¶ä¿å­˜ä¸ºä¸€å¼ å›¾ç‰‡&#34;&gt;æ‰€æœ‰çš„æ‰‹å†™å†…å®¹æ‹¼æ¥å¹¶ä¿å­˜ä¸ºä¸€å¼ å›¾ç‰‡&lt;/h3&gt;

&lt;p&gt;ä¸Šé¢çš„ã€å•æ¬¡æ‰‹å†™ä¿å­˜æˆå›¾ç‰‡ã€‘ï¼Œåœ¨é¡¹ç›®ä¸­æˆ‘ä»¬æ˜¯æŠŠå®ƒä»¬æ’åˆ—èµ·æ¥ï¼Œæœ‰ç©ºæ ¼ã€æ¢è¡Œã€é€€æ ¼ç­‰æ“ä½œä¾›æ’ç‰ˆï¼Œä½†æ˜¯æœ€åéœ€è¦æŠŠè¿™äº›æ‰€æœ‰çš„å†…å®¹éƒ½å¯¼å‡ºæˆä¸€å¼ å›¾ç‰‡è¿›è¡Œä¿å­˜ã€‚
è¿™é‡ŒåŒæ ·éœ€è¦ç”¨åˆ° &lt;code&gt;drawImage()&lt;/code&gt;ï¼Œä¸è¿‡åŒºåˆ«åœ¨äºä¸éœ€è¦è£åˆ‡ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šé¦–å…ˆæ¯å¼ å›¾å¤§å°ä¸åŒï¼Œæ‰€ä»¥æˆ‘ç»™æ¯ä¸€è¡Œæ¨ªå‘æ’åˆ—çš„å›¾ç‰‡å®šäº†ä¸€ä¸ªå›ºå®šçš„é«˜åº¦ï¼Œè¶…è¿‡è¿™ä¸ªé«˜åº¦çš„å›¾ç‰‡ä¼šè¢«ç­‰æ¯”ç¼©æ”¾åˆ°è¿™ä¸ªé«˜åº¦ï¼Œæœªè¶…è¿‡çš„åˆ™ä¸ä½œå¤„ç†ã€‚
è€Œç»˜åˆ¶ä¸Šå»ä¹‹åï¼Œæ¯æ¬¡éƒ½ä¼šç§»åŠ¨ç»˜åˆ¶èµ·å§‹ç‚¹ï¼Œåœ¨åŒä¸€è¡Œå†…çš„åˆ™ç›´æ¥å‘å³ä¾§å¹³ç§»ï¼ˆç¼©æ”¾åçš„ï¼‰å›¾ç‰‡çš„å®½åº¦ï¼Œç©ºæ ¼å°±å‘å³ç§»åŠ¨ä¸€æ®µç©ºç™½çš„ä½ç½®ï¼Œæ¢è¡Œåˆ™å‘ä¸‹ç§»åŠ¨ä¸€è¡Œçš„é«˜åº¦å¹¶ç§»åŠ¨åˆ°æœ€å·¦ä¾§ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;ä»…ä»…æ˜¯ä¸€ä¸ªå…¥é—¨çº§çš„æ“ä½œï¼Œä½†æ˜¯ç”¨æ¯”è¾ƒç²—æš´çš„æ–¹å¼å®ç°çš„è¯ï¼Œä½“éªŒä¸Šå’Œæ›´ä¼˜çš„æ–¹æ¡ˆçš„å·®è·ä¼šæ¯”è¾ƒæ˜æ˜¾ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ECS ä¸Šçš„ git ç®¡ç†å·¥å…·è¸©å‘è®°</title>
      <link>https://elizurhz.cn/backend/remote-private-git-first-look/</link>
      <pubDate>Sun, 24 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/backend/remote-private-git-first-look/</guid>
      <description>

&lt;h1 id=&#34;ecs-ä¸Šçš„-git-ç®¡ç†å·¥å…·è¸©å‘è®°&#34;&gt;ECS ä¸Šçš„ git ç®¡ç†å·¥å…·è¸©å‘è®°&lt;/h1&gt;

&lt;h2 id=&#34;gitlab&#34;&gt;gitlab&lt;/h2&gt;

&lt;h3 id=&#34;åœ¨-centos-ä¸Šå®‰è£…-gitlab&#34;&gt;åœ¨ CentOS ä¸Šå®‰è£… gitlab&lt;/h3&gt;

&lt;p&gt;å‚è€ƒ &lt;a href=&#34;https://blog.csdn.net/caib1109/article/details/51756246&#34;&gt;8 å°æ—¶å¤–å®è·µç³»åˆ—(å…­) - åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šæ­å»º GitLab(è‰ç¨¿) - CSDN åšå®¢&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;gitlab éå¸¸åƒæ€§èƒ½ï¼Œåœ¨ 1 æ ¸ 1G çš„æœåŠ¡å™¨ä¸Šå®‰è£…åä¼šå¯¼è‡´æœºå­éå¸¸å¡ï¼ŒåŒæ—¶åŸŸå/IP è®¿é—®ä¹Ÿä¼šå‡ºç° 502ï¼ŒæŸ¥èµ„æ–™ä¹‹åå‘ç°æ˜¯é…ç½®å¤ªä½çš„é—®é¢˜ã€‚å®˜æ–¹æ¨èçš„é…ç½®æ˜¯ 2 æ ¸å¿ƒ 8G å†…å­˜ï¼Œæˆ‘ä»¬æ™®é€šä¸ªäººç”¨æˆ·æ˜¾ç„¶éš¾ä»¥æ”¯ä»˜è¿™ä¹ˆæ˜‚è´µçš„æœåŠ¡å™¨é…ç½®ï¼Œæ›´ä¸ç”¨è¯´æµ·å¤–ä¸»æœºäº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;ä½¿ç”¨-docker-éƒ¨ç½²-gitlab&#34;&gt;ä½¿ç”¨ docker éƒ¨ç½² gitlab&lt;/h3&gt;

&lt;p&gt;åªéœ€è¦åœ¨ docker hub ä¸­ &lt;code&gt;docker pull gitlab/gitlab-ce&lt;/code&gt; å°±è¡Œï¼Œç„¶åæˆ‘å¯åŠ¨å®¹å™¨çš„çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sudo docker run --detach \
  --hostname gitlab.mydomain.com \
  --publish 8443:443 --publish 80:80 --publish 2222:22 \
  --name gitlab \
  --restart always \
  --volume /srv/gitlab/config:/etc/gitlab \
  --volume /srv/gitlab/logs:/var/log/gitlab \
  --volume /srv/gitlab/data:/var/opt/gitlab \
  gitlab/gitlab-ce
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚éœ€ä¿®æ”¹ gitlab.rb çš„é…ç½®ï¼Œåªéœ€è¦ &lt;code&gt;vim /srv/gitlab/config/gitlab.rb&lt;/code&gt; ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬éœ€è¦é…ç½®çš„æœ‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;external_url &#39;ä½ çš„åŸŸåæˆ–è€…IP&#39; # æ”¹æˆä½ çš„åŸŸåæˆ–è€… IPï¼Œå¦‚æœä½ çš„ç«¯å£æ˜ å°„ä¸æ˜¯ 80ï¼Œé‚£ä¹Ÿä¸èƒ½åœ¨è¿™é‡ŒåŠ ç«¯å£
gitlab_rails[&#39;gitlab_shell_ssh_port&#39;] = 2222 # é˜²æ­¢å’Œæœ¬æœº 22 ç«¯å£å†²çª
unicorn[&#39;port&#39;] = 8999 # å¦‚æœä½ çš„ 8080 ç«¯å£è¢«å ç”¨çš„è¯
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å¦å¤–è®°ä½ï¼Œå¦‚æœå•å¼€æŸä¸ªç«¯å£ï¼Œéœ€è¦åœ¨ ECS å®ä¾‹çš„å®‰å…¨ç»„ä¸­å…è®¸è¿™ä¸ªç«¯å£è¢«æŸä¸ªæˆ–è€…æŸäº› IP è®¿é—®ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é…ç½®å®Œæˆä¹‹åéœ€è¦åœ¨å®¹å™¨ä¸­ reconfigure: &lt;code&gt;docker exec -it gitlab gitlab-ctl reconfigure&lt;/code&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ç„¶è€Œæˆ‘æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼å®Œæˆä¹‹åï¼Œé€šè¿‡åŸŸåæˆ–è€… IP è¿›å…¥ä»æ˜¯ 502ã€‚
åæ¥æˆ‘å°è¯•äº†åœ¨ä¸åŒæœºå­ä¸Šéƒ¨ç½²ã€‚ä¾‹å¦‚åœ¨ç¾¤è¾‰ DS218+ ä¸Šç”¨åŒæ ·çš„æ–¹å¼é…ç½®ä¼šå‡ºç° å®¹å™¨æ„å¤–åœæ­¢ çš„é—®é¢˜ï¼›åœ¨æˆ‘çš„ iMac æœ¬æœºä¸Šç”¨ docker éƒ¨ç½²å°±å¯ä»¥æ­£å¸¸è®¿é—®å’Œè¿›è¡Œä»£ç ç®¡ç†&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;gogs&#34;&gt;gogs&lt;/h2&gt;

&lt;p&gt;gogs ä¸åƒ gitlab é‚£æ ·åƒæ€§èƒ½ï¼ŒåŠŸèƒ½ä¹Ÿå¾ˆå®Œå–„ï¼Œä¸è¿‡ gogs éœ€è¦æœ‰é¢å¤–çš„æ•°æ®åº“ä¾èµ–ï¼Œå¦‚ MySQLã€‚å…·ä½“çš„éƒ¨ç½²æ–¹å¼å‚è€ƒä»¥ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.jianshu.com/p/5f5e419b5de8&#34;&gt;docker å®‰è£… mysql - ç®€ä¹¦&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.jianshu.com/p/2a7acb07b352&#34;&gt;docker å®‰è£… gogs - ç®€ä¹¦&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å‹˜è¯¯ï¼šåœ¨ã€Šdocker å®‰è£… mysql - ç®€ä¹¦ã€‹ä¸­ï¼Œåˆ›å»ºç½‘ç»œçš„å‘½ä»¤ä¸æ˜¯ &lt;code&gt;docker create network backend&lt;/code&gt; è€Œæ˜¯ &lt;code&gt;docker network create backend&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æˆ‘çš„å®¹å™¨å¯åŠ¨ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# å¯åŠ¨ MySQL
docker run -d --name mysql57 \
--net=backend \ # åŠ å…¥åˆ›å»ºçš„ backend ç½‘ç»œä¸­
-p 3306:3306 \
-e MYSQL_ROOT_PASSWORD=root \
-v /srv/mysql/data:/var/lib/mysql \
-v /srv/mysql/conf:/etc/mysql/conf.d \
# å¯åŠ¨ gogs
docker run -d \
-p 10022:22 -p 3000:3000 \
--name=gogs \
--net=backend \ # åŠ å…¥åˆ›å»ºçš„ backend ç½‘ç»œä¸­
-v /srv/gogs/:/data gogs/gogs
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ­¤æ—¶è®¿é—®æœåŠ¡å™¨çš„ 3000 ç«¯å£å³å¯è¿›å…¥è®¾ç½®ç•Œé¢ï¼Œè®°ä½è¦æŠŠ localhost å…¨éƒ¨æ”¹æˆæœåŠ¡å™¨ ipã€‚&lt;/p&gt;

&lt;h3 id=&#34;å…³äº-gogs-çš„æ•°æ®åº“è®¾ç½®&#34;&gt;å…³äº gogs çš„æ•°æ®åº“è®¾ç½®&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆç”±äºæœ¬ä¾‹ä½¿ç”¨äº† docker networkï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨ å®¹å™¨å:ç«¯å£ æ¥è®¿é—®ï¼Œä¾‹å¦‚ mysql57:3306ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–æˆ‘ä»¬éœ€è¦åœ¨ mysql å®¹å™¨ä¸­åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¦åˆ™ gogs æ— æ³•å®Œæˆè®¾ç½®ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;docker exec -it mysql57 /bin/bash
mysql -u root -p
# ç„¶åè¾“å…¥å¯†ç ï¼Œå¦‚æœä½ æ²¡æ›´æ”¹å¯†ç ï¼Œåˆ™å¯†ç æ˜¯ root
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ¥ç€åœ¨ mysql å‘½ä»¤è¡Œä¸­åˆ›å»ºæ•°æ®åº“ï¼Œgogs é»˜è®¤æ•°æ®åº“åå°±æ˜¯ gogs&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;CREATE DATABASE gogs;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ¥ç€æˆ‘ä»¬åœ¨ç½‘é¡µä¸­å°±å¯ä»¥å®Œæˆ gogs çš„åˆå§‹åŒ–è®¾ç½®äº†ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæƒ³è¦ä½¿ç”¨ gogsï¼Œé¦–å…ˆæˆ‘ä»¬è¦æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œæ³¨æ„ç¬¬ä¸€ä¸ªæ³¨å†Œçš„è´¦å·é»˜è®¤æ˜¯æ‹¥æœ‰æœ€é«˜æƒé™çš„è´¦å·ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘é‡åˆ°äº† git clone æ—¶å‘ç°æœ‰ not a repository çš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯ IP/åŸŸåã€ç«¯å£ç­‰ç­‰è®¾ç½®çš„é—®é¢˜ï¼Œä»åœ¨ç ”ç©¶ä¸­&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.csdn.net/caib1109/article/details/51756246&#34;&gt;8 å°æ—¶å¤–å®è·µç³»åˆ—(å…­) - åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šæ­å»º GitLab(è‰ç¨¿) - CSDN åšå®¢&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/5f5e419b5de8&#34;&gt;docker å®‰è£… mysql - ç®€ä¹¦&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/2a7acb07b352&#34;&gt;docker å®‰è£… gogs - ç®€ä¹¦&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>GitHub ä¸Š Fork çš„ä»“åº“å¦‚ä½•ä¸åŸä»“åº“åŒæ­¥å¹¶æäº¤å†…å®¹</title>
      <link>https://elizurhz.cn/tips/git-upstream/</link>
      <pubDate>Sun, 24 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/tips/git-upstream/</guid>
      <description>

&lt;h1 id=&#34;github-ä¸Š-fork-çš„ä»“åº“å¦‚ä½•ä¸åŸä»“åº“åŒæ­¥å¹¶æäº¤å†…å®¹&#34;&gt;GitHub ä¸Š Fork çš„ä»“åº“å¦‚ä½•ä¸åŸä»“åº“åŒæ­¥å¹¶æäº¤å†…å®¹&lt;/h1&gt;

&lt;p&gt;æˆ‘ä»¬å¯èƒ½æœ‰æ—¶ä¼šé‡åˆ°éœ€è¦å‘ GitHub ä¸Šçš„å¼€æºçš„é¡¹ç›®æäº¤ä»£ç ã€‚åœ¨ GitHub ä¸­ï¼Œç”±äºä½ ä¸æ˜¯é‚£ä¸ªå¼€æºé¡¹ç›®ä¸­æœ‰æƒé™æäº¤ä»£ç çš„äººï¼Œä½ åªèƒ½ Fork åå†å‘èµ· Pull Requestã€‚&lt;/p&gt;

&lt;h2 id=&#34;fork-ä»“åº“&#34;&gt;Fork ä»“åº“&lt;/h2&gt;

&lt;p&gt;ä½ å¯ä»¥åœ¨ GitHub ç½‘é¡µä¸Šç‚¹å‡» Forkï¼Œä¹‹åä½ å¯ä»¥åœ¨ä½ çš„ä¸ªäººä¸»é¡µçš„ Repository ä¸­æ‰¾åˆ°ä½  Fork çš„ä»“åº“ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/git-upstream/1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ç„¶åä½ å°±å¯ä»¥å°†å…¶ clone åˆ°æœ¬åœ°ã€‚&lt;/p&gt;

&lt;h2 id=&#34;fork-çš„æœ¬åœ°ä»“åº“ä¸æºä»“åº“è¿æ¥&#34;&gt;Fork çš„æœ¬åœ°ä»“åº“ä¸æºä»“åº“è¿æ¥&lt;/h2&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;a href=&#34;https://help.github.com/articles/syncing-a-fork/&#34;&gt;Syncing a fork - User Documentation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é¦–å…ˆåœ¨å‘½ä»¤è¡Œå·¥å…·ä¸­è¾“å…¥&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ git remote -v
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ­¤æ—¶åº”è¯¥æ˜¾ç¤ºå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;origin  https://github.com/YOUR_USERNAME/YOUR_FORK.git (fetch)
origin  https://github.com/YOUR_USERNAME/YOUR_FORK.git (push)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å°†å…¶è¿æ¥åˆ°æºä»“åº“ï¼Œæ‰€ä»¥éœ€è¦ç”¨å‘½ä»¤å»è¿æ¥ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ git remote add upstream https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™é‡Œçš„åœ°å€æ˜¯&lt;strong&gt;æºä»“åº“&lt;/strong&gt;çš„åœ°å€ã€‚æ¥ç€æˆ‘ä»¬å†è¾“å…¥&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ git remote -v
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ—¶åº”è¯¥èƒ½çœ‹åˆ°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;origin    https://github.com/YOUR_USERNAME/YOUR_FORK.git (fetch)
origin    https://github.com/YOUR_USERNAME/YOUR_FORK.git (push)
upstream  https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git (fetch)
upstream  https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git (push)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†ä¸ä¸æºä»“åº“çš„è¿æ¥ã€‚&lt;/p&gt;

&lt;h2 id=&#34;fork-çš„ä»“åº“ä¸æºä»“åº“åŒæ­¥ä»£ç &#34;&gt;Fork çš„ä»“åº“ä¸æºä»“åº“åŒæ­¥ä»£ç &lt;/h2&gt;

&lt;p&gt;é¦–å…ˆï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ git fetch upstream
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è·å–æºä»“åº“æ›´æ–°ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ git checkout master
$ git merge upstream/master
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·å°±å¯ä»¥å°†æœ¬åœ° master åˆ†æ”¯æ›´æ–°åˆ°æœ€æ–°ã€‚æˆ‘ä»¬å°±å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šåˆ›å»ºæ–°åˆ†æ”¯æäº¤ PRã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>React &#43; TypeScript ä»äº‘ç©å®¶åˆ°å…¥é—¨</title>
      <link>https://elizurhz.cn/frontend/typescript-for-jser/</link>
      <pubDate>Sun, 24 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/frontend/typescript-for-jser/</guid>
      <description>

&lt;h1 id=&#34;react-typescript-ä»äº‘ç©å®¶åˆ°å…¥é—¨&#34;&gt;React + TypeScript ä»äº‘ç©å®¶åˆ°å…¥é—¨&lt;/h1&gt;

&lt;p&gt;TypeScript å¯¹æˆ‘ä»¬å¼€å‘æœ€å¤§çš„å¸®åŠ©å°±æ˜¯ç±»å‹æ£€æŸ¥ï¼Œæ‰€ä»¥ç©è½¬ TypeScript å…¶å®å°±æ˜¯åœ¨ç©è½¬ç±»å‹ã€‚è€Œ TypeScript æœ¬èº«å’Œ Java, C# ç­‰é¢å‘å¯¹è±¡çš„è¯­è¨€æœ‰éå¸¸å¤šç±»ä¼¼çš„åœ°æ–¹ï¼Œæœ‰ç›¸åº”ç»éªŒçš„è¯»è€…èƒ½å¤Ÿè¾ƒå¿«åœ°å…¥é—¨ã€‚æœ¬æ–‡æ—¨åœ¨äºå¸®åŠ©æ— é¢å‘å¯¹è±¡å¼€å‘ç»éªŒçš„ JavaScript ä½¿ç”¨è€…èƒ½æœ€å¿«é€Ÿåœ°ä¸Šæ‰‹å¹¶ä½¿ç”¨ TypeScript ç¼–å†™ React åº”ç”¨ã€‚ç”±äºç¯‡å¹…å’Œå®šä½æ‰€é™ï¼Œæœ¬æ–‡å°†ä¸ä¼šæ¶‰åŠåˆ°è¾ƒä¸ºå¤æ‚çš„ç»„ä»¶è®¾è®¡æ¨¡å¼ã€‚&lt;/p&gt;

&lt;h2 id=&#34;typescript-åŸºç¡€&#34;&gt;TypeScript åŸºç¡€&lt;/h2&gt;

&lt;p&gt;è¿™éƒ¨åˆ†ä¸»è¦ä»‹ç»å…¥é—¨ TypeScript å¿…é¡»æŒæ¡çš„ï¼Œä»¥åŠ React å¼€å‘ä¸­ç»å¸¸ä¼šç”¨åˆ°çš„ä¸€äº›è¯­æ³•è§„èŒƒã€‚&lt;/p&gt;

&lt;h3 id=&#34;åŸºç¡€ç±»å‹&#34;&gt;åŸºç¡€ç±»å‹&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;number: æ•°å­—&lt;/li&gt;
&lt;li&gt;string: å­—ç¬¦ä¸²&lt;/li&gt;
&lt;li&gt;boolean: å¸ƒå°”å€¼&lt;/li&gt;
&lt;li&gt;Array: æ•°ç»„ã€‚åœ¨ä½¿ç”¨æ•°ç»„ç±»å‹çš„æ—¶å€™å¿…é¡»æ ‡è®°æ•°ç»„ä¸­çš„æ•°æ®ç±»å‹ï¼Œå¦‚ &lt;code&gt;number[]&lt;/code&gt; æˆ–è€… &lt;code&gt;Array&amp;lt;string&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Tuple: å…ƒç»„ã€‚&lt;code&gt;let x: [string, number];&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;any: ä»»æ„ç±»å‹&lt;/li&gt;
&lt;li&gt;void: ç©ºï¼Œä¸€èˆ¬ç”¨äºå‡½æ•°çš„è¿”å›å€¼&lt;/li&gt;
&lt;li&gt;never: æ°¸è¿œä¸ä¼šå‡ºç°çš„ç±»å‹ï¼Œä¸€èˆ¬ç”¨äºå‡½æ•°çš„è¿”å›å€¼ï¼Œä¾‹å¦‚æŠ›å‡ºé”™è¯¯æˆ–è€…æ°¸è¿œä¸ç»“æŸçš„æ­»å¾ªç¯ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;å¯é€‰ç±»å‹&#34;&gt;å¯é€‰ç±»å‹&lt;/h3&gt;

&lt;p&gt;æ ‡è®°ä¸ºå¯é€‰ç±»å‹çš„å±æ€§å¹¶éæ˜¯å¿…é¡»çš„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;interface IObj {
  str?: string;
  num: number;
}

// tslint ä¸æŠ¥é”™
let obj1: IObj = {
  num: 123
};

// tslint æŠ¥é”™
let obj2: IObj = {
  str: &amp;quot;asdf&amp;quot;
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/typescript-for-jser/optional-error.png&#34; alt=&#34;optional-error&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;readonly&#34;&gt;Readonly&lt;/h3&gt;

&lt;p&gt;ä¸€èˆ¬åœ¨ Interface å’Œ Class ä¸­ä¼šä½¿ç”¨ã€‚è®¾ç½®ä¸º &lt;code&gt;readonly&lt;/code&gt; çš„å˜é‡ã€å±æ€§ï¼Œä¸€æ—¦å®šä¹‰åå°±æ— æ³•ç›´æ¥ä¿®æ”¹ã€‚å¦‚æœåœ¨ä»£ç ä¸­æœ‰ä¿®æ”¹çš„æ“ä½œï¼Œåˆ™ tslint ä¼šæŠ¥é”™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://elizurhz.cn/images/typescript-for-jser/readonly-error.png&#34; alt=&#34;readonly-error&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;å‡½æ•°&#34;&gt;å‡½æ•°&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;function add(x: number, y: number): number {
  return x + y;
}

let myAdd: (x: number, y: number) =&amp;gt; number = function(
  x: number,
  y: number
): number {
  return x + y;
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å‡½æ•°çš„ç±»å‹é™åˆ¶ä¸»è¦åœ¨å‚æ•°å’Œè¿”å›å€¼çš„ä½ç½®éœ€è¦å®šä¹‰ã€‚å¦‚æœåœ¨ç­‰å·å·¦ä¾§å·²ç»å®šä¹‰äº†ç±»å‹ï¼Œé‚£ä¹ˆå³ä¾§å¯ä»¥ä¸éœ€è¦å†™ç±»å‹ï¼Œå¦‚ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;let myAdd: (baseValue: number, increment: number) =&amp;gt; number = function(x, y) {
  return x + y;
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¸ªåœ¨ TypeScript ä¸­è¢«ç§°ä½œ â€œcontextual typingâ€ã€‚&lt;/p&gt;

&lt;h2 id=&#34;interface&#34;&gt;interface&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;One of TypeScriptâ€™s core principles is that type-checking focuses on the shape that values have. This is sometimes called â€œduck typingâ€ or â€œstructural subtypingâ€.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Interface ä¸€èˆ¬ç”¨äºæè¿°ä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„é™åˆ¶ï¼Œä¾‹å¦‚åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­é™åˆ¶æŸäº›å±æ€§çš„ç±»å‹ã€‚æœ‰æ—¶è¢«ç§°ä¸ºâ€œé¸­å­ç±»å‹â€ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;å½“çœ‹åˆ°ä¸€åªé¸Ÿèµ°èµ·æ¥åƒé¸­å­ã€æ¸¸æ³³èµ·æ¥åƒé¸­å­ã€å«èµ·æ¥ä¹Ÿåƒé¸­å­ï¼Œé‚£ä¹ˆè¿™åªé¸Ÿå°±å¯ä»¥è¢«ç§°ä¸ºé¸­å­ã€‚&amp;rdquo;
åœ¨é¸­å­ç±»å‹ä¸­ï¼Œå…³æ³¨çš„ä¸æ˜¯å¯¹è±¡çš„ç±»å‹æœ¬èº«ï¼Œè€Œæ˜¯å®ƒæ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;interface ITest {
  a: number;
  b: string;
}

const test: ITest = {
  a: 1,
  b: &amp;quot;123&amp;quot;
};
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Interface å’Œ class çš„åŒºåˆ«:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Interface å’Œ class åœ¨ TypeScript ä¸­éƒ½å¯ä»¥å»æè¿°ä¸€ä¸ªé™åˆ¶ï¼Œä¸ PHPã€Java ä¸­çš„ interfaceã€class ä¸€æ ·ï¼ŒTypeScript ä¸­çš„ interface åªåšå£°æ˜ä¸åšå®ç°ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæŠŠä¸Šé¢çš„ interface å£°æ˜æ¢æˆ classï¼Œtslint ä¸ä¼šæŠ¥é”™ï¼Œä»£ç å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œä½†æ˜¯äºŒè€…ç¼–è¯‘å‡ºæ¥çš„ JavaScript ä¸åŒã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;// ä½¿ç”¨ interface ç¼–è¯‘åçš„ä»£ç 
var test = {
  a: 1,
  b: &amp;quot;123&amp;quot;
};

// ä½¿ç”¨ class ç¼–è¯‘åçš„ä»£ç 
var ITest = /** @class */ (function() {
  function ITest() {}
  return ITest;
})();
var test = {
  a: 1,
  b: &amp;quot;123&amp;quot;
};
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;class å¯ä»¥ä½¿ç”¨ implements å…³é”®å­—æ¥å®ç° interfaceã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ç±»å‹åˆ«å&#34;&gt;ç±»å‹åˆ«å&lt;/h3&gt;

&lt;p&gt;TypeScript ä¸­å…è®¸ä½¿ç”¨ type å…³é”®å­—æ¥å£°æ˜ç±»å‹åˆ«åã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;type State = {
  a: string;
  b: Array&amp;lt;number&amp;gt;;
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç±»å‹åˆ«åå’Œ interface é€šå¸¸å…·æœ‰åŒæ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç±»å‹åˆ«åä¸èƒ½è¢« &lt;code&gt;extends&lt;/code&gt; æˆ–è€… &lt;code&gt;implements&lt;/code&gt;ï¼Œä¹Ÿä¸èƒ½ &lt;code&gt;extends&lt;/code&gt; æˆ–è€… &lt;code&gt;implements&lt;/code&gt; å…¶ä»–ç±»å‹ã€‚å¹¶ä¸”ç±»å‹åˆ«ååœ¨ç¼–è¯‘å™¨ä¸­æ˜¾ç¤ºçš„æ˜¯ Object å­—é¢é‡ç±»å‹ï¼Œè€Œ interface æ˜¾ç¤ºæ˜¯ interfaceã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Because &lt;a href=&#34;https://en.wikipedia.org/wiki/Open%E2%80%93closed_principle&#34;&gt;an ideal property of software is being open to extension&lt;/a&gt;, you should always use an interface over a type alias if possible.
ã€è½¯ä»¶ä¸­çš„å¯¹è±¡åº”è¯¥å¯¹äºæ‰©å±•æ˜¯å¼€æ”¾çš„ï¼Œä½†æ˜¯å¯¹äºä¿®æ”¹æ˜¯å°é—­çš„ã€‘&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;æ³›å‹&#34;&gt;æ³›å‹&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;function identity(arg: any): any {
  return arg;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“æˆ‘ä»¬åœ¨å†™è¿™æ ·ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå‚æ•°å’Œè¿”å›å€¼éƒ½å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œä½†å®é™…ä¸Šè¿™æ ·æˆ‘ä»¬å°±ä¸¢å¤±äº†å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ä¿¡æ¯ï¼ˆå®é™…ä¸Šè¾“å…¥å’Œè¾“å‡ºåº”è¯¥æ˜¯ç›¸åŒçš„ç±»å‹ï¼‰ã€‚
è¿™æ—¶æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç±»å‹å˜é‡ Tï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;function identity&amp;lt;T&amp;gt;(arg: T): T {
  return arg;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·ä¿è¯äº†å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹éƒ½æ˜¯ Tã€‚
æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼ä½¿ç”¨è¿™ä¸ªæ³›å‹å‡½æ•°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;let output = identity&amp;lt;string&amp;gt;(&amp;quot;myString&amp;quot;); // type of output will be &#39;string&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;æ˜ å°„ç±»å‹&#34;&gt;æ˜ å°„ç±»å‹&lt;/h3&gt;

&lt;p&gt;æ˜ å°„ç±»å‹åŒ…æ‹¬ Partial å’Œ Readonlyï¼Œå®ƒä»¬å¯ä»¥åœ¨åŸæœ‰ interface çš„åŸºç¡€ä¸Šåˆ†åˆ«æ˜ å°„å‡ºæ‰€æœ‰å±æ€§éƒ½æ˜¯å¯é€‰ç±»å‹ï¼Œå’Œæ‰€æœ‰å±æ€§éƒ½æ˜¯åªè¯»çš„æ–°çš„ typeã€‚è¿™ä¸¤ç§æ˜ å°„ç±»å‹å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;type Readonly&amp;lt;T&amp;gt; = { readonly [P in keyof T]: T[P] };
type Partial&amp;lt;T&amp;gt; = { [P in keyof T]?: T[P] };
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;åœ¨-react-ä¸­ä½¿ç”¨-typescript&#34;&gt;åœ¨ React ä¸­ä½¿ç”¨ TypeScript&lt;/h2&gt;

&lt;h3 id=&#34;åˆ›å»ºä¸€ä¸ª-react-typescript-çš„é¡¹ç›®&#34;&gt;åˆ›å»ºä¸€ä¸ª React + TypeScript çš„é¡¹ç›®&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;create-react-app
é€šè¿‡ create-react-app æ¥æ­å»ºï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å‘½ä»¤ä¸­åŠ å…¥é¢å¤–å‚æ•°å³å¯ï¼š
&lt;code&gt;create-react-app my-app --scripts-version=react-scripts-ts&lt;/code&gt;
æ­å»ºå‡ºæ¥çš„é¡¹ç›®ç»“æ„ä¸ JavaScript ç‰ˆæœ¬åŸºæœ¬ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºæ ¹ç›®å½•æœ‰&lt;code&gt;tsconfig.json&lt;/code&gt;ã€&lt;code&gt;tslint.json&lt;/code&gt; ç­‰ TypeScript ç›¸å…³çš„æ–‡ä»¶ã€‚&lt;code&gt;tsconfig.json&lt;/code&gt; ç”¨äºå‘Šè¯‰ &lt;code&gt;ts-loader&lt;/code&gt; å¦‚ä½•ç¼–è¯‘ .ts æ–‡ä»¶ï¼Œè€Œ &lt;code&gt;tslint.json&lt;/code&gt; åˆ™æ˜¯ tslint (TypeScript è¯­æ³•æ£€æŸ¥å™¨) çš„é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;æ‰‹åŠ¨å®‰è£…
æ‰‹åŠ¨å®‰è£…éœ€è¦é€šè¿‡ npm æˆ–è€… yarn å®‰è£… &lt;code&gt;typescript&lt;/code&gt; å’Œ &lt;code&gt;ts-loader&lt;/code&gt; ç­‰ TypeScript ç›¸å…³çš„ packageï¼ŒåŒæ—¶éœ€è¦æ‰‹åŠ¨é…ç½® &lt;code&gt;tsconfig.json&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;definitelytyped-d-ts&#34;&gt;DefinitelyTyped - *.d.ts&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/DefinitelyTyped/DefinitelyTyped&#34;&gt;GitHub - DefinitelyTyped/DefinitelyTyped: The repository for high quality TypeScript type definitions.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;TypeScript çš„æ¨¡å—å‘å¸ƒçš„æ—¶å€™éƒ½æ˜¯æ‰“åŒ…æˆ JavaScript æ¥å‘å¸ƒçš„ï¼Œä½†æ˜¯è¿™æ ·ä¼šä¸¢å¤±å®šä¹‰å¥½çš„æ•°æ®ç±»å‹ã€‚ .d.ts å¯ä»¥çº¦å®š type, class, interface, function, å˜é‡ä»¥åŠå¸¸é‡ç­‰çš„è¡Œä¸ºï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ª package æˆ–è€… library çš„â€œè¯´æ˜ä¹¦â€ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ React ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šéœ€è¦å®‰è£…ä¸€äº›å¦‚ &lt;code&gt;@types/react-router-dom&lt;/code&gt; è¿™ç§ä»¥ &lt;code&gt;@types&lt;/code&gt; ä½œä¸ºå¼€å¤´çš„ packageã€‚åœ¨ JS ä¸­æˆ‘ä»¬ç›´æ¥ &lt;code&gt;npm install react-router-dom&lt;/code&gt; å³å¯ï¼Œä½†æ˜¯åœ¨ TypeScript ä¸­ï¼Œå¦‚æœæ²¡æœ‰ DefinitelyTypedï¼Œå°†ä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯ï¼š
&lt;img src=&#34;https://elizurhz.cn/images/typescript-for-jser/types-error.png&#34; alt=&#34;@types-error&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å½“ç„¶å¹¶ä¸æ˜¯æ‰€æœ‰çš„ package éƒ½éœ€è¦ä¸€ä¸ªå¯¹åº”çš„ &lt;code&gt;@types&lt;/code&gt; ï¼Œä¸å°‘ package è‡ªèº«å·²ç»æœ‰ .d.ts æ–‡ä»¶äº†ï¼Œä¾‹å¦‚ antdï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦é¢å¤–çš„ &lt;code&gt;@types&lt;/code&gt; ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ— çŠ¶æ€ç»„ä»¶&#34;&gt;æ— çŠ¶æ€ç»„ä»¶&lt;/h3&gt;

&lt;p&gt;åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰å¦‚ä¸‹çš„æ–¹å¼å†™ä¸€ä¸ª Stateless Functional Component ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;import React from &amp;quot;react&amp;quot;;
const Button = ({ onClick, children }) =&amp;gt; (
  &amp;lt;button onClick={handleClick}&amp;gt;{children}&amp;lt;/button&amp;gt;
);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½†æ˜¯åœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åŠ å…¥ç±»å‹ï¼Œæ‰€ä»¥å…·ä½“æ€ä¹ˆåŠ å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code&gt;@types/react&lt;/code&gt; ä¸­çš„ &lt;code&gt;index.d.ts&lt;/code&gt;æ¥è¿›è¡Œåˆ†æï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šä»¥ä¸‹ä»£ç éƒ½å»é™¤äº†å¤§æ®µçš„æ³¨é‡Šï¼Œè‹¥éœ€è¦æŸ¥çœ‹å®˜æ–¹çš„æ³¨é‡Šè¯·è‡³ &lt;code&gt;npm install&lt;/code&gt; åä¸‹è½½çš„ &lt;code&gt;./node_modules/@types/react&lt;/code&gt; ä¸­æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;type SFC&amp;lt;P = {}&amp;gt; = StatelessComponent&amp;lt;P&amp;gt;;
interface StatelessComponent&amp;lt;P = {}&amp;gt; {
  (props: P &amp;amp; { children?: ReactNode }, context?: any): ReactElement&amp;lt;
    any
  &amp;gt; | null;
  propTypes?: ValidationMap&amp;lt;P&amp;gt;;
  contextTypes?: ValidationMap&amp;lt;any&amp;gt;;
  defaultProps?: Partial&amp;lt;P&amp;gt;;
  displayName?: string;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»è¿™æ®µä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œprops æ˜¯ P å’Œ ä¸€ä¸ªå¯¹è±¡çš„è”åˆç±»å‹ï¼ŒP æŒ‡çš„æ˜¯æˆ‘ä»¬é€šå¸¸ä¼ å…¥çš„ propsï¼Œè€Œå¯¹è±¡ä¸­çš„ children å°±æ˜¯ React ä¸­çš„ childrenï¼Œæ˜¯å¯é€‰ç±»å‹ï¼Œtype æ˜¯ ReactNodeï¼Œæ˜¯ React ä¸­çš„ç±»å‹ã€‚å¦å¤–åœ¨ React çš„ &lt;code&gt;index.d.ts&lt;/code&gt;ä¸­ï¼Œå¯¹äºäº‹ä»¶æœ‰ä¸“é—¨çš„ç±»å‹å®šä¹‰ &lt;code&gt;MouseEvent&lt;/code&gt;ï¼ˆåŒæ—¶ä¹Ÿæœ‰å…¶ä»– Event çš„ç±»å‹å®šä¹‰ï¼‰ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;interface MouseEvent&amp;lt;T = Element&amp;gt; extends SyntheticEvent&amp;lt;T&amp;gt; {
  altKey: boolean;
  button: number;
  buttons: number;
  clientX: number;
  clientY: number;
  ctrlKey: boolean;
  getModifierState(key: string): boolean;
  metaKey: boolean;
  nativeEvent: NativeMouseEvent;
  pageX: number;
  pageY: number;
  relatedTarget: EventTarget;
  screenX: number;
  screenY: number;
  shiftKey: boolean;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰€ä»¥é’ˆå¯¹ä¸Šé¢çš„ JavaScript ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰å¦‚ä¸‹çš„æ–¹å¼å†™å‡ºç›¸åº”çš„ TypeScript ä»£ç ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;import React, { MouseEvent, ReactNode } from &amp;quot;react&amp;quot;;
interface IProps {
  onClick(e: MouseEvent&amp;lt;HTMLElement&amp;gt;): void;
  children?: ReactNode;
}
const Button = ({ onClick: handleClick, children }: IProps) =&amp;gt; (
  &amp;lt;button onClick={handleClick}&amp;gt;{children}&amp;lt;/button&amp;gt;
);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å…¶ä¸­ &lt;code&gt;HTMLElement&lt;/code&gt; è¢«å®šä¹‰åœ¨&lt;code&gt;@types/react&lt;/code&gt; ä¸­çš„&lt;code&gt;global.d.ts&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;interface Element {}
interface HTMLElement extends Element {}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;æœ‰çŠ¶æ€ç»„ä»¶&#34;&gt;æœ‰çŠ¶æ€ç»„ä»¶&lt;/h3&gt;

&lt;p&gt;æ— çŠ¶æ€ç»„ä»¶å…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåªéœ€è¦æŒ‰ç…§å‡½æ•°çš„å†™æ³•æ¥å®ç°å³å¯ã€‚è€Œå¯¹äºæœ‰çŠ¶æ€ç»„ä»¶ï¼Œè¿™è¾¹æœ‰ä¸€ä¸ªè®¡æ•°å™¨çš„ä¾‹å­ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;import React, { Component } from &amp;quot;react&amp;quot;;

import Button from &amp;quot;./Button&amp;quot;; // è¿™é‡Œçš„ Button æ˜¯ä¸Šé¢ SFC éƒ¨åˆ†çš„ Button ç»„ä»¶

const initialState = { clicksCount: 0 };
type State = Readonly&amp;lt;typeof initialState&amp;gt;;

class ButtonCounter extends Component&amp;lt;object, State&amp;gt; {
  readonly state: State = initialState;

  public render() {
    const { clicksCount } = this.state;
    return (
      &amp;lt;&amp;gt;
        &amp;lt;Button onClick={this.handleIncrement}&amp;gt;Increment&amp;lt;/Button&amp;gt;
        &amp;lt;Button onClick={this.handleDecrement}&amp;gt;Decrement&amp;lt;/Button&amp;gt;
        You&#39;ve clicked me {clicksCount} times!
      &amp;lt;/&amp;gt;
    );
  }

  private handleIncrement = () =&amp;gt; this.setState(incrementClicksCount);
  private handleDecrement = () =&amp;gt; this.setState(decrementClicksCount);
}

const incrementClicksCount = (prevState: State) =&amp;gt; ({
  clicksCount: prevState.clicksCount + 1
});
const decrementClicksCount = (prevState: State) =&amp;gt; ({
  clicksCount: prevState.clicksCount - 1
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è‹¥è¦è¯»æ‡‚è¿™æ®µä»£ç ï¼Œå¯ä»¥ä»&lt;code&gt;@types/react&lt;/code&gt; ä¸­çš„ &lt;code&gt;index.d.ts&lt;/code&gt;è¯´èµ·ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šä»¥ä¸‹ä»£ç éƒ½å»é™¤äº†å¤§æ®µçš„æ³¨é‡Šï¼Œè‹¥éœ€è¦æŸ¥çœ‹å®˜æ–¹çš„æ³¨é‡Šè¯·è‡³ &lt;code&gt;npm install&lt;/code&gt; åä¸‹è½½çš„ &lt;code&gt;./node_modules/@types/react&lt;/code&gt; ä¸­æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;interface Component&amp;lt;P = {}, S = {}, SS = any&amp;gt;
  extends ComponentLifecycle&amp;lt;P, S, SS&amp;gt; {}

class PureComponent&amp;lt;P = {}, S = {}, SS = any&amp;gt; extends Component&amp;lt;P, S, SS&amp;gt; {}

class Component&amp;lt;P, S&amp;gt; {
  constructor(props: Readonly&amp;lt;P&amp;gt;);
  setState&amp;lt;K extends keyof S&amp;gt;(
    state:
      | ((prevState: Readonly&amp;lt;S&amp;gt;, props: Readonly&amp;lt;P&amp;gt;) =&amp;gt; Pick&amp;lt;S, K&amp;gt; | S | null)
      | (Pick&amp;lt;S, K&amp;gt; | S | null),
    callback?: () =&amp;gt; void
  ): void;

  forceUpdate(callBack?: () =&amp;gt; void): void;
  render(): ReactNode;
  readonly props: Readonly&amp;lt;{ children?: ReactNode }&amp;gt; &amp;amp; Readonly&amp;lt;P&amp;gt;;
  state: Readonly&amp;lt;S&amp;gt;;
  context: any;
  refs: {
    [key: string]: ReactInstance;
  };
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬å¸¸ç”¨çš„ Component ç±»å°±æ˜¯åœ¨è¿™é‡Œè¢«å®šä¹‰çš„ï¼Œå…¶ä¸­ P ä»£è¡¨ propsï¼ŒS ä»£è¡¨ stateã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œprops å’Œ state éƒ½ä½¿ç”¨äº† readonly æˆ–è€…æ˜¯ä½¿ç”¨äº† Mapped types ä¸­çš„ Readonlyã€‚
è€Œ Component çš„ Interface ç»§æ‰¿äº† ComponentLifecycle çš„ Interfaceï¼Œæºç å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;interface &amp;lt;P, S, SS = any&amp;gt; extends NewLifecycle&amp;lt;P, S, SS&amp;gt;, DeprecatedLifecycle&amp;lt;P, S&amp;gt; {
	componentDidMount?(): void;
	shouldComponentUpdate?(nextProps: Readonly&amp;lt;P&amp;gt;, nextState: Readonly&amp;lt;S&amp;gt;, nextContext: any): boolean;
	componentWillUnmount?(): void;
	componentDidCatch?(error: Error, errorInfo: ErrorInfo): void;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ComponentLifecycle çš„ Interface å®šä¹‰äº†ä¸€äº›å¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„ç±»å‹å¦‚ componentDidMountã€shouldComponentUpdateã€componentWillUnmount å’Œ componentDidCatchã€‚ComponentLifecycle åŒæ ·ç»§æ‰¿äº† NewLifecycle å’Œ DeprecatedLifecycle ä¸¤ä¸ªæ¥å£ï¼Œä»£ç åˆ†åˆ«å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;interface NewLifecycle&amp;lt;P, S, SS&amp;gt; {
  getSnapshotBeforeUpdate?(
    prevProps: Readonly&amp;lt;P&amp;gt;,
    prevState: Readonly&amp;lt;S&amp;gt;
  ): SS | null;
  componentDidUpdate?(
    prevProps: Readonly&amp;lt;P&amp;gt;,
    prevState: Readonly&amp;lt;S&amp;gt;,
    snapshot?: SS
  ): void;
}

interface DeprecatedLifecycle&amp;lt;P, S&amp;gt; {
  componentWillMount?(): void;
  UNSAFE_componentWillMount?(): void;
  componentWillReceiveProps?(nextProps: Readonly&amp;lt;P&amp;gt;, nextContext: any): void;
  UNSAFE_componentWillReceiveProps?(
    nextProps: Readonly&amp;lt;P&amp;gt;,
    nextContext: any
  ): void;
  componentWillUpdate?(
    nextProps: Readonly&amp;lt;P&amp;gt;,
    nextState: Readonly&amp;lt;S&amp;gt;,
    nextContext: any
  ): void;
  UNSAFE_componentWillUpdate?(
    nextProps: Readonly&amp;lt;P&amp;gt;,
    nextState: Readonly&amp;lt;S&amp;gt;,
    nextContext: any
  ): void;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;NewLifecycle æ˜¯ React 16.3 æ–°å¢çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œè€Œ DeprecatedLifecycle åˆ™æ˜¯ React 16.3 ä¹‹å‰å¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå³å°†åœ¨æœªæ¥ç‰ˆæœ¬è¢«åºŸå¼ƒã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒReact çš„ Class ç»§æ‰¿äº &lt;code&gt;class Component&amp;lt;P, S&amp;gt;&lt;/code&gt;ï¼Œè€Œ &lt;code&gt;class Component&amp;lt;P, S&amp;gt;&lt;/code&gt; æ˜¯æ³›å‹ &lt;code&gt;interface Component&amp;lt;P = {}, S = {}, SS = any&amp;gt;&lt;/code&gt; çš„å®ç°ã€‚å…¶ä¸­ P æ˜¯ props çš„ç±»å‹ï¼ŒS æ˜¯ state çš„ç±»å‹ï¼Œå®ƒä»¬éƒ½æ˜¯ object ç±»å‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å› æ­¤ï¼ŒTypeScript çš„æœ‰çŠ¶æ€ç»„ä»¶å¤§è‡´å¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤æ¥ç¼–å†™æˆ–è€…é˜…è¯»ï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è®¾ç½® initialStateï¼Œå¹¶æ ¹æ® initialState æ¥è®¾å®š State ç±»å‹æˆ–è€… State çš„ interfaceï¼š&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-typescript&#34;&gt;const initialState = { clicksCount: 0 };
type State = Readonly&amp;lt;typeof initialState&amp;gt;;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ type æˆ–è€… interface è®¾å®š props ç±»å‹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;class Example extends Component&amp;lt;P, S&amp;gt;&lt;/code&gt; è¿™é‡Œéœ€è¦æŒ‡å®š props å’Œ state çš„ç±»å‹ P å’Œ S&lt;/li&gt;
&lt;li&gt;&lt;code&gt;readonly state: State = initialState;&lt;/code&gt; è¿™é‡Œå»ºè®®å°† state è®¾ç½®ä¸º readonly ç±»å‹ï¼Œé˜²æ­¢ state è¢«ç›´æ¥ä¿®æ”¹&lt;/li&gt;
&lt;li&gt;ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¯ä»¥ä½¿ç”¨ public æ¥ä¿®é¥°ï¼ˆtslint è¦æ±‚ class å†…éƒ¨æ–¹æ³•å¿…é¡»åŠ å…¥ public æˆ–è€… private æ¥ä¿®é¥°ï¼‰&lt;/li&gt;
&lt;li&gt;å†…éƒ¨æ–¹æ³•å¯ä»¥ä½¿ç”¨ private æ¥ä¿®é¥°ä»¥ä¿æŠ¤å…¶å®‰å…¨æ€§&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å°-tips&#34;&gt;å° Tips&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;ä»ä¸Šé¢çš„ d.ts æ–‡ä»¶çš„åˆ†æå¯ä»¥å¾—çŸ¥ï¼Œ &lt;code&gt;setState()&lt;/code&gt; çš„å…·ä½“é€»è¾‘æ˜¯å¯ä»¥è¢«æå–åˆ°ç»„ä»¶å¤–éƒ¨çš„ï¼Œè¿™æ ·åšçš„ä¼˜ç‚¹æ˜¯å¯ä»¥å°†æ“ä½œ state çš„æ–¹æ³•å‰¥ç¦»å‡ºæ¥ç»´æŠ¤ï¼Œä¸éœ€è¦äº†è§£æ¸²æŸ“é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ä½¿ç”¨ mock æ•°æ®è°ƒè¯•ç»„ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¤šç”¨ any ç±»å‹æ¥èŠ‚çº¦ React ç»„ä»¶è°ƒè¯•æ—¶é—´æˆæœ¬ï¼Œç›´è‡³æ•°æ®ç»“æ„å®Œå…¨ç¡®å®šåï¼Œå†ç¼–å†™å®Œæ•´çš„æ•°æ®éªŒè¯æµç¨‹&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ æƒ³ä½¿ç”¨ä¸€ä¸ª package ä½†æ˜¯é‡åˆ°äº†æ‰¾ä¸åˆ° @types ç›¸å…³ package çš„æŠ¥é”™ï¼Œå¯ä»¥åˆ° Microsoft çš„ &lt;a href=&#34;https://microsoft.github.io/TypeSearch/&#34;&gt;TypeScript Types Search&lt;/a&gt; æŸ¥è¯¢éœ€è¦ &lt;code&gt;npm install&lt;/code&gt; ä»€ä¹ˆ package&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;reference&#34;&gt;Reference&lt;/h2&gt;

&lt;h3 id=&#34;typescript-å®˜æ–¹æ–‡æ¡£&#34;&gt;TypeScript å®˜æ–¹æ–‡æ¡£&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.typescriptlang.org/&#34;&gt;è‹±æ–‡ç‰ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.tslang.cn/&#34;&gt;ä¸­æ–‡ç‰ˆ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ultimate-react-component-patterns-with-typescript-2-8&#34;&gt;Ultimate React Component Patterns with Typescript 2.8&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://levelup.gitconnected.com/ultimate-react-component-patterns-with-typescript-2-8-82990c516935&#34;&gt;è‹±æ–‡åŸç‰ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://juejin.im/post/5b07caf16fb9a07aa83f2977&#34;&gt;èš‚èšé‡‘æœæŠ€æœ¯å›¢é˜Ÿç¿»è¯‘ç‰ˆ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>mpvue å°ç¨‹åºå¼€å‘è¸©å‘è®°</title>
      <link>https://elizurhz.cn/frontend/mpvue-wx-mini-app-first-look/</link>
      <pubDate>Sun, 24 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://elizurhz.cn/frontend/mpvue-wx-mini-app-first-look/</guid>
      <description>

&lt;h1 id=&#34;mpvue-å°ç¨‹åºå¼€å‘è¸©å‘è®°&#34;&gt;mpvue å°ç¨‹åºå¼€å‘è¸©å‘è®°&lt;/h1&gt;

&lt;p&gt;ä¹‹å‰å…¬å¸å†³å®šå¼€å‘ä¸€æ¬¾å°ç¨‹åºã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘æ¥è§¦å¾®ä¿¡å°ç¨‹åºä¹Ÿå°±ä¸€ä¸¤ä¸ªæœˆçš„æ—¶é—´ï¼Œæ²¡ä½¿ç”¨è¿‡å°ç¨‹åºå®˜æ–¹çš„å¼€å‘è¯­è¨€ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ mpvue ä¸Šæ‰‹äº†ï¼Œè‡ªå·±å¼€å‘äº†ä¸€ä¸ªå› ä¸ºå†…å®¹çš„åŸå› æ— æ³•ä¸Šæ¶çš„ DEMOã€‚æ­£å¥½ä¹Ÿè¢«æ¨ä¸Šäº†å‰ç«¯éƒ¨é—¨çš„ leaderï¼Œæ‰€ä»¥ä¹Ÿå°±æ¥ä¸‹äº†è¿™ä¸ªä»»åŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ mpvue çš„å› ä¸ºæœ¬ä»¥ä¸ºç”± Vue è½¬å°ç¨‹åºç”¨ mpvue ä¼šæ–¹ä¾¿ï¼Œä¸è¿‡æ²¡æƒ³åˆ°å‘æŒºå¤šçš„ï¼Œä¸€èˆ¬çš„ Web å¼€å‘è€…å¦‚æœä»¥ Vue çš„æ€ç»´å…¥æ‰‹ä¼šé‡åˆ°å¾ˆå¤šéº»çƒ¦ï¼Œå› ä¸ºå°ç¨‹åºçš„è¿è¡Œç¯å¢ƒå’Œæµè§ˆå™¨å®Œå…¨ä¸åŒã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–äº¬ä¸œå‡¹å‡¸å®éªŒå®¤çš„ Taro ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ¡†æ¶ï¼Œä¸è¿‡æˆ‘æ²¡æœ‰å»æ·±å…¥ç ”ç©¶å®ƒã€‚è€ƒè™‘åˆ°å…¬å¸æŠ€æœ¯æ ˆè½¬ Vue çš„è¦æ±‚ï¼Œæˆ‘ä»¬å›¢é˜Ÿé€‰æ‹©äº† mpvueï¼Œç„¶è€Œæˆ‘ä¸ªäººè®¤ä¸º mpvue è¿˜æ˜¯ä¸ªä¸å¤ªæˆç†Ÿçš„æ¡†æ¶ï¼Œæ–‡æ¡£ä¸å®Œå–„ï¼Œåœ¨å¼€å‘ç¼–è¯‘æ—¶ä¹Ÿå®¹æ˜“å‡º bugï¼Œå¦å¤–å°±æ˜¯åˆ†åŒ…åŠ è½½çš„æ”¯æŒæ¯”è¾ƒæ…¢ï¼Œå¥½åœ¨æœ€è¿‘å‡ºäº†æ–°ç‰ˆæœ¬çš„ mpvue-loaderã€‚ä½†æ˜¯æ–°ç‰ˆæœ¬çš„ mpvue-loader å®Œå…¨æ›´æ”¹äº† app.json/main.json æ–‡ä»¶çš„å†™æ³•ï¼Œæ–‡æ¡£ä¸­ä¹Ÿæ²¡æœ‰æ˜ç¡®æåˆ°ï¼Œåªèƒ½é€šè¿‡æ–°çš„ quickstart æ¥äº†è§£æ–°çš„å†™æ³•ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æˆ‘å¯¹å°ç¨‹åºå’Œ-mpvue-çš„ç†è§£&#34;&gt;æˆ‘å¯¹å°ç¨‹åºå’Œ mpvue çš„ç†è§£&lt;/h2&gt;

&lt;h3 id=&#34;mpvue&#34;&gt;mpvue&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;mpvue æ˜¯ç¾å›¢å¼€å‘çš„ï¼Œå…è®¸å¼€å‘è€…ä½¿ç”¨ Vue è¯­æ³•æ¥ç¼–å†™å°ç¨‹åºçš„æ¡†æ¶ã€‚&lt;/li&gt;
&lt;li&gt;å°ç¨‹åºå’Œ Web åº”ç”¨çš„ä¸åŒä¹‹å¤„æ˜¯å®ƒä¾é å¾®ä¿¡ App å†…çš„ JavaScript å¼•æ“å’Œ WXML/WXSS å¼•æ“è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥ä¸ Web ç«¯ç›¸æ¯”ï¼Œå°ç¨‹åºé‡Œä¸å­˜åœ¨ DOMï¼Œæ— æ³•ä½¿ç”¨åŸç”Ÿ DOM çš„æ“ä½œï¼Œä¹Ÿä¸å­˜åœ¨æµè§ˆå™¨çš„å„ç§ APIã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ä½¿ç”¨ mpvue æ—¶ï¼Œå®é™…ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ç”¨ Vue æ„å»ºå¤šé¡µ Web Appã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ Webpack æ‰“åŒ…æ—¶ï¼ŒVue Web App æ˜¯æœ€ç»ˆæ‰“åŒ…æˆ index.html ä»¥åŠ css å’Œ js æ–‡ä»¶å„ 1 ä¸ªï¼ˆå¦‚æœä½ ä¸å¼€ source map çš„è¯ï¼‰ã€‚è€Œ mpvue-loader æ˜¯å°† Vue è¯­æ³•è½¬æ¢æˆå°ç¨‹åºåŸç”Ÿè¯­æ³•çš„ Webpack loaderï¼Œæ‰“åŒ…åçš„æ–‡ä»¶å®é™…ä¸Šå°±æ˜¯åŸç”Ÿå°ç¨‹åºçš„è¯­æ³•ï¼ˆjs é™¤å¤–ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å°ç¨‹åºå¼€å‘å·¥å…·ä¸­é¢„è§ˆå’Œ debugã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;weui&#34;&gt;weui&lt;/h3&gt;

&lt;p&gt;weui æ˜¯è…¾è®¯å¼€å‘çš„ css æ¡†æ¶ï¼Œå¯ä»¥ç”¨äºç¼–å†™è…¾è®¯è§„èŒƒçš„å°ç¨‹åºæ§ä»¶ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å°ç¨‹åºå¼€å‘å·¥å…·-å¾®ä¿¡å…¬ä¼—å¹³å°-å°ç¨‹åº&#34;&gt;å°ç¨‹åºå¼€å‘å·¥å…·/å¾®ä¿¡å…¬ä¼—å¹³å° - å°ç¨‹åº&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;å°ç¨‹åºå¼€å‘å·¥å…·æ˜¯ç”¨äºæœ¬åœ° debug çš„å·¥å…·ï¼Œä½¿ç”¨äº† Chrome Devtoolsï¼Œå¹¶å¯ä»¥è¿›è¡ŒçœŸæœºè°ƒè¯•ä»¥åŠå‘å¸ƒä½“éªŒç‰ˆ

&lt;ul&gt;
&lt;li&gt;çœŸæœºè°ƒè¯•ï¼šä½¿ç”¨å°ç¨‹åºä¸Šçš„â€œè¿œç¨‹è°ƒè¯•â€æŒ‰é’®å³å¯è°ƒè¯•ï¼Œåœ¨å¼€å‘è€…çš„å¾®ä¿¡ä¸­çš„å°ç¨‹åºåˆ—è¡¨ä¸­æ˜¾ç¤ºä¸ºâ€œå¼€å‘ç‰ˆâ€&lt;/li&gt;
&lt;li&gt;ä½“éªŒç‰ˆï¼šä½¿ç”¨å°ç¨‹åºä¸Šçš„â€œä¸Šä¼ â€æŒ‰é’®å³å¯å‘å¸ƒä½“éªŒç‰ˆï¼Œå¼€å‘è€…å’Œä½“éªŒè€…æ‰«ç åå¯ä»¥è®¿é—®ï¼Œåœ¨å¼€å‘è€…å’Œä½“éªŒè€…çš„å¾®ä¿¡ä¸­çš„å°ç¨‹åºåˆ—è¡¨ä¸­æ˜¾ç¤ºä¸ºâ€œä½“éªŒç‰ˆâ€&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;å¾®ä¿¡å…¬ä¼—å¹³å° - å°ç¨‹åº æ˜¯å°ç¨‹åºé¡¹ç›®çš„ç®¡ç†åå°

&lt;ul&gt;
&lt;li&gt;å°ç¨‹åºå’Œå…¬ä¼—å·æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„è´¦å·ï¼Œå¯ä»¥ç›¸äº’å…³è”&lt;/li&gt;
&lt;li&gt;å¦‚æœè¦å›¢é˜Ÿåä½œå¼€å‘ï¼Œå¿…é¡»è¦åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°ä¸Šæ·»åŠ å¼€å‘è€…å’Œä½“éªŒè€…&lt;/li&gt;
&lt;li&gt;è‹¥éœ€è¦ä½¿ç”¨ç½‘ç»œè¯·æ±‚ï¼Œå¿…é¡»åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°ä¸Šæ·»åŠ  https çš„æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;https æœåŠ¡å™¨çš„ URL å¯ä»¥æ˜¯äºŒçº§ã€ä¸‰çº§&amp;hellip;åŸŸåï¼Œä½†ä¸èƒ½å¸¦ç›¸å¯¹è·¯å¾„ï¼Œä¾‹å¦‚å¯ä»¥æ˜¯ api.test.example.cn æˆ–è€… api.example.cnï¼Œä½†ä¸èƒ½ä½¿ç”¨ api.example.com/v1&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å¾®ä¿¡æ”¯ä»˜&#34;&gt;å¾®ä¿¡æ”¯ä»˜&lt;/h2&gt;

&lt;p&gt;å¾®ä¿¡æ”¯ä»˜éœ€è¦å°ç¨‹åºä¸Šçº¿ä¹‹ååœ¨å¾®ä¿¡å…¬ä¼—å¹³å°ä¸­ç”³è¯·å¼€é€šã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_7&amp;amp;index=3&#34;&gt;ã€å¾®ä¿¡æ”¯ä»˜ã€‘å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜å¼€å‘è€…æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;è·å– openid&lt;/li&gt;
&lt;li&gt;è¯·æ±‚æ”¯ä»˜æ¥å£è·å– &lt;code&gt;wx.requestPayment()&lt;/code&gt; æ‰€éœ€å‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;wx.requestPayment()&lt;/code&gt; å‘èµ·æ”¯ä»˜è¯·æ±‚ï¼Œå‚æ•°è§&lt;a href=&#34;https://developers.weixin.qq.com/miniprogram/dev/api/api-pay.html#wxrequestpaymentobject&#34;&gt;å¾®ä¿¡æ”¯ä»˜ Â· å°ç¨‹åº&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœåœ¨æ‰‹æœºä¸Šæ“ä½œä¼šç›´æ¥å¼¹å‡ºå¾®ä¿¡æ”¯ä»˜ç›¸å…³å¼¹çª—ï¼Œåœ¨å¼€å‘è€…å·¥å…·ä¸­æ“ä½œåˆ™ä¼šç”ŸæˆäºŒç»´ç ï¼Œæ‰«æå³å¯ï¼›åœ¨æ‰‹æœºä¸Šå¯ä»¥ç›´æ¥å¼¹å‡ºå¾®ä¿¡æ”¯ä»˜çš„å¼¹çª—ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯ä»˜å®Œæˆåä½¿ç”¨ &lt;code&gt;wx.reLaunch&lt;/code&gt; è½¬è·³åˆ°ç»“æœé¡µé¢ï¼Œä½†æ˜¯ä½¿ç”¨ &lt;code&gt;wx.reLaunch&lt;/code&gt; æ—¶ï¼Œåœ¨ Android ä¸Šä¼šæç¤º reLaunch:fail can not invoke reLaunch in backgroundï¼Œæ­¤æ—¶åªéœ€åŠ ä¸€ä¸ª setTimeout å³å¯ã€‚å› ä¸ºè°ƒç”¨å¾®ä¿¡æ”¯ä»˜çš„çª—å£æ—¶ï¼Œå®é™…ä¸Šä¼šå…ˆæŠŠå½“å‰çš„ page éšè—ï¼Œå¦‚æœåœ¨ä½“éªŒç‰ˆé‡Œæ‰“å¼€è°ƒè¯•æ¨¡å¼å¯ä»¥çœ‹åˆ°é¡µé¢å…ˆ onHide å† onShowï¼Œè€Œæˆ‘ä»¬éœ€è¦åœ¨æ”¯ä»˜æˆåŠŸåè½¬è·³ï¼Œæ‰€ä»¥ &lt;code&gt;wx.reLaunch&lt;/code&gt; æ˜¯æ”¾åœ¨ &lt;code&gt;wx.requestPayment()&lt;/code&gt; çš„å›è°ƒä¸­æ‰§è¡Œçš„ï¼Œæ­¤æ—¶é¡µé¢ä»æ²¡æœ‰ onShowï¼Œè€Œ &lt;code&gt;wx.reLaunch&lt;/code&gt; éœ€è¦åœ¨ onShow ä¹‹åæ‰èƒ½è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;mpvue-å°ç¨‹åºå¼€å‘ä¸­éœ€è¦æ³¨æ„çš„ç‚¹&#34;&gt;mpvue å°ç¨‹åºå¼€å‘ä¸­éœ€è¦æ³¨æ„çš„ç‚¹&lt;/h2&gt;

&lt;h3 id=&#34;mpvue-çš„é¡¹ç›®ç»“æ„&#34;&gt;mpvue çš„é¡¹ç›®ç»“æ„&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥åœ¨å®˜æ–¹çš„ quickstart æ¨¡æ¿çš„åŸºç¡€ä¸Šè¿›è¡Œå¼€å‘ã€&lt;a href=&#34;http://mpvue.com/mpvue/quickstart/&#34;&gt;Quickstart - mpvue-docs&lt;/a&gt;ã€‘ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;static - é™æ€æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;src - pages - A - é¡µé¢ A - A.vue - .vue é¡µé¢ - main.js - Vue çš„ js æ–‡ä»¶ï¼Œç”¨äºæŒ‚è½½é¡µé¢ - main.json - å°ç¨‹åºçš„é¡µé¢é…ç½®æ–‡ä»¶ - components - å…¬ç”¨ç»„ä»¶ - utils - å·¥å…· - app.json - å°ç¨‹åºçš„ app.json ä¸»æ–‡ä»¶ - App.vue - å°ç¨‹åºä¸»å…¥å£ - main.js - ç±»ä¼¼ Vue çš„ main.jsï¼ŒåŠ è½½å…¨å±€å†…å®¹ï¼ŒæŒ‚è½½ Vue å®ä¾‹&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;å°ç¨‹åºæœ‰åŒ…å¤§å°çš„é™åˆ¶&#34;&gt;å°ç¨‹åºæœ‰åŒ…å¤§å°çš„é™åˆ¶&lt;/h3&gt;

&lt;p&gt;ä¸»åŒ…æœ€å¤§ä¸º 2MBï¼Œå„ä¸ªåˆ†åŒ…å¤§å°æœ€å¤§ä¸º 8MBã€‚åœ¨è¾ƒå¤§å‹çš„å°ç¨‹åºå¼€å‘æ—¶ï¼Œæœ€å¥½æ˜¯å°†å„ä¸ªæ¨¡å—ç‹¬ç«‹å‡ºæ¥ï¼Œå°½å¯èƒ½åªä¿ç•™å…¥å£é¡µé¢å’Œ Tab æ ‡ç­¾é¡µå¯¹åº”çš„é¡µé¢åœ¨ä¸»åŒ…ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;åˆ†åŒ…åŠ è½½åªæœ‰åœ¨ mpvue-loader@1.1.x ç‰ˆæœ¬æ‰æ”¯æŒã€‚&lt;/p&gt;

&lt;p&gt;ä¼šæ‰“åŒ…åˆ°ä¸»åŒ…çš„å†…å®¹ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºå¦‚ä¸‹å†…å®¹ï¼‰ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;æ”¾åœ¨ app.json ä¸­çš„ pages ä¸­çš„é¡µé¢&lt;/li&gt;
&lt;li&gt;é™æ€æ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡&lt;/li&gt;
&lt;li&gt;å…¬ç”¨ç»„ä»¶&lt;/li&gt;
&lt;li&gt;vuex&lt;/li&gt;
&lt;li&gt;utils&lt;/li&gt;
&lt;li&gt;å®‰è£…çš„å„ç§æœ‰è¢«å¼•ç”¨çš„ package&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æ³¨æ„ï¼šåƒä¸‡ä¸è¦å› ä¸ºæŸä¸ªåŠŸèƒ½ç”¨æŸä¸ª package åšå¾ˆæ–¹ä¾¿ï¼Œå°±å®‰è£…å¹¶å¼•å…¥å®ƒï¼Œå› ä¸ºè¿™äº› package å…¨éƒ¨ä¼šæ‰“åŒ…åˆ°ä¸»åŒ…çš„ vender.js ä¸­ï¼è¿™æ ·å¾ˆå®¹æ˜“é€ æˆä¸»åŒ…å¤§å°è¿‡å¤§ï¼&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸€ä¸ª package æ˜¯ä½ ä¸å¾—ä¸å¼•å…¥çš„æ ¸å¿ƒ packageï¼ˆä¾‹å¦‚ vue, vuex, node-sass, sass-loader ç­‰ï¼‰ï¼Œé‚£ä¹ˆå°±å°†å®ƒå¼•å…¥ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸€ä¸ª package ä½ åªä½¿ç”¨åˆ°å®ƒçš„ 1% çš„åŠŸèƒ½ï¼ˆæˆ–è€…æœ‰éå¸¸å¤šçš„åŠŸèƒ½ç”¨ä¸ä¸Šï¼‰ï¼Œè¯·ä¸è¦å¼•å…¥ï¼ä¾‹å¦‚å®‰è£…äº† qs, moment å’Œ lodash ä¹‹åï¼Œåœ¨æˆ‘ä»¬å…¬å¸çš„é¡¹ç›®ä¸­ï¼Œæ‰“åŒ…åçš„ vender.js æœ€å¤§å¯ä»¥è¾¾åˆ° 1.6MBï¼Œè€Œåœ¨ç§»é™¤å®ƒä»¬æ‰€æœ‰çš„å¼•ç”¨ä¹‹ååªæœ‰ 462 KBã€‚&lt;/p&gt;

&lt;p&gt;JS çš„å¤§å‹å·¥å…·åº“ï¼ˆå¦‚ lodashï¼‰åƒä¸‡ä¸è¦å¼•å…¥ mpvueï¼Œå› ä¸ºå®ƒä»¬å¤§éƒ¨åˆ†éƒ½å¯ä»¥ç®€å•åœ°ç”¨åŸç”Ÿ JS å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;å ç”¨ç©ºé—´çš„é™æ€å›¾ç‰‡å°½å¯èƒ½ä½¿ç”¨åœ¨çº¿èµ„æºã€‚å¯¼èˆªæ å›¾æ ‡å’Œå„ç§ iconï¼Œä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œå»ºè®®æ”¾åœ¨æœ¬åœ°ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å°ç¨‹åºæœ‰é¡µé¢æ ˆçš„é™åˆ¶&#34;&gt;å°ç¨‹åºæœ‰é¡µé¢æ ˆçš„é™åˆ¶&lt;/h3&gt;

&lt;p&gt;ç”±äºæ€§èƒ½çš„é™åˆ¶ï¼Œå°ç¨‹åºé¡µé¢æ ˆä¸­æœ€å¤šåªèƒ½å­˜åœ¨ 5 ä¸ªé¡µé¢ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šåªèƒ½è½¬è·³ 5 å±‚ã€‚ æ­¤æ—¶å°±éœ€è¦å–„ç”¨æ¸…ç©ºé¡µé¢æ ˆçš„æ–¹æ³•ï¼Œä¾‹å¦‚è½¬è·³çš„æ—¶å€™ä½¿ç”¨ redirectTo / relaunch ç­‰æ–¹æ³•ã€‚ä½†æ˜¯åœ¨é¡µé¢æ ˆè¢«æ¸…ç©ºä¹‹åï¼Œå°ç¨‹åºå³ä¸Šè§’çš„è¿”å›æŒ‰é’®å°±ä¼šæ¶ˆå¤±ï¼Œæ‰€ä»¥åœ¨äº§å“è®¾è®¡æ—¶å¤„ç†å¥½è½¬è·³é€»è¾‘æ˜¯å¾ˆå…³é”®çš„ã€‚è¯¦æƒ…è§å°ç¨‹åºæ–‡æ¡£ï¼š&lt;a href=&#34;https://developers.weixin.qq.com/miniprogram/dev/api/ui-navigate.html&#34;&gt;å¯¼èˆª Â· å°ç¨‹åº API&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://developers.weixin.qq.com/miniprogram/dev/component/navigator.html&#34;&gt;å¯¼èˆª Â· å°ç¨‹åºç»„ä»¶&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;å°ç¨‹åºé¡µé¢é—´ä¼ å€¼&#34;&gt;å°ç¨‹åºé¡µé¢é—´ä¼ å€¼&lt;/h3&gt;

&lt;p&gt;å°ç¨‹åºé¡µé¢é—´çš„ä¼ å€¼é çš„æ˜¯è·¯ç”±çš„ paramsï¼Œç±»ä¼¼äº vue-router ä¸­çš„ paramsã€‚åœ¨æ–°é¡µé¢ä¸­ï¼Œè‹¥è¦æ¥æ”¶å€¼ï¼Œåˆ™éœ€è¦åœ¨ onLoad ç”Ÿå‘½å‘¨æœŸä¸­æ¥æ”¶ï¼ŒonLoad æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å³ä¸ºä¼ å…¥çš„ params å¯¹è±¡ã€‚&lt;/p&gt;

&lt;p&gt;æ³¨æ„ï¼šparams ä¼ å€¼é»˜è®¤çš„æ•°æ®ç±»å‹æ˜¯ Stringã€‚&lt;/p&gt;

&lt;h3 id=&#34;è¿”å›æ—¶æ¸…ç©ºæ•°æ®&#34;&gt;è¿”å›æ—¶æ¸…ç©ºæ•°æ®&lt;/h3&gt;

&lt;p&gt;å°ç¨‹åºåœ¨ç‚¹å‡»å·¦ä¸Šè§’è¿”å›çš„æ—¶å€™ä¸èƒ½è‡ªåŠ¨æ¸…ç©ºå½“å‰é¡µé¢çš„æ•°æ®ï¼Œå¦‚æœéœ€è¦æ¸…ç©ºæ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åœ¨ onUnload çš„ç”Ÿå‘½å‘¨æœŸé’©å­é‡Œå°† Vue çš„ data ä¸­çš„æ‰€æœ‰æ•°æ®è¿˜åŸæˆåˆå§‹çŠ¶æ€ã€‚&lt;/p&gt;

&lt;h3 id=&#34;è¿”å›ä¸Šä¸€é¡µ-ä¸Š-x-é¡µ-æ—¶æºå¸¦å‚æ•°&#34;&gt;è¿”å›ä¸Šä¸€é¡µï¼ˆä¸Š X é¡µï¼‰æ—¶æºå¸¦å‚æ•°&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬åœ¨è¿”å›æ—¶ä¼šä½¿ç”¨ &lt;code&gt;wx.navigateBack()&lt;/code&gt;ï¼Œè¿™ä¸ªæ–¹æ³•ä¸å¯æºå¸¦å‚æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨å°ç¨‹åºå†…ç½®çš„ Storage æˆ–è€… Vuex è¿›è¡Œæ•°æ®å­˜å–çš„æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;ä¸å»ºè®®/ä¸åº”è¯¥ä½¿ç”¨å…¶ä»–å¯ä»¥å¸¦å‚æ•°çš„å¯¼èˆªæ–¹å¼ï¼Œå› ä¸ºå®ƒä»¬ä¼šç ´åç°æœ‰çš„é¡µé¢æ ˆæˆ–è€…å¯¼è‡´é¡µé¢æ ˆæ··ä¹±ï¼Œé™¤éæœ‰ç‰¹æ®Šçš„éœ€æ±‚ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å°ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸ&#34;&gt;å°ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸ&lt;/h3&gt;

&lt;p&gt;å°ç¨‹åºæœ‰è‡ªå·±ä¸€å¥—ç”Ÿå‘½å‘¨æœŸï¼Œå’Œ Vue çš„ç”Ÿå‘½å‘¨æœŸä¸å†²çªï¼Œä½†æ˜¯è¡Œä¸ºæœ‰æ‰€åŒºåˆ«ã€‚&lt;/p&gt;

&lt;p&gt;ä¸¾ä¾‹æ¥è¯´ï¼Œä¸€ä¸ªé¡µé¢åŠ è½½æ—¶ï¼Œè¿™äº›ç”Ÿå‘½å‘¨æœŸé’©å­ä¼šæŒ‰å¦‚ä¸‹é¡ºåºè¢«è°ƒç”¨ï¼šonLoad, onShow, mountedã€‚é¡µé¢å­˜åœ¨é¡µé¢æ ˆä¸­æ—¶ï¼Œå¦‚æœè¿”å›è¯¥é¡µé¢ï¼Œä¸ä¼šè§¦å‘ onLoad å’Œ mountedï¼Œä½†æ˜¯ä¼šè§¦å‘ onShowï¼Œå› ä¸ºè¿™ä¸ªé¡µé¢å·²ç»è¢«æŒ‚è½½äº†ã€‚
æ›´å¤šå°ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„è¯¦æƒ…è¯·çœ‹å°ç¨‹åºçš„å®˜æ–¹å¼€å‘æ–‡æ¡£ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ç½‘ç»œè¯·æ±‚&#34;&gt;ç½‘ç»œè¯·æ±‚&lt;/h3&gt;

&lt;p&gt;å°ç¨‹åºä¸­å‘èµ·ç½‘ç»œè¯·æ±‚å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://developers.weixin.qq.com/miniprogram/dev/api/network-request.html#wxrequestobject&#34;&gt;wx.request()&lt;/a&gt;ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://www.npmjs.com/package/flyio&#34;&gt;fly.io&lt;/a&gt;ï¼Œä¸€ä¸ªç±»ä¼¼ axios çš„å¼€æºåº“ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å°ç¨‹åºçš„æ•°æ®å­˜å‚¨&#34;&gt;å°ç¨‹åºçš„æ•°æ®å­˜å‚¨&lt;/h3&gt;

&lt;p&gt;åœ¨ Web ä¸­æˆ‘ä»¬æœ‰ session å’Œ WebStorage å¯ä»¥å­˜å‚¨ä¸€äº›å…¬ç”¨æ•°æ®å¦‚ tokenã€‚è€Œå°ç¨‹åºæœ‰è‡ªå·±çš„æœ¬åœ°ç¼“å­˜ï¼š&lt;a href=&#34;https://developers.weixin.qq.com/miniprogram/dev/api/data.html&#34;&gt;æ•°æ®ç¼“å­˜ Â· å°ç¨‹åº&lt;/a&gt;ï¼Œç”¨æ³•å’Œ WebStorage ç›¸ä¼¼ï¼Œä½†æ˜¯æœ‰åŒæ­¥å’Œå¼‚æ­¥æ–¹æ³•çš„åŒºåˆ«ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ mpvue ä¸­æˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨ vuexï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬æ— æ³•åƒ Web å¼€å‘æ—¶ä¸€æ ·åœ¨ &lt;code&gt;new Vue()&lt;/code&gt; çš„æ—¶å€™ä¼ å…¥ vuex ä½œä¸ºå‚æ•°ï¼Œè€Œæ˜¯éœ€è¦æ‰‹åŠ¨æŒ‚è½½åˆ° Vue.prototype ä¸Šã€‚&lt;/p&gt;

&lt;h3 id=&#34;ç™»å½•ä¸æˆæƒ&#34;&gt;ç™»å½•ä¸æˆæƒ&lt;/h3&gt;

&lt;p&gt;å¾®ä¿¡çš„æˆæƒå¼¹çª—åœ¨ç›®å‰ç‰ˆæœ¬ä¸­æ— æ³•ä¸»åŠ¨è§¦å‘ï¼Œéœ€è¦ç”¨ &lt;a href=&#34;https://developers.weixin.qq.com/miniprogram/dev/component/button.html&#34;&gt;button çš„ open-type å±æ€§&lt;/a&gt; è·å–æˆæƒã€‚æˆæƒå¼¹çª—åªèƒ½è·å–å¾®ä¿¡çš„ç”¨æˆ·ä¿¡æ¯ã€‚æˆæƒå¼¹çª—ä¸­æœ‰ encryptedData å’Œ ivï¼Œè¿™ä¸¤ä¸ªæ•°æ®å¾ˆå…³é”®ï¼Œå¯ä»¥è®©æœåŠ¡ç«¯è§£ç å‡º unionIdã€‚unionId æ˜¯ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼Œåœ¨ç¬¬ä¸‰æ–¹ç™»å½•æˆæƒä¸­éœ€è¦ä½¿ç”¨åˆ°ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœéœ€è¦å¾®ä¿¡å¼€å‘è€…å¹³å°çš„ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œéœ€è¦ä½¿ç”¨ &lt;a href=&#34;https://developers.weixin.qq.com/miniprogram/dev/api/api-login.html&#34;&gt;wx.login()&lt;/a&gt; çš„æ–¹æ³•è·å– codeï¼Œå¹¶å‘é€ç»™æœåŠ¡ç«¯å¤„ç†ï¼Œé€šè¿‡ code å¯ä»¥è·å– sessionKey å’Œ openidã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;wx.login()&lt;/code&gt; ä¸€å®šè¦åœ¨æˆæƒå¼¹çª—ä¹‹å‰è°ƒç”¨ï¼Œå› ä¸ºè§£å¯† encryptedData å’Œ iv éœ€è¦ sessionKeyï¼ŒsessionKey æ˜¯ä» code è·å¾—çš„ã€‚åœ¨ &lt;code&gt;wx.login()&lt;/code&gt; å¾—åˆ°çš„ codeï¼ˆä»¥åŠ code è·å–çš„ sessionKeyï¼‰ ä¹‹åè·å–çš„ encryptedData å’Œ iv æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œè‹¥é¢ å€’é¡ºåºï¼Œåˆ™ encryptedData å’Œ iv æ— æ³•å’Œ sessionKey å¯¹åº”ä¸Šã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ ‡ç­¾&#34;&gt;æ ‡ç­¾&lt;/h3&gt;

&lt;p&gt;mpvue ä¸­å¯ä»¥ä½¿ç”¨ Web çš„æ ‡ç­¾ï¼Œæœ€åä¼šè¢«ç¼–è¯‘æˆå¯¹åº”çš„å°ç¨‹åºæ ‡ç­¾ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨å°ç¨‹åºçš„åŸç”Ÿæ ‡ç­¾ã€‚å°ç¨‹åºçš„åŸç”Ÿæ ‡ç­¾å¯ä»¥å¸®åŠ©æˆ‘ä»¬åšå¾ˆå¤š Web æ ‡ç­¾æ— æ³•å®ç°çš„å·¥ä½œï¼Œä¾‹å¦‚ swiper å’Œ swiper-item å¯ä»¥å®ç°å·¦æ»‘å³æ»‘åˆ‡æ¢ Tab é¡µï¼›scroll-view å®é™…ä¸Šæ˜¯ä¸€ä¸ª &lt;code&gt;overflow-(x/y): auto;&lt;/code&gt; çš„å—çº§å…ƒç´ ï¼Œå¹¶ä¸”æœ¬èº«ä¸å¸¦æ»šåŠ¨æ¡ï¼Œä½†æ˜¯æ³¨æ„ scroll-view å¹¶ä¸ä¼šè§¦å‘ onReachBottom çš„é’©å­ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åˆ†é¡µåŠ è½½&#34;&gt;åˆ†é¡µåŠ è½½&lt;/h3&gt;

&lt;p&gt;åˆ†é¡µåŠ è½½æœ‰ä¸¤ç§æ–¹å¼: onReachBottom å’Œ scroll-view&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ onReachBottom æ—¶ä¸èƒ½ä½¿ç”¨ scroll-viewï¼Œåªèƒ½ä½¿ç”¨æ™®é€šçš„ view / divã€‚scroll-view ä½¿ç”¨ @scrolltolower (åŸç”Ÿå°ç¨‹åºæ˜¯ bindscrolltolower) çš„ eventã€‚&lt;/li&gt;
&lt;li&gt;åŒ…è£¹ç€åˆ—è¡¨ç»„ä»¶çš„å®¹å™¨å¿…é¡»ä¿è¯èƒ½æ»šåŠ¨åˆ°å±å¹•åº•éƒ¨ï¼Œä¹Ÿå°±æ˜¯è¯´ CSS é‡Œå¯¹é«˜åº¦çš„è®¾ç½®éœ€è¦æ³¨æ„&lt;/li&gt;
&lt;li&gt;é¡µé¢&lt;em&gt;ç»„ä»¶ä¸­éœ€è¦æœ‰å˜é‡è®°å½•å½“å‰é¡µç æˆ–è€…ä¸‹ä¸€é¡µçš„é¡µç ï¼Œåœ¨è§¦å‘ onReachBottom&lt;/em&gt;@scrolltolower æ—¶ä½¿ç”¨è¿™ä¸ªé¡µç å»è·å–æ–°çš„åˆ†é¡µæ•°æ®&lt;/li&gt;
&lt;li&gt;åˆ†é¡µåŠ è½½å®Œæˆåï¼Œæ•°æ®éœ€è¦åŠ åˆ°åŸåˆ—è¡¨æ•°ç»„çš„æœ€å&lt;/li&gt;
&lt;li&gt;é¡µé¢&lt;em&gt;ç»„ä»¶ä¸­éœ€è¦æœ‰å˜é‡è®°å½•æ€»é¡µæ•°ï¼Œåœ¨ onReachBottom&lt;/em&gt;@scrolltolower æ—¶ï¼Œå¦‚æœå·²ç»åˆ°æœ€åä¸€é¡µåˆ™ä¸ç»§ç»­åŠ è½½æˆ–è€…å¼¹å‡ºæç¤º&lt;/li&gt;
&lt;li&gt;åœ¨è¿›è¡Œä¸€äº›å¤æ‚æ“ä½œçš„æ—¶å€™è®°å¾—æ¸…ç©ºå½“å‰é¡µç å’Œæ€»é¡µæ•°ï¼Œé˜²æ­¢æ•°æ®æ··ä¹±&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;å›¾ç‰‡&#34;&gt;å›¾ç‰‡&lt;/h3&gt;

&lt;p&gt;å°ç¨‹åºä¸­çš„ image å¦‚æœä¸æ‰‹åŠ¨è®¾ç½®å¤§å°ï¼Œä¼šé»˜è®¤è¢«è®¾ç½®ä¸º 320*240 (rpx)ã€‚å°ç¨‹åºä¸­ image çš„è‡ªé€‚åº”å’Œ Web å¼€å‘å¹¶ä¸ä¸€æ ·ï¼Œä½¿ç”¨çš„æ˜¯ &lt;a href=&#34;https://developers.weixin.qq.com/miniprogram/dev/component/image.html&#34;&gt;image çš„ mode å±æ€§&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å°ç¨‹åºçš„ image ä¸æ”¯æŒ svg çš„å›¾ç‰‡ï¼Œéœ€è¦ç”¨ css çš„ background-imageã€‚&lt;/p&gt;

&lt;p&gt;app.json ä¸­ï¼ŒTabBar çš„ icon ä¸èƒ½ç”¨ svgã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ mpvue ä¸­å¯ä»¥ä½¿ç”¨ iconfontã€‚&lt;/p&gt;

&lt;h3 id=&#34;å…³äºè¾¹æ¡†&#34;&gt;å…³äºè¾¹æ¡†&lt;/h3&gt;

&lt;p&gt;mpvue-weui å’Œå¾®ä¿¡å°ç¨‹åºçš„æŸå†™åŸç”Ÿç»„ä»¶å¦‚ button ä¼šæœ‰è‡ªå¸¦çš„è¾¹æ¡†ï¼Œå®ƒä»¬éƒ½æ˜¯å†™åœ¨ &lt;code&gt;::after&lt;/code&gt; ä¼ªå…ƒç´ ä¸­çš„ï¼Œå¦‚æœä½ ä½¿ç”¨ border-radius çš„è¯ï¼Œä¼šå¯¼è‡´æŸäº›è¾¹æ¡†æ¶ˆå¤±ã€‚æ­¤æ—¶å»ºè®®å°†å…¶éšè—å¹¶é‡æ–°ç”¨ä¸‹é¢çš„ rpx çš„æ–¹å¼æ¥å†™è¾¹æ¡†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;é•¿åº¦å•ä½ä¸-1-åƒç´ è¾¹æ¡†&#34;&gt;é•¿åº¦å•ä½ä¸ 1 åƒç´ è¾¹æ¡†&lt;/h3&gt;

&lt;p&gt;æŒ‰ç…§ä»ç§»åŠ¨ H5 è½¬è¿‡æ¥çš„æ€ç»´ï¼Œ1 åƒç´ è¾¹æ¡†ä¸€èˆ¬éœ€è¦ç”¨ä¼ªå…ƒç´ æ¥å†™ã€‚å°ç¨‹åºä¸­åŒæ ·å¯ä»¥ä½¿ç”¨ ::after ä¼ªå…ƒç´ å†™ 1 åƒç´ çš„è¾¹æ¡†ï¼Œä½†æ˜¯å®é™…çš„æ˜¾ç¤ºå‡ºæ¥çš„ä½ç½®éƒ½å’Œ Web æœ‰åŒºåˆ«ã€‚å¯ä»¥å‚è€ƒ &lt;a href=&#34;http://kuangpf.com/mpvue-weui/#/README&#34;&gt;mpvue-weui&lt;/a&gt; çš„ weui.css ä¸­çš„æ–¹å¼è¿›è¡Œå¼€å‘ã€‚&lt;/p&gt;

&lt;p&gt;ä½†äº‹å®ä¸Šï¼Œå¾®ä¿¡å°ç¨‹åºçš„ rpx å°±æ˜¯è‡ªé€‚åº”å•ä½ï¼Œç›¸å½“äºç§»åŠ¨ H5 åšè‡ªé€‚åº”å¸¸ç”¨çš„ remã€‚1rpx = 0.5px = 1 ç‰©ç†åƒç´ ã€‚æ‰€ä»¥æˆ‘ä»¬å®é™…ä¸Šå¯ä»¥ä½¿ç”¨ rpx æ¥å†™ 1 åƒç´ è¾¹æ¡†ã€‚å½“ç„¶å¾®ä¿¡å°ç¨‹åºä¹Ÿæ”¯æŒ remï¼Œè§„å®šå±å¹•å®½åº¦ä¸º 20remï¼Œæ‰€ä»¥ 1rem = (å±å¹•å®½åº¦ / 20)rpxã€‚&lt;/p&gt;

&lt;p&gt;button åœ¨æœ‰ border-radius çš„æ—¶å€™å¯èƒ½è¾¹æ¡†æ˜¾ç¤ºä¸å…¨ï¼Œæ­¤æ—¶å»ºè®®ç”¨ div åŒ…è£¹ button å¹¶åœ¨ div ä¸Šå†™ 1px çš„ borderï¼Œéšè— button è‡ªå¸¦çš„ borderã€‚&lt;/p&gt;

&lt;h3 id=&#34;position-fixed&#34;&gt;position: fixed&lt;/h3&gt;

&lt;p&gt;å°ç¨‹åºçš„ position: fixed å’Œ Web ä¸Šçš„è¡¨ç°æœ‰æ‰€ä¸åŒã€‚å¦‚æœ mpvue å°ç¨‹åºçš„é¡µé¢ä¸­æœ‰å…¶ä»– Vue ç»„ä»¶ï¼Œé‚£ä¹ˆåœ¨ç»„ä»¶ä¸­è®¾å®šçš„ &lt;code&gt;position: fixed&lt;/code&gt; åªä¼šç›¸å¯¹äºè¿™ä¸ªç»„ä»¶æ˜¯ fixedï¼Œå¹¶ä¸ä¼šåœ¨é¡µé¢ä¸­ fixedã€‚å¦‚æœè®¾å®š &lt;code&gt;bottom: 0&lt;/code&gt;ï¼Œé‚£ä¹ˆå®ƒåªä¼šå›ºå®šåœ¨ Vue ç»„ä»¶çš„åº•éƒ¨ï¼Œè€Œä¸æ˜¯æ•´ä¸ªé¡µé¢çš„åº•éƒ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œmpvue å°ç¨‹åºä¸­çš„ Vue ç»„ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ª BFCã€‚&lt;/p&gt;

&lt;h3 id=&#34;äº‹ä»¶&#34;&gt;äº‹ä»¶&lt;/h3&gt;

&lt;p&gt;mpvue ä¸­åŒæ ·æœ‰äº‹ä»¶ï¼Œä½†æ˜¯è°ƒå–å‚æ•° e çš„å€¼çš„æ–¹å¼å’Œ Web ä¸åŒï¼Œéœ€è¦ä½¿ç”¨ &lt;code&gt;e.mp.detail&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;ç‚¹å‡»å¯¼èˆªæ¡è½¬è·³åˆ°ç›¸åº”ä½ç½®-ç±»ä¼¼é€šè®¯å½•&#34;&gt;ç‚¹å‡»å¯¼èˆªæ¡è½¬è·³åˆ°ç›¸åº”ä½ç½®ï¼ˆç±»ä¼¼é€šè®¯å½•ï¼‰&lt;/h3&gt;

&lt;p&gt;åœ¨é¡¹ç›®ä¸­ï¼ŒæœåŠ¡ç«¯åªä¼šç»™å‡ºæ‰€æœ‰çš„åŸå¸‚åˆ—è¡¨ï¼Œä¹‹åæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°å¯¹å…¶è¿›è¡Œåˆ†ç±»ã€‚æŒ‰å­—æ¯åˆ†ç±»ä½¿ç”¨äº† &lt;a href=&#34;https://github.com/hotoo/pinyin&#34;&gt;GitHub - hotoo/pinyin: æ±‰å­—æ‹¼éŸ³ âœ hÃ n zÃ¬ pÄ«n yÄ«n&lt;/a&gt; ã€‚&lt;/p&gt;

&lt;p&gt;é¡µé¢åˆ†ä¸ºä¾§è¾¹å­—æ¯å¯¼èˆªæ¡å’ŒåŸå¸‚åˆ—è¡¨ã€‚é¡¹ç›®çš„éœ€æ±‚æ˜¯åªéœ€è¦åˆ—å‡ºæ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†åŸå¸‚ï¼Œæ‰€ä»¥å¯¼èˆªå­—æ¯ä¹Ÿéœ€è¦æ ¹æ®åŸå¸‚åŠ¨æ€æ˜¾ç¤ºã€‚&lt;/p&gt;

&lt;p&gt;ç‚¹å‡»å­—æ¯æ»šåŠ¨åˆ°å¯¹åº”ä½ç½®çš„åŠŸèƒ½ä½¿ç”¨äº† scroll-view çš„ scroll-into-viewï¼Œåœ¨ scroll-into-view ä¸ŠåŠ¨æ€ç»‘å®šå¯¹åº”å­—æ¯çš„å”¯ä¸€ idï¼ˆå˜é‡åœ¨ Vue çš„ data ä¸­ï¼‰ï¼ŒåŒæ—¶åœ¨æˆ‘ä»¬æ¸²æŸ“åŸå¸‚çš„æ—¶å€™ï¼Œéœ€è¦åœ¨æœ€å¤–å±‚åŠ ä¸Šå±æ€§ idï¼Œä¸ scroll-into-view ä¸Šçš„ id è¦å¯¹åº”ã€‚&lt;/p&gt;

&lt;p&gt;å­—æ¯å¯¼èˆªæ¡ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®¾å®šä¸€ä¸ª data-iï¼Œå¹¶åœ¨ click äº‹ä»¶ä¸­ç”¨ &lt;code&gt;e.currentTarget.dataset.i&lt;/code&gt; è·å–è¿™ä¸ª data-iï¼Œå¹¶èµ‹å€¼ç»™ data ä¸­ç»‘å®š id çš„å˜é‡ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥è½¬è·³åˆ°ç›¸åº”çš„ä½ç½®ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;template&amp;gt;
  &amp;lt;div class=&amp;quot;city&amp;quot;&amp;gt;
    &amp;lt;div class=&amp;quot;city__body&amp;quot;&amp;gt;
      &amp;lt;div class=&amp;quot;current-city&amp;quot;&amp;gt;å½“å‰å®šä½åŸå¸‚ï¼š{{ city.city }}&amp;lt;/div&amp;gt;
      &amp;lt;scroll-view scroll-y class=&amp;quot;alphabet&amp;quot; :scroll-into-view=&amp;quot;&#39;id-&#39; + toView&amp;quot;&amp;gt;
        &amp;lt;div
          :id=&amp;quot;&#39;id-&#39; + index&amp;quot;
          v-for=&amp;quot;(item, index) in filteredCities&amp;quot;
          :key=&amp;quot;item.firstLetter + index&amp;quot;
        &amp;gt;
          &amp;lt;div class=&amp;quot;weui-cells__title&amp;quot;&amp;gt;{{ item.firstLetter }}&amp;lt;/div&amp;gt;
          &amp;lt;div class=&amp;quot;weui-cells weui-cells_after-title&amp;quot;&amp;gt;
            &amp;lt;div
              class=&amp;quot;weui-cell&amp;quot;
              v-for=&amp;quot;(_item, _index) in item.cities&amp;quot;
              :key=&amp;quot;_item.cityCode + _index&amp;quot;
              @click=&amp;quot;setCity(_item)&amp;quot;
            &amp;gt;
              &amp;lt;div class=&amp;quot;weui-cell__bd&amp;quot;&amp;gt;{{ _item.city }}&amp;lt;/div&amp;gt;
            &amp;lt;/div&amp;gt;
          &amp;lt;/div&amp;gt;
        &amp;lt;/div&amp;gt;
      &amp;lt;/scroll-view&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class=&amp;quot;city__letters&amp;quot;&amp;gt;
      &amp;lt;div
        v-for=&amp;quot;(item, index) in nav&amp;quot;
        :key=&amp;quot;item&amp;quot;
        @click=&amp;quot;setAlphabet&amp;quot;
        :data-i=&amp;quot;index&amp;quot;
      &amp;gt;
        {{item}}
      &amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;
  &amp;lt;/div&amp;gt;
&amp;lt;/template&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;&amp;lt;script&amp;gt;
export default {
	data() {
    return {
      nav: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;J&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;U&#39;, &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;],
      toView: 0,
      cities: []
    }
  },
	onLoad() {
	  // è·å–åŸå¸‚
	  getCity().then(res =&amp;gt; {
      if (/* è°ƒç”¨æˆåŠŸ */) {
        const categoriedCities = []
        const cities = []
        let nav = []
        for (const item of res.data.data) {
          // æå–åŸå¸‚é¦–å­—æ¯ï¼Œæ”¾å…¥å¯¼èˆªåˆ—è¡¨
          const py = pinyin(item.city, { style: pinyin.STYLE_FIRST_LETTER })
          const firstLetter = py[0][0].toUpperCase()
          if (firstLetter.length === 1) {
            nav.push(firstLetter)
          }
          // æ„é€ æ–°çš„æ•°æ®ï¼ŒåŠ å…¥é¦–å­—æ¯
          const newItem = {
            ...item,
            firstLetter,
            city: item.city.substring(0, item.city.length - 1)
          }
          cities.push(newItem)
        }
        // å¯¼èˆªé‡Œå»é™¤é‡å¤çš„å­—æ¯
        nav = [...new Set(nav)]
        // æ ¹æ®å¯¼èˆªçš„å­—æ¯ï¼ŒæŠŠä¸Šé¢æ„é€ çš„æ•°æ®æŒ‰ç…§å­—æ¯è¿›è¡Œé‡æ–°åˆ†ç±»ï¼Œå¾—åˆ°æœ€åéœ€è¦çš„ç»“æœ
        // å¯¹æ¯ä¸ªå­—æ¯ï¼Œåœ¨ä¸Šé¢æ„é€ çš„æ•°æ®ä¸­ç­›é€‰å‡ºç›¸åº”å­—æ¯çš„æ‰€æœ‰åŸå¸‚ï¼Œæ”¾å…¥ä¸€ä¸ªå¯¹è±¡ä¸­å¹¶ push å…¥æœ€ç»ˆæ•°ç»„
        for (const item of nav) {
          const sameLetterCities = cities.filter(i =&amp;gt; i.firstLetter === item)
          categoriedCities.push({
            firstLetter: item,
            cities: sameLetterCities
          })
        }
        this.nav = nav
        this.cities = categoriedCities
      }
    })
	}
}
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>