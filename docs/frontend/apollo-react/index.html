<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Haoze Harry Xu">
  
  
  
  <link rel="prev" href="https://elizurhz.cn/frontend/react-fiber/" />
  
  <link rel="canonical" href="https://elizurhz.cn/frontend/apollo-react/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Apollo GraphQL åœ¨ React ä¸­çš„åº”ç”¨ | Variation Palladion - æ’•è£‚æ—¶é—´çš„å¸•æ‹‰è¿ªæ˜‚
       
  </title>
  <meta name="title" content="Apollo GraphQL åœ¨ React ä¸­çš„åº”ç”¨ | Variation Palladion - æ’•è£‚æ—¶é—´çš„å¸•æ‹‰è¿ªæ˜‚">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/elizurhz.cn\/"
    },
    "articleSection" : "frontend",
    "name" : "Apollo GraphQL åœ¨ React ä¸­çš„åº”ç”¨",
    "headline" : "Apollo GraphQL åœ¨ React ä¸­çš„åº”ç”¨",
    "description" : "è¿™ç¯‡æ–‡ç« å¤§æ¦‚ä»‹ç»ä¸‹ GraphQL çš„ä½¿ç”¨ï¼ŒApollo çš„ä½¿ç”¨ï¼Œä»¥åŠæˆ‘åœ¨é¡¹ç›®ä¸­é‡åˆ°çš„ä¸€äº›åœºæ™¯å’Œæƒ…å†µã€‚\nApollo æ˜¯ç”Ÿäº§çº§çš„ GraphQL æ¡†æ¶ï¼ˆå®˜æ–¹ç®€ä»‹ï¼‰ã€‚é‚£ä¹ˆæˆ‘ä½¿ç”¨ Apollo çš„å¥‘æœºæ˜¯ï¼Œæˆ‘ä»¬é¡¹ç›®çš„åç«¯ï¼ˆç¾å›½å›¢é˜Ÿï¼‰å·²ç»é•¿æœŸåœ¨ä½¿ç”¨ GraphQLã€‚åœ¨è¿™ä¸ªé¡¹ç›®åˆæœŸï¼Œåç«¯æ˜¯æœ‰æä¾› SDK ç»™éƒ¨åˆ†æ¥å£çš„ï¼Œä½†æ˜¯åæ¥ç”±äºä¸šåŠ¡çš„å‘å±•ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…¨éƒ¨æ¥å…¥ GraphQLï¼Œå› ä¸ºä»–ä»¬çš„å¾ˆå¤šæœåŠ¡éƒ½æ˜¯æä¾› GraphQL çš„ endpoint çš„ï¼Œå°è£…æˆ SDK ç›¸å¯¹å›°éš¾ã€‚\nGraphQL æ³¨ï¼šæœ¬èŠ‚ç¤ºä¾‹ä»£ç å¤§å¤šæ¥è‡ªäº GraphQL å®˜ç½‘ã€‚\næåˆ° GraphQLï¼Œä¸æ˜ç™½çš„äººå¯èƒ½ä¼šè”æƒ³åˆ° SQLã€‚è¿™ç¡®å®æ²¡é”™ï¼ŒGraphQL æœ¬èº«å°±æ˜¯ä¸€ç§ query languageã€‚åœ¨ Apollo ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© gql è¿™ä¸ªåŒ…æ¥å†™ queries å’Œ mutationsã€‚\nimport gql from \u0026#39;graphql-tag\u0026#39; const SAMPLE_QUERY = gql` { hero { name height } } ` ä¸Šé¢çš„æ˜¯ä¸éœ€è¦ä¼ å…¥ä»»ä½•å‚æ•°çš„ queryã€‚è€Œæˆ‘ä»¬çŸ¥é“ï¼Œå¤§éƒ¨åˆ†æ¥å£éƒ½éœ€è¦å‚æ•°ï¼Œæ‰€ä»¥ä½¿ç”¨ gql åŒ…æˆ‘ä»¬éœ€è¦è¿™ä¹ˆå†™ï¼š\nconst SAMPLE_QUERY_WITH_VARIABLES = gql` query HeroNameAndFriends($episode: Episode) { hero(episode: $episode) { name friends { name } } } ` HeroNameAndFriends åœ¨ GraphQL é‡Œå«åš operation nameã€‚",
    "inLanguage" : "zh-CN",
    "author" : "Haoze Harry Xu",
    "creator" : "Haoze Harry Xu",
    "publisher": "Haoze Harry Xu",
    "accountablePerson" : "Haoze Harry Xu",
    "copyrightHolder" : "Haoze Harry Xu",
    "copyrightYear" : "2020",
    "datePublished": "2020-05-22 00:00:00 \u002b0000 UTC",
    "dateModified" : "2020-05-22 00:00:00 \u002b0000 UTC",
    "url" : "https:\/\/elizurhz.cn\/frontend\/apollo-react\/",
    "wordCount" : "908",
    "keywords" : [ "GraphQL","React", "Variation Palladion - æ’•è£‚æ—¶é—´çš„å¸•æ‹‰è¿ªæ˜‚"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://elizurhz.cn/">Variation Palladion - æ’•è£‚æ—¶é—´çš„å¸•æ‹‰è¿ªæ˜‚</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/frontend/" title="">Web å‰ç«¯</a>
                
                <a class="menu-item" href="/by-talk/" title="">å¼€å‘æ‚è°ˆ</a>
                
                <a class="menu-item" href="/backend/" title="">åç«¯/è¿ç»´/éƒ¨ç½²</a>
                
                <a class="menu-item" href="/mobile/" title="">ç§»åŠ¨å¼€å‘</a>
                
                <a class="menu-item" href="/tips/" title="">å…¶ä»–æŠ€æœ¯</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://elizurhz.cn/">Variation Palladion - æ’•è£‚æ—¶é—´çš„å¸•æ‹‰è¿ªæ˜‚</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/frontend/" title="">Web å‰ç«¯</a>
                
                <a class="menu-item" href="/by-talk/" title="">å¼€å‘æ‚è°ˆ</a>
                
                <a class="menu-item" href="/backend/" title="">åç«¯/è¿ç»´/éƒ¨ç½²</a>
                
                <a class="menu-item" href="/mobile/" title="">ç§»åŠ¨å¼€å‘</a>
                
                <a class="menu-item" href="/tips/" title="">å…¶ä»–æŠ€æœ¯</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Apollo GraphQL åœ¨ React ä¸­çš„åº”ç”¨</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://elizurhz.cn/" rel="author">Haoze Harry Xu</a> with â™¥ 
                <span class="post-time">
                on <time datetime=2020-05-22 itemprop="datePublished">May 22, 2020</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://elizurhz.cn/categories/%E5%89%8D%E7%AB%AF/"> å‰ç«¯ </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <p>è¿™ç¯‡æ–‡ç« å¤§æ¦‚ä»‹ç»ä¸‹ GraphQL çš„ä½¿ç”¨ï¼ŒApollo çš„ä½¿ç”¨ï¼Œä»¥åŠæˆ‘åœ¨é¡¹ç›®ä¸­é‡åˆ°çš„ä¸€äº›åœºæ™¯å’Œæƒ…å†µã€‚</p>
<p>Apollo æ˜¯ç”Ÿäº§çº§çš„ GraphQL æ¡†æ¶ï¼ˆå®˜æ–¹ç®€ä»‹ï¼‰ã€‚é‚£ä¹ˆæˆ‘ä½¿ç”¨ Apollo çš„å¥‘æœºæ˜¯ï¼Œæˆ‘ä»¬é¡¹ç›®çš„åç«¯ï¼ˆç¾å›½å›¢é˜Ÿï¼‰å·²ç»é•¿æœŸåœ¨ä½¿ç”¨ GraphQLã€‚åœ¨è¿™ä¸ªé¡¹ç›®åˆæœŸï¼Œåç«¯æ˜¯æœ‰æä¾› SDK ç»™éƒ¨åˆ†æ¥å£çš„ï¼Œä½†æ˜¯åæ¥ç”±äºä¸šåŠ¡çš„å‘å±•ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…¨éƒ¨æ¥å…¥ GraphQLï¼Œå› ä¸ºä»–ä»¬çš„å¾ˆå¤šæœåŠ¡éƒ½æ˜¯æä¾› GraphQL çš„ endpoint çš„ï¼Œå°è£…æˆ SDK ç›¸å¯¹å›°éš¾ã€‚</p>
<h2 id="graphql">GraphQL</h2>
<p>æ³¨ï¼šæœ¬èŠ‚ç¤ºä¾‹ä»£ç å¤§å¤šæ¥è‡ªäº <a href="https://graphql.org/">GraphQL å®˜ç½‘</a>ã€‚</p>
<p>æåˆ° GraphQLï¼Œä¸æ˜ç™½çš„äººå¯èƒ½ä¼šè”æƒ³åˆ° SQLã€‚è¿™ç¡®å®æ²¡é”™ï¼ŒGraphQL æœ¬èº«å°±æ˜¯ä¸€ç§ query languageã€‚åœ¨ Apollo ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© <code>gql</code> è¿™ä¸ªåŒ…æ¥å†™ queries å’Œ mutationsã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">gql</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;graphql-tag&#39;</span>

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">SAMPLE_QUERY</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gql</span><span style="color:#e6db74">`
</span><span style="color:#e6db74">  {
</span><span style="color:#e6db74">    hero {
</span><span style="color:#e6db74">      name
</span><span style="color:#e6db74">      height
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">  }
</span><span style="color:#e6db74">`</span>
</code></pre></div><p>ä¸Šé¢çš„æ˜¯ä¸éœ€è¦ä¼ å…¥ä»»ä½•å‚æ•°çš„ queryã€‚è€Œæˆ‘ä»¬çŸ¥é“ï¼Œå¤§éƒ¨åˆ†æ¥å£éƒ½éœ€è¦å‚æ•°ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>gql</code> åŒ…æˆ‘ä»¬éœ€è¦è¿™ä¹ˆå†™ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">SAMPLE_QUERY_WITH_VARIABLES</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gql</span><span style="color:#e6db74">`
</span><span style="color:#e6db74">  query HeroNameAndFriends($episode: Episode) {
</span><span style="color:#e6db74">    hero(episode: $episode) {
</span><span style="color:#e6db74">      name
</span><span style="color:#e6db74">      friends {
</span><span style="color:#e6db74">        name
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">  }
</span><span style="color:#e6db74">`</span>
</code></pre></div><p><code>HeroNameAndFriends</code> åœ¨ GraphQL é‡Œå«åš <code>operation name</code>ã€‚</p>
<p>è€Œåœ¨ GraphQL ä¸­æˆ‘ä»¬è¿˜ä¼šæœ‰ä¸€ç§å¸¸ç”¨çš„æ¨¡å¼å°±æ˜¯ Fragmentsã€‚ä»¥å®˜ç½‘çš„ä»£ç ä¸ºä¾‹ï¼Œä½¿ç”¨ <code>gql</code> åŒ…æˆ‘ä»¬éœ€è¦è¿™ä¹ˆå†™ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sampleFragments</span> <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">fragments</span><span style="color:#f92672">:</span> {
    <span style="color:#a6e22e">entry</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">gql</span><span style="color:#e6db74">`
</span><span style="color:#e6db74">      fragment comparisonFields on Character {
</span><span style="color:#e6db74">        name
</span><span style="color:#e6db74">        appearsIn
</span><span style="color:#e6db74">        friends {
</span><span style="color:#e6db74">          name
</span><span style="color:#e6db74">        }
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">    `</span>
  }
}
</code></pre></div><p>Fragments å¯ä»¥ç”¨æ¥å®šä¹‰é‡å¤ä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ä¸éœ€è¦é‡å¤å®šä¹‰è¿™äº› schemaã€‚å‡è®¾æœ‰ä¸ªé€‚ç”¨åœºæ™¯æ˜¯ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œç”¨æˆ·æœ‰ä¸€ç³»åˆ—å…±æœ‰çš„å±æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶å®šä¹‰ä¸º Fragmentsã€‚åœ¨è¿›è¡Œå„ç§ queries å’Œ mutations çš„æ—¶å€™ï¼Œä¾‹å¦‚è¯·æ±‚ç”¨æˆ·åˆ—è¡¨ã€ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ç­‰ç­‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å¼•ç”¨è¿™ä¸ª Fragmentsï¼Œè€Œä¸ç”¨é‡å¤å†™è¿™æ®µ schemaï¼Œä¾‹å¦‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">SAMPLE_QUERY_WITH_FRAGMENTS</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gql</span><span style="color:#e6db74">`
</span><span style="color:#e6db74">  query findHero($episode: Episode) {
</span><span style="color:#e6db74">    leftComparison: hero(episode: $episode) {
</span><span style="color:#e6db74">      ...comparisonFields
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">    rightComparison: hero(episode: $episode) {
</span><span style="color:#e6db74">      ...comparisonFields
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">  }
</span><span style="color:#e6db74">  </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">sampleFragments</span>.<span style="color:#a6e22e">fragments</span>.<span style="color:#a6e22e">entry</span><span style="color:#e6db74">}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">`</span>
</code></pre></div><p>mutations çš„å†™æ³•å’Œ query éå¸¸ç›¸ä¼¼ï¼Œåªéœ€è¦æŠŠ <code>query</code> å…³é”®å­—æ¢æˆ <code>mutation</code> å³å¯ã€‚
è¿™é‡Œéå¸¸å®¹æ˜“é‡åˆ°å˜é‡åå­—å†™é”™ç­‰ç­‰é—®é¢˜ï¼Œå†™çš„æ—¶å€™è¿˜éœ€è¦ä»”ç»†å‚è€ƒæ¨¡æ¿ã€‚
å¦å¤–å…³äº GraphQL ä¸­çš„ç±»å‹ï¼Œä¾‹å¦‚ä¸Šé¢ç¤ºä¾‹ä»£ç ä¸­çš„ <code>Episode</code> å’Œ <code>Character</code>ï¼Œè¿™ä¸ªä¸€èˆ¬æ˜¯åœ¨åç«¯å®šä¹‰çš„ã€‚è‡³äºå¦‚ä½•è·å–ç±»å‹åï¼Œè¿™ä¸ªåç«¯æ˜¯ä¼šåœ¨ endpoint æä¾›ä¸€ä¸ª playground æ¥æ˜¾ç¤ºæœ‰å“ªäº› queries å“ªäº› mutations å¯ç”¨çš„ï¼ŒåŒ…æ‹¬éœ€è¦ä¼ çš„å‚æ•°éƒ½ä¼šå†™å‡ºæ¥ï¼Œä¹Ÿå°±ç›¸å½“äºä¸€ä¸ª API æ–‡æ¡£ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ playground ä¸Šæµ‹è¯•æˆ‘ä»¬çš„ queries å’Œ mutations æœ‰æ²¡æœ‰å†™å¯¹ã€‚å¦å¤–å…³äºå‚æ•°å’Œç±»å‹ï¼Œå¸¦æ„Ÿå¹å·çš„å°±æ˜¯å¿…ä¼ å‚æ•°ï¼Œå…¶ä»–å¹¶æ²¡æœ‰å¤ªå¤šéœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚</p>
<h2 id="apollo">Apollo</h2>
<h3 id="ä½¿ç”¨">ä½¿ç”¨</h3>
<p>æ³¨ï¼šæœ¬èŠ‚ç¤ºä¾‹ä»£ç ä¸»è¦æ¥è‡ªäº <a href="https://www.apollographql.com/">Apollo å®˜ç½‘</a>ï¼Œä»¥ 3.0beta ç‰ˆæœ¬çš„ API ä¸ºå‡†ã€‚</p>
<p>ä¸Šé¢ç®€å•ä»‹ç»äº†ä¸‹æ€æ ·å†™ queries å’Œ mutationsï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·æ¥å‘èµ· GraphQL è¯·æ±‚ã€‚åœ¨ React ä¸­ï¼Œé™¤äº† Apolloï¼Œè¿˜æœ‰ Facebook åšçš„ Relayã€‚æˆ‘æ²¡ç”¨è¿‡ Relayï¼Œä½†æ˜¯çœ‹è¯„ä»·æ˜¯è¯´å®ƒæ¯”è¾ƒâ€œé‡â€ã€‚æœ¬æ–‡å°±ç€é‡ä»‹ç» Apolloã€‚</p>
<p>Apollo æ˜¯ä¸ªå·¥å…·ï¼Œå®ƒæœ‰å„ç«¯çš„å®ç°ï¼Œè€Œåœ¨ React ç«¯å®ƒå¯ä»¥ä»¥ç»„ä»¶çš„å½¢å¼å­˜åœ¨äº App ä¸­ã€‚è¦ä½¿ç”¨ Apolloï¼Œæˆ‘ä»¬éœ€è¦å…ˆåšä¸¤ä»¶äº‹ï¼šå†™åˆ›å»º <code>ApolloClient</code> çš„ä»£ç ï¼Œå’Œå°† <code>ApolloProvider</code> åŠ å…¥åˆ°ç»„ä»¶æ ‘ä¸­ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#75715e">/** apolloClient.js */</span>
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ApolloClient</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;apollo-client&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">InMemoryCache</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;apollo-cache-inmemory&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">HttpLink</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;apollo-link-http&#39;</span>;

<span style="color:#75715e">// Instantiate required constructor fields
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">InMemoryCache</span>();
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">link</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">HttpLink</span>({
  <span style="color:#a6e22e">uri</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;http://yourbackendendpoint.com/graphql&#39;</span>,
});

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">client</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ApolloClient</span>({
  <span style="color:#75715e">// Provide required constructor fields
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">cache</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cache</span>,
  <span style="color:#a6e22e">link</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">link</span>,

  <span style="color:#75715e">// Provide some optional constructor fields
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;react-web-client&#39;</span>,
  <span style="color:#a6e22e">version</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;1.3&#39;</span>,
  <span style="color:#a6e22e">queryDeduplication</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
  <span style="color:#a6e22e">defaultOptions</span><span style="color:#f92672">:</span> {
    <span style="color:#a6e22e">watchQuery</span><span style="color:#f92672">:</span> {
      <span style="color:#a6e22e">fetchPolicy</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;cache-and-network&#39;</span>,
    },
  },
});

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">client</span>
</code></pre></div><p>æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼åˆ›å»ºä¸€ä¸ª <code>ApolloClient</code>ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä¸­å¼•ç”¨å®ƒï¼Œå› ä¸º <code>ApolloProvider</code> éœ€è¦å®ƒä½œä¸º prop ä¼ å…¥ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSX" data-lang="JSX"><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">React</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">render</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react-dom&#39;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">client</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./client&#39;</span> <span style="color:#75715e">// sample
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ApolloProvider</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@apollo/react-hooks&#39;</span>;

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">App</span> <span style="color:#f92672">=</span> () =&gt; (
  &lt;<span style="color:#f92672">ApolloProvider</span> <span style="color:#a6e22e">client</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">client</span>}&gt;
    &lt;<span style="color:#f92672">div</span>&gt;
      &lt;<span style="color:#f92672">h2</span>&gt;<span style="color:#a6e22e">My</span> <span style="color:#a6e22e">first</span> <span style="color:#a6e22e">Apollo</span> <span style="color:#a6e22e">app</span> <span style="color:#960050;background-color:#1e0010">ğŸš€</span>&lt;/<span style="color:#f92672">h2</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
  &lt;/<span style="color:#f92672">ApolloProvider</span>&gt;
);

<span style="color:#a6e22e">render</span>(&lt;<span style="color:#f92672">App</span> /&gt;, document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;root&#39;</span>));
</code></pre></div><p>é¢˜å¤–è¯ï¼šéœ€è¦æ³¨æ„ä¸€ä¸‹ <code>ApolloProvider</code> æ³¨å…¥çš„ä½ç½®ï¼ŒåŒæ—¶åˆ›å»º <code>ApolloClient</code> çš„æ—¶å€™éœ€è¦å¯¼å‡ºä¸€ä¸ªåˆ›å»º client çš„å‡½æ•°ï¼ˆå¦‚æœä¸šåŠ¡å®šåˆ¶è¾ƒä¸ºå¤æ‚çš„è¯å¯èƒ½éœ€è¦è¿™ä¹ˆåšï¼Œä¾‹å¦‚ç»‘å®šé€šç”¨çš„é”™è¯¯å¤„ç†å’Œå›½é™…åŒ–ï¼‰æ—¶ï¼Œéœ€è¦é˜²æ­¢ <code>ApolloProvider</code> re-render å¯¼è‡´çš„ <code>ApolloClient</code> è¢«é‡å¤åˆ›å»ºï¼Œå› ä¸ºè¿™æ ·ç›¸å½“äºä¼šæ¸…ç©º Apollo çš„ç¼“å­˜ï¼Œå¯¼è‡´é¢å¤–ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚ã€‚ç¼“å­˜ç›¸å…³çš„å†…å®¹ä¼šåœ¨ä¸‹é¢æåˆ°ã€‚</p>
<p>è€Œå¦‚æœæˆ‘ä»¬è¦å‘èµ·è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ Apollo æä¾›çš„ APIã€‚Apollo æä¾›äº† <code>&lt;Query /&gt;</code> å’Œ <code>&lt;Mutation /&gt;</code> çš„ç»„ä»¶ï¼Œå®ƒä»¬æ˜¯ä»¥ render callback çš„æ¨¡å¼æ¥åº”ç”¨çš„ã€‚è€Œæˆ‘åœ¨é¡¹ç›®ä¸­ä¸»è¦è¿ç”¨äº† hooksã€‚Apollo çš„ hooks ä¸»è¦å¸¸ç”¨çš„æœ‰ 3 ä¸ªï¼Œåˆ†åˆ«æ˜¯ <code>useQuery</code>, <code>useLazyQuery</code> å’Œ <code>useMutation</code>ã€‚<code>useQuery</code> å’Œ <code>useLazyQuery</code> çš„åŒºåˆ«æ˜¯ï¼Œ<code>useQuery</code> åœ¨ç»„ä»¶ render/re-render çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰§è¡Œï¼ˆå‘èµ·è¯·æ±‚ï¼‰ï¼Œè€Œ <code>useLazyQuery</code> åˆ™å…è®¸ç”¨æˆ·åœ¨ç‰¹å®šçš„æ—¶å€™è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥å‘èµ·è¯·æ±‚ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSX" data-lang="JSX"><span style="color:#75715e">/** useQuery */</span>
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">gql</span>, <span style="color:#a6e22e">useQuery</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@apollo/client&#39;</span>; <span style="color:#75715e">// æ³¨ï¼š 3.0beta å°† gql æ•´åˆè‡³ @apollo/client åŒ…ä¸­ï¼Œå’Œä¸Šæ–‡çš„ä» &#39;graphql-tag&#39; åŒ…ä¸­å¼•ç”¨çš„æ–¹å¼å¹¶ä¸å†²çª
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">GET_GREETING</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gql</span><span style="color:#e6db74">`
</span><span style="color:#e6db74">  query GetGreeting($language: String!) {
</span><span style="color:#e6db74">    greeting(language: $language) {
</span><span style="color:#e6db74">      message
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">  }
</span><span style="color:#e6db74">`</span>;

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Hello</span>() {
  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">loading</span>, <span style="color:#a6e22e">error</span>, <span style="color:#a6e22e">data</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">useQuery</span>(<span style="color:#a6e22e">GET_GREETING</span>, {
    <span style="color:#a6e22e">variables</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">language</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;english&#39;</span> },
  });
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">loading</span>) <span style="color:#66d9ef">return</span> &lt;<span style="color:#f92672">p</span>&gt;<span style="color:#a6e22e">Loading</span> ...&lt;/<span style="color:#f92672">p</span>&gt;;
  <span style="color:#66d9ef">return</span> &lt;<span style="color:#f92672">h1</span>&gt;<span style="color:#a6e22e">Hello</span> {<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">greeting</span>.<span style="color:#a6e22e">message</span>}<span style="color:#f92672">!</span>&lt;/<span style="color:#f92672">h1</span>&gt;;
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSX" data-lang="JSX"><span style="color:#75715e">/** useLazyQuery */</span>
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">gql</span>, <span style="color:#a6e22e">useLazyQuery</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@apollo/client&#34;</span>;

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">GET_GREETING</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gql</span><span style="color:#e6db74">`
</span><span style="color:#e6db74">  query GetGreeting($language: String!) {
</span><span style="color:#e6db74">    greeting(language: $language) {
</span><span style="color:#e6db74">      message
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">  }
</span><span style="color:#e6db74">`</span>;

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Hello</span>() {
  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">loadGreeting</span>, { <span style="color:#a6e22e">called</span>, <span style="color:#a6e22e">loading</span>, <span style="color:#a6e22e">data</span> }] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useLazyQuery</span>(
    <span style="color:#a6e22e">GET_GREETING</span>,
    { <span style="color:#a6e22e">variables</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">language</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;english&#34;</span> } }
  );
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">called</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">loading</span>) <span style="color:#66d9ef">return</span> &lt;<span style="color:#f92672">p</span>&gt;<span style="color:#a6e22e">Loading</span> ...&lt;/<span style="color:#f92672">p</span>&gt;
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">called</span>) {
    <span style="color:#66d9ef">return</span> &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{() =&gt; <span style="color:#a6e22e">loadGreeting</span>()}&gt;<span style="color:#a6e22e">Load</span> <span style="color:#a6e22e">greeting</span>&lt;/<span style="color:#f92672">button</span>&gt;
  }
  <span style="color:#66d9ef">return</span> &lt;<span style="color:#f92672">h1</span>&gt;<span style="color:#a6e22e">Hello</span> {<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">greeting</span>.<span style="color:#a6e22e">message</span>}<span style="color:#f92672">!</span>&lt;/<span style="color:#f92672">h1</span>&gt;;
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSX" data-lang="JSX"><span style="color:#75715e">/** useMutation */</span>
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">gql</span>, <span style="color:#a6e22e">useMutation</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@apollo/client&#39;</span>;

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ADD_TODO</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gql</span><span style="color:#e6db74">`
</span><span style="color:#e6db74">  mutation AddTodo($type: String!) {
</span><span style="color:#e6db74">    addTodo(type: $type) {
</span><span style="color:#e6db74">      id
</span><span style="color:#e6db74">      type
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">  }
</span><span style="color:#e6db74">`</span>;

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">AddTodo</span>() {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">input</span>;
  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">addTodo</span>, { <span style="color:#a6e22e">data</span> }] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useMutation</span>(<span style="color:#a6e22e">ADD_TODO</span>);

  <span style="color:#66d9ef">return</span> (
    &lt;<span style="color:#f92672">div</span>&gt;
      &lt;<span style="color:#f92672">form</span>
        <span style="color:#a6e22e">onSubmit</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">e</span> =&gt; {
          <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">preventDefault</span>();
          <span style="color:#a6e22e">addTodo</span>({ <span style="color:#a6e22e">variables</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">value</span> } });
          <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
        }}
      &gt;
        &lt;<span style="color:#f92672">input</span>
          <span style="color:#a6e22e">ref</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">node</span> =&gt; {
            <span style="color:#a6e22e">input</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">node</span>;
          }}
        /&gt;
        &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;<span style="color:#a6e22e">Add</span> <span style="color:#a6e22e">Todo</span>&lt;/<span style="color:#f92672">button</span>&gt;
      &lt;/<span style="color:#f92672">form</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
  );
}
</code></pre></div><p>ä¸Šé¢åˆ†åˆ«å±•ç¤ºäº† <code>useQuery</code>, <code>useLazyQuery</code> å’Œ <code>useMutation</code> çš„ç”¨æ³•ã€‚å¦‚æœäº†è§£ hooks çš„è¯ï¼Œå‚è€ƒ Apollo çš„ API æ–‡æ¡£åº”è¯¥ä¸Šæ‰‹éš¾åº¦ä¸å¤§ã€‚é‚£ä¹ˆåœ¨ä¸Šä¸€èŠ‚æåˆ°çš„è¯·æ±‚å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™è¾¹ä»¥ <code>variables</code> ä¼ å…¥ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">loadGreeting</span>, { <span style="color:#a6e22e">called</span>, <span style="color:#a6e22e">loading</span>, <span style="color:#a6e22e">data</span> }] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useLazyQuery</span>(
  <span style="color:#a6e22e">GET_GREETING</span>,
  { <span style="color:#a6e22e">variables</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">language</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;english&#34;</span> } } <span style="color:#75715e">// å‚æ•°
</span><span style="color:#75715e"></span>)
</code></pre></div><p>è€Œåœ¨ Apollo ä¸­ï¼Œ<code>options</code> æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒå¯ä»¥å®šåˆ¶ queries å’Œ mutations çš„è¡Œä¸ºã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ<code>variables</code> å…¶å®å°±æ˜¯ <code>options</code> çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ queries ä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°ï¼š</p>
<ul>
<li>notifyOnNetworkStatusChange: <code>networkStatus</code> å˜åŒ–çš„æ—¶å€™æ˜¯å¦éœ€è¦ re-render ç»„ä»¶</li>
<li>fetchPolicy: è¿™å…³ç³»åˆ° Apollo ä¼šä¸ä¼šç¼“å­˜æ•°æ®ã€‚è®¾ç½®ä¸º <code>cache-first</code> çš„è¯ï¼Œé’ˆå¯¹åŒæ ·çš„è¯·æ±‚å‚æ•°ï¼ŒApollo ä¼šç›´æ¥è¯»å– client ä¸­çš„ç¼“å­˜è€Œä¸ä¼šé‡æ–°è¯·æ±‚ï¼›è®¾ç½®ä¸º <code>network-only</code> çš„è¯ï¼Œåˆ™ä¼šæ¯æ¬¡éƒ½è¯·æ±‚æ–°çš„æ•°æ®</li>
<li>pollInterval: è½®è¯¢é—´éš”æ—¶é—´ã€‚è™½ç„¶æˆ‘ä»¬å¸¸è§„çš„ä¸šåŠ¡ä¸éœ€è¦è½®è¯¢ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°å…¶å®æ˜¯å¯ä»¥ç”¨ä½œåˆ·æ–°ç­–ç•¥çš„</li>
<li>onCompleted: è¯·æ±‚å®Œæˆåçš„å›è°ƒã€‚æˆ‘ä¸€èˆ¬æ¯”è¾ƒå°‘ç”¨è¿™ä¸ªï¼Œå› ä¸ºä¹‹å‰æœ‰å‘ç°å®ƒä¼šè¢«é‡å¤è°ƒç”¨çš„ bugã€‚ç›‘å¬æ•°æ®çŠ¶æ€å…¶å®å¯ä»¥ç®€å•åœ°ç”¨ <code>useEffect</code></li>
</ul>
<p>é‚£ä¹ˆè¿™äº›å‚æ•°å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬æœ‰ä¸ªåœºæ™¯ï¼Œåœ¨ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨æ‰“å¼€ä¸€ä¸ªå¼¹çª—ï¼Œä¿®æ”¹ç”¨æˆ·ä¿¡æ¯åéœ€è¦é‡æ–°è·å–ç”¨æˆ·åˆ—è¡¨ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSX" data-lang="JSX"><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">React</span>, { <span style="color:#a6e22e">useState</span>, <span style="color:#a6e22e">useEffect</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react&#39;</span>

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">UserModule</span> <span style="color:#f92672">=</span> () =&gt; {
  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">pollInterval</span>, <span style="color:#a6e22e">setPollInterval</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span>(<span style="color:#ae81ff">0</span>)

  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">updateUserInfo</span>, { <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mutationData</span> }] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useMutation</span>(<span style="color:#a6e22e">UPDATE_USER_INFO</span>); <span style="color:#75715e">// updateUserInfo ä¼šåœ¨æŸå¤„è¢«è°ƒç”¨
</span><span style="color:#75715e"></span>
  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">called</span>, <span style="color:#a6e22e">loading</span>, <span style="color:#a6e22e">data</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useQuery</span>(
    <span style="color:#a6e22e">GET_USERS</span>,
    {
      <span style="color:#a6e22e">variables</span><span style="color:#f92672">:</span> {}, <span style="color:#75715e">// çœç•¥
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">pollInterval</span>
    }
  )

  <span style="color:#a6e22e">useEffect</span>(() =&gt; {
    <span style="color:#75715e">// mutation æˆåŠŸ
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">mutationData</span>.<span style="color:#a6e22e">res</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;success&#39;</span>) {
      <span style="color:#a6e22e">setPollInterval</span>(<span style="color:#ae81ff">500</span>)
    }
  }, [<span style="color:#a6e22e">mutationData</span>])

  <span style="color:#a6e22e">useEffect</span>(() =&gt; {
    <span style="color:#75715e">// é‡ç½® pollInterval é˜²æ­¢é‡å¤è¯·æ±‚
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">pollInterval</span> <span style="color:#f92672">!==</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#a6e22e">setPollInterval</span>(<span style="color:#ae81ff">0</span>)
    }
  }, [<span style="color:#a6e22e">data</span>])

  <span style="color:#75715e">// æ•°æ®å¤„ç†å’Œæ¸²æŸ“å°±ä¸å®ç°äº†
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> &lt;&gt;&lt;/&gt;
}
</code></pre></div><p>ä¸Šé¢çš„ä»£ç é€»è¾‘æ˜¯ï¼šå‘èµ· <code>UPDATE_USER_INFO</code> çš„ mutationï¼Œè¯·æ±‚æˆåŠŸåå°† <code>pollInterval</code> è®¾ç½®æˆ 500msï¼Œè¿™æ · <code>GET_USERS</code> çš„ query å°±ä¼šåœ¨ 500ms åé‡æ–°è¯·æ±‚ã€‚è¿™ä¸ªé‡æ–°è¯·æ±‚æ˜¯æ— è§†ç¼“å­˜çš„ï¼Œå°±ç®—ä½ è®¾ç½®ç¼“å­˜ä¸º <code>cache-first</code> ä¹Ÿä¼šé‡æ–°è¯·æ±‚ã€‚è€Œ <code>fetchPolicy</code> ä¸»è¦å½±å“çš„æ˜¯ <code>variables</code> å˜åŒ–å¯¼è‡´çš„è¡Œä¸ºï¼Œä¾‹å¦‚è¯·æ±‚ä¸€ä¸ªç”¨æˆ·è¡¨æ ¼ä¼šæœ‰ä¸åŒé¡µç ã€æ¯é¡µæ•°é‡ã€æ’åºå­—æ®µã€è¿‡æ»¤å­—æ®µç­‰å‚æ•°ï¼Œä½¿ç”¨åŒæ ·çš„å‚æ•°æ˜¯è¯»å–ç¼“å­˜è¿˜æ˜¯é‡æ–°è·å–æ•°æ®ã€‚æ¥ç€æˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªæ—¶æœºå°† <code>pollInterval</code> é‡æ–°è®¾ç½®æˆ 0ï¼Œé˜²æ­¢æ— é™å¾ªç¯çš„è¯·æ±‚ã€‚å¦å¤–å»ºè®®ä¸è¦åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨ <code>setTimeout</code> å»è®¾ç½® <code>pollInterval</code>ï¼Œå› ä¸ºæˆ‘ä»¬çœ‹ä¸Šé¢çš„ä»£ç æ¶‰åŠåˆ°äº†å¾ˆå¤š state å˜åŒ–å’Œ effectsï¼Œè¿™äº›åœ¨ React ä¸­æŸç§ç¨‹åº¦ä¸Šæ˜¯â€œå¼‚æ­¥â€çš„ï¼Œå¦‚æœåœ¨ä¸šåŠ¡å¾ˆå¤æ‚çš„åœºæ™¯ä¸‹ä½¿ç”¨ <code>setTimeout</code>ï¼Œåè€Œä¼šå¯¼è‡´ç»„ä»¶çš„è¡Œä¸ºéš¾ä»¥æ§åˆ¶ï¼Œè€Œä¸”ä¹Ÿå¯èƒ½ä¼šå‡ºç°åœ¨å·²ç» unmounted çš„ç»„ä»¶ä¸Šæ›´æ–° state çš„ errorï¼Œå°½ç®¡å¯¹ç”¨æˆ·ä½¿ç”¨çš„å½±å“ä¸å¤§ï¼Œä½†æ˜¯å¯¹æ€§èƒ½æ˜¯ä¸åˆ©çš„ã€‚</p>
<h3 id="å•å…ƒæµ‹è¯•">å•å…ƒæµ‹è¯•</h3>
<p>æˆ‘ä»¬çŸ¥é“ React ç»„ä»¶çš„å•å…ƒæµ‹è¯•å¯ä»¥ç”¨ jest + enzyme æ¥å®Œæˆã€‚å•å…ƒæµ‹è¯•çš„æ—¶å€™æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨ shallow renderã€‚è€Œåœ¨ä½¿ç”¨äº† Apollo ç›¸å…³çš„ API æ¯”å¦‚ hooks ä¹‹åï¼Œjest ä¼šæç¤ºæˆ‘ä»¬è¯¥ç»„ä»¶æ²¡æœ‰ <code>ApolloProvider</code>ï¼Œè¿™äº› Apollo ç›¸å…³çš„ API åªèƒ½åœ¨ <code>ApolloProvider</code> å†…ä½¿ç”¨ã€‚Apollo ä¹Ÿæä¾›äº†ç”¨äºæµ‹è¯•çš„ APIï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">MockedProvider</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@apollo/client/testing&#34;</span>;
</code></pre></div><p>å…·ä½“ä½¿ç”¨ä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">MockedProvider</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@apollo/client/testing&#34;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">mount</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;enzyme&#39;</span>

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mocks</span> <span style="color:#f92672">=</span> [
  {
    <span style="color:#a6e22e">request</span><span style="color:#f92672">:</span> {
      <span style="color:#a6e22e">query</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">SOME_QUERY</span>,
      <span style="color:#a6e22e">variables</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">first</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span> }
    },
    <span style="color:#a6e22e">result</span><span style="color:#f92672">:</span> {
      <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {
        <span style="color:#a6e22e">dog</span><span style="color:#f92672">:</span> {
          <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Douglas&#34;</span>
        }
      }
    }
  },
  {
    <span style="color:#a6e22e">request</span><span style="color:#f92672">:</span> {
      <span style="color:#a6e22e">query</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">SOME_QUERY</span>,
      <span style="color:#a6e22e">variables</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">first</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">8</span>}
    },
    <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Something went wrong&#34;</span>)
  }
]

<span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#34;runs the mocked query&#34;</span>, () =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrapper</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mount</span>(
    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">MockedProvider</span> <span style="color:#a6e22e">mocks</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">mocks</span>}<span style="color:#f92672">&gt;</span>
      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">MyQueryComponent</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/MockedProvider&gt;</span>
  )
  <span style="color:#75715e">// Run assertions on &lt;MyQueryComponent/&gt;
</span><span style="color:#75715e"></span>});
</code></pre></div><p>å¦‚æœä½ æ˜¯æŠŠç»„ä»¶å®é™…æ¸²æŸ“çš„éƒ¨åˆ†å’Œ <code>MockedProvider</code> å†™åœ¨åŒä¸€ä¸ªç»„ä»¶å†…ï¼Œé‚£ä¹ˆæµ‹è¯•çš„æ—¶å€™éœ€è¦ç”¨ <code>mount</code>ï¼Œå¦åˆ™æ— æ³•å°†ç»„ä»¶å†…éƒ¨çš„å†…å®¹æ¸²æŸ“å‡ºæ¥ã€‚å¯¹æµ‹è¯•æ¯”è¾ƒå‹å¥½çš„æ–¹å¼å¯èƒ½æ˜¯ï¼Œå°† queries/mutations çš„éƒ¨åˆ†ç‹¬ç«‹å‡ºæ¥åšä¸€ä¸ª container ç»„ä»¶ï¼Œæ¸²æŸ“éƒ¨åˆ†ä½œä¸º dumb ç»„ä»¶ã€‚ä½†æ˜¯è¿™å…·ä½“å¾—çœ‹è¿™æ–¹é¢çš„éœ€æ±‚å’Œä»£ç è§„èŒƒæ˜¯æ€ä¹ˆåˆ¶å®šçš„ã€‚</p>
<p>ç›®å‰è¿™ä¸ªæµ‹è¯•å¯èƒ½è¿˜æ˜¯æœ‰ç‚¹ bug çš„çŠ¶æ€ï¼Œæˆ‘ç›®å‰é¡¹ç›®è¿˜æ²¡è¿ç§»åˆ° 3.0betaï¼Œæ‰€ä»¥ä¸å¤§æ¸…æ¥šä¼šä¸ä¼šåœ¨æ–°ç‰ˆä¿®å¤ã€‚æˆ‘åœ¨æ—§ç‰ˆä¸­é‡åˆ°è¿‡å‡ ç§æƒ…å†µï¼Œä¾‹å¦‚ mock çš„æ•°æ®éƒ½å†™å¯¹ï¼Œä½†å®é™…ä¸Šè¿”å›äº† network errorï¼Œæç¤ºå‚æ•°æœ‰é—®é¢˜ï¼›è¿˜æœ‰é‡åˆ°è¿‡ mocks é‡Œå†™ä¸¤ä¸ªå¯¹è±¡ä¼šå‡ºç°è¯»å–é”™è¯¯çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ä¸æ–¹ä¾¿åŒæ—¶ mock å¤šä¸ª queries/mutationsã€‚</p>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Haoze Harry Xu </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://elizurhz.cn/frontend/apollo-react/>https://elizurhz.cn/frontend/apollo-react/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                æœ¬æ–‡é‡‡ç”¨<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯ï¼šå…¨æ–‡è½¬è½½éœ€è¦æœ¬äººè®¸å¯ï¼Œå¦‚æœ‰å¼•ç”¨éœ€ç½²åã€‚
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://elizurhz.cn/tags/graphql/">
                    #GraphQL</a></span>
            
            <span class="tag"><a href="https://elizurhz.cn/tags/react/">
                    #React</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> Â· 
                <span><a href="https://elizurhz.cn/">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://elizurhz.cn/frontend/react-fiber/" class="prev" rel="prev" title="é‡æ–°äº†è§£ React - React Fiber"><i class="iconfont icon-left"></i>&nbsp;é‡æ–°äº†è§£ React - React Fiber</a>
         
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://elizurhz.cn/">Haoze Harry Xu</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
